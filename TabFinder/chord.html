<script type="text/javascript">
    
/*  Prototype JavaScript framework, version 1.6.0.3
*  (c) 2005-2008 Sam Stephenson
*
*  Prototype is freely distributable under the terms of an MIT-style license.
*  For details, see the Prototype web site: http://www.prototypejs.org/
*
*--------------------------------------------------------------------------*/

var Prototype = {
Version: '1.6.0.3',

Browser: {
IE:     !!(window.attachEvent &&
navigator.userAgent.indexOf('Opera') === -1),
Opera:  navigator.userAgent.indexOf('Opera') > -1,
WebKit: navigator.userAgent.indexOf('AppleWebKit/') > -1,
Gecko:  navigator.userAgent.indexOf('Gecko') > -1 &&
navigator.userAgent.indexOf('KHTML') === -1,
MobileSafari: !!navigator.userAgent.match(/Apple.*Mobile.*Safari/)
},

BrowserFeatures: {
XPath: !!document.evaluate,
SelectorsAPI: !!document.querySelector,
ElementExtensions: !!window.HTMLElement,
SpecificElementExtensions:
document.createElement('div')['__proto__'] &&
document.createElement('div')['__proto__'] !==
document.createElement('form')['__proto__']
},

ScriptFragment: '<script[^>]*>([\\S\\s]*?)<\/script>',
JSONFilter: /^\/\*-secure-([\s\S]*)\*\/\s*$/,

emptyFunction: function() { },
K: function(x) { return x }
};

if (Prototype.Browser.MobileSafari)
Prototype.BrowserFeatures.SpecificElementExtensions = false;


/* Based on Alex Arnell's inheritance implementation. */
var Class = {
create: function() {
var parent = null, properties = $A(arguments);
if (Object.isFunction(properties[0]))
parent = properties.shift();

function klass() {
this.initialize.apply(this, arguments);
}

Object.extend(klass, Class.Methods);
klass.superclass = parent;
klass.subclasses = [];

if (parent) {
var subclass = function() { };
subclass.prototype = parent.prototype;
klass.prototype = new subclass;
parent.subclasses.push(klass);
}

for (var i = 0; i < properties.length; i++)
    klass.addMethods(properties[i]);
    
    if (!klass.prototype.initialize)
    klass.prototype.initialize = Prototype.emptyFunction;
    
    klass.prototype.constructor = klass;
    
    return klass;
    }
    };
    
    Class.Methods = {
    addMethods: function(source) {
    var ancestor   = this.superclass && this.superclass.prototype;
    var properties = Object.keys(source);
    
    if (!Object.keys({ toString: true }).length)
    properties.push("toString", "valueOf");
    
    for (var i = 0, length = properties.length; i < length; i++) {
    var property = properties[i], value = source[property];
    if (ancestor && Object.isFunction(value) &&
    value.argumentNames().first() == "$super") {
    var method = value;
    value = (function(m) {
    return function() { return ancestor[m].apply(this, arguments) };
    })(property).wrap(method);
    
    value.valueOf = method.valueOf.bind(method);
    value.toString = method.toString.bind(method);
    }
    this.prototype[property] = value;
    }
    
    return this;
    }
    };
    
    var Abstract = { };
    
    Object.extend = function(destination, source) {
    for (var property in source)
    destination[property] = source[property];
    return destination;
    };
    
    Object.extend(Object, {
    inspect: function(object) {
    try {
    if (Object.isUndefined(object)) return 'undefined';
    if (object === null) return 'null';
    return object.inspect ? object.inspect() : String(object);
    } catch (e) {
    if (e instanceof RangeError) return '...';
    throw e;
    }
    },
    
    toJSON: function(object) {
    var type = typeof object;
    switch (type) {
    case 'undefined':
    case 'function':
    case 'unknown': return;
    case 'boolean': return object.toString();
    }
    
    if (object === null) return 'null';
    if (object.toJSON) return object.toJSON();
    if (Object.isElement(object)) return;
    
    var results = [];
    for (var property in object) {
    var value = Object.toJSON(object[property]);
    if (!Object.isUndefined(value))
    results.push(property.toJSON() + ': ' + value);
    }
    
    return '{' + results.join(', ') + '}';
    },
    
    toQueryString: function(object) {
    return $H(object).toQueryString();
    },
    
    toHTML: function(object) {
    return object && object.toHTML ? object.toHTML() : String.interpret(object);
    },
    
    keys: function(object) {
    var keys = [];
    for (var property in object)
    keys.push(property);
    return keys;
    },
    
    values: function(object) {
    var values = [];
    for (var property in object)
    values.push(object[property]);
    return values;
    },
    
    clone: function(object) {
    return Object.extend({ }, object);
    },
    
    isElement: function(object) {
    return !!(object && object.nodeType == 1);
    },
    
    isArray: function(object) {
    return object != null && typeof object == "object" &&
    'splice' in object && 'join' in object;
    },
    
    isHash: function(object) {
    return object instanceof Hash;
    },
    
    isFunction: function(object) {
    return typeof object == "function";
    },
    
    isString: function(object) {
    return typeof object == "string";
    },
    
    isNumber: function(object) {
    return typeof object == "number";
    },
    
    isUndefined: function(object) {
    return typeof object == "undefined";
    }
    });
    
    Object.extend(Function.prototype, {
    argumentNames: function() {
    var names = this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1]
    .replace(/\s+/g, '').split(',');
    return names.length == 1 && !names[0] ? [] : names;
    },
    
    bind: function() {
    if (arguments.length < 2 && Object.isUndefined(arguments[0])) return this;
    var __method = this, args = $A(arguments), object = args.shift();
    return function() {
    return __method.apply(object, args.concat($A(arguments)));
    }
    },
    
    bindAsEventListener: function() {
    var __method = this, args = $A(arguments), object = args.shift();
    return function(event) {
    return __method.apply(object, [event || window.event].concat(args));
    }
    },
    
    curry: function() {
    if (!arguments.length) return this;
    var __method = this, args = $A(arguments);
    return function() {
    return __method.apply(this, args.concat($A(arguments)));
    }
    },
    
    delay: function() {
    var __method = this, args = $A(arguments), timeout = args.shift() * 1000;
    return window.setTimeout(function() {
    return __method.apply(__method, args);
    }, timeout);
    },
    
    defer: function() {
    var args = [0.01].concat($A(arguments));
    return this.delay.apply(this, args);
    },
    
    wrap: function(wrapper) {
    var __method = this;
    return function() {
    return wrapper.apply(this, [__method.bind(this)].concat($A(arguments)));
    }
    },
    
    methodize: function() {
    if (this._methodized) return this._methodized;
    var __method = this;
    return this._methodized = function() {
    return __method.apply(null, [this].concat($A(arguments)));
    };
    }
    });
    
    Date.prototype.toJSON = function() {
    return '"' + this.getUTCFullYear() + '-' +
    (this.getUTCMonth() + 1).toPaddedString(2) + '-' +
    this.getUTCDate().toPaddedString(2) + 'T' +
    this.getUTCHours().toPaddedString(2) + ':' +
    this.getUTCMinutes().toPaddedString(2) + ':' +
    this.getUTCSeconds().toPaddedString(2) + 'Z"';
    };
    
    var Try = {
    these: function() {
    var returnValue;
    
    for (var i = 0, length = arguments.length; i < length; i++) {
    var lambda = arguments[i];
    try {
    returnValue = lambda();
    break;
    } catch (e) { }
    }
    
    return returnValue;
    }
    };
    
    RegExp.prototype.match = RegExp.prototype.test;
    
    RegExp.escape = function(str) {
    return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
    };
    
    /*--------------------------------------------------------------------------*/
    
    var PeriodicalExecuter = Class.create({
    initialize: function(callback, frequency) {
    this.callback = callback;
    this.frequency = frequency;
    this.currentlyExecuting = false;
    
    this.registerCallback();
    },
    
    registerCallback: function() {
    this.timer = setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
    },
    
    execute: function() {
    this.callback(this);
    },
    
    stop: function() {
    if (!this.timer) return;
    clearInterval(this.timer);
    this.timer = null;
    },
    
    onTimerEvent: function() {
    if (!this.currentlyExecuting) {
    try {
    this.currentlyExecuting = true;
    this.execute();
    } finally {
    this.currentlyExecuting = false;
    }
    }
    }
    });
    Object.extend(String, {
    interpret: function(value) {
    return value == null ? '' : String(value);
    },
    specialChar: {
    '\b': '\\b',
    '\t': '\\t',
    '\n': '\\n',
    '\f': '\\f',
    '\r': '\\r',
    '\\': '\\\\'
    }
    });
    
    Object.extend(String.prototype, {
    gsub: function(pattern, replacement) {
    var result = '', source = this, match;
    replacement = arguments.callee.prepareReplacement(replacement);
    
    while (source.length > 0) {
    if (match = source.match(pattern)) {
    result += source.slice(0, match.index);
    result += String.interpret(replacement(match));
    source  = source.slice(match.index + match[0].length);
    } else {
    result += source, source = '';
    }
    }
    return result;
    },
    
    sub: function(pattern, replacement, count) {
    replacement = this.gsub.prepareReplacement(replacement);
    count = Object.isUndefined(count) ? 1 : count;
    
    return this.gsub(pattern, function(match) {
    if (--count < 0) return match[0];
        return replacement(match);
        });
        },
        
        scan: function(pattern, iterator) {
        this.gsub(pattern, iterator);
        return String(this);
        },
        
        truncate: function(length, truncation) {
        length = length || 30;
        truncation = Object.isUndefined(truncation) ? '...' : truncation;
        return this.length > length ?
        this.slice(0, length - truncation.length) + truncation : String(this);
        },
        
        strip: function() {
        return this.replace(/^\s+/, '').replace(/\s+$/, '');
        },
        
        stripTags: function() {
        return this.replace(/<\/?[^>]+>/gi, '');
            },
            
            stripScripts: function() {
            return this.replace(new RegExp(Prototype.ScriptFragment, 'img'), '');
            },
            
            extractScripts: function() {
            var matchAll = new RegExp(Prototype.ScriptFragment, 'img');
            var matchOne = new RegExp(Prototype.ScriptFragment, 'im');
            return (this.match(matchAll) || []).map(function(scriptTag) {
            return (scriptTag.match(matchOne) || ['', ''])[1];
            });
            },
            
            evalScripts: function() {
            return this.extractScripts().map(function(script) { return eval(script) });
            },
            
            escapeHTML: function() {
            var self = arguments.callee;
            self.text.data = this;
            return self.div.innerHTML;
            },
            
            unescapeHTML: function() {
            var div = new Element('div');
            div.innerHTML = this.stripTags();
            return div.childNodes[0] ? (div.childNodes.length > 1 ?
            $A(div.childNodes).inject('', function(memo, node) { return memo+node.nodeValue }) :
            div.childNodes[0].nodeValue) : '';
            },
            
            toQueryParams: function(separator) {
            var match = this.strip().match(/([^?#]*)(#.*)?$/);
            if (!match) return { };
            
            return match[1].split(separator || '&').inject({ }, function(hash, pair) {
            if ((pair = pair.split('='))[0]) {
            var key = decodeURIComponent(pair.shift());
            var value = pair.length > 1 ? pair.join('=') : pair[0];
            if (value != undefined) value = decodeURIComponent(value);
            
            if (key in hash) {
            if (!Object.isArray(hash[key])) hash[key] = [hash[key]];
            hash[key].push(value);
            }
            else hash[key] = value;
            }
            return hash;
            });
            },
            
            toArray: function() {
            return this.split('');
            },
            
            succ: function() {
            return this.slice(0, this.length - 1) +
            String.fromCharCode(this.charCodeAt(this.length - 1) + 1);
            },
            
            times: function(count) {
            return count < 1 ? '' : new Array(count + 1).join(this);
                },
                
                camelize: function() {
                var parts = this.split('-'), len = parts.length;
                if (len == 1) return parts[0];
                
                var camelized = this.charAt(0) == '-'
                ? parts[0].charAt(0).toUpperCase() + parts[0].substring(1)
                : parts[0];
                
                for (var i = 1; i < len; i++)
                camelized += parts[i].charAt(0).toUpperCase() + parts[i].substring(1);
                
                return camelized;
                },
                
                capitalize: function() {
                return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
                },
                
                underscore: function() {
                return this.gsub(/::/, '/').gsub(/([A-Z]+)([A-Z][a-z])/,'#{1}_#{2}').gsub(/([a-z\d])([A-Z])/,'#{1}_#{2}').gsub(/-/,'_').toLowerCase();
                },
                
                dasherize: function() {
                return this.gsub(/_/,'-');
                },
                
                inspect: function(useDoubleQuotes) {
                var escapedString = this.gsub(/[\x00-\x1f\\]/, function(match) {
                var character = String.specialChar[match[0]];
                return character ? character : '\\u00' + match[0].charCodeAt().toPaddedString(2, 16);
                });
                if (useDoubleQuotes) return '"' + escapedString.replace(/"/g, '\\"') + '"';
                return "'" + escapedString.replace(/'/g, '\\\'') + "'";
                },
                
                toJSON: function() {
                return this.inspect(true);
                },
                
                unfilterJSON: function(filter) {
                return this.sub(filter || Prototype.JSONFilter, '#{1}');
                },
                
                isJSON: function() {
                var str = this;
                if (str.blank()) return false;
                str = this.replace(/\\./g, '@').replace(/"[^"\\\n\r]*"/g, '');
                return (/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);
                },
                
                evalJSON: function(sanitize) {
                var json = this.unfilterJSON();
                try {
                if (!sanitize || json.isJSON()) return eval('(' + json + ')');
                } catch (e) { }
                throw new SyntaxError('Badly formed JSON string: ' + this.inspect());
                },
                
                include: function(pattern) {
                return this.indexOf(pattern) > -1;
                },
                
                startsWith: function(pattern) {
                return this.indexOf(pattern) === 0;
                },
                
                endsWith: function(pattern) {
                var d = this.length - pattern.length;
                return d >= 0 && this.lastIndexOf(pattern) === d;
                },
                
                empty: function() {
                return this == '';
                },
                
                blank: function() {
                return /^\s*$/.test(this);
                },
                
                interpolate: function(object, pattern) {
                return new Template(this, pattern).evaluate(object);
                }
                });
                
                if (Prototype.Browser.WebKit || Prototype.Browser.IE) Object.extend(String.prototype, {
                escapeHTML: function() {
                return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
                },
                unescapeHTML: function() {
                return this.stripTags().replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>');
                    }
                    });
                    
                    String.prototype.gsub.prepareReplacement = function(replacement) {
                    if (Object.isFunction(replacement)) return replacement;
                    var template = new Template(replacement);
                    return function(match) { return template.evaluate(match) };
                    };
                    
                    String.prototype.parseQuery = String.prototype.toQueryParams;
                    
                    Object.extend(String.prototype.escapeHTML, {
                    div:  document.createElement('div'),
                    text: document.createTextNode('')
                    });
                    
                    String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);
                    
                    var Template = Class.create({
                    initialize: function(template, pattern) {
                    this.template = template.toString();
                    this.pattern = pattern || Template.Pattern;
                    },
                    
                    evaluate: function(object) {
                    if (Object.isFunction(object.toTemplateReplacements))
                    object = object.toTemplateReplacements();
                    
                    return this.template.gsub(this.pattern, function(match) {
                    if (object == null) return '';
                    
                    var before = match[1] || '';
                    if (before == '\\') return match[2];
                    
                    var ctx = object, expr = match[3];
                    var pattern = /^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;
                    match = pattern.exec(expr);
                    if (match == null) return before;
                    
                    while (match != null) {
                    var comp = match[1].startsWith('[') ? match[2].gsub('\\\\]', ']') : match[1];
                    ctx = ctx[comp];
                    if (null == ctx || '' == match[3]) break;
                    expr = expr.substring('[' == match[3] ? match[1].length : match[0].length);
                    match = pattern.exec(expr);
                    }
                    
                    return before + String.interpret(ctx);
                    });
                    }
                    });
                    Template.Pattern = /(^|.|\r|\n)(#\{(.*?)\})/;
                    
                    var $break = { };
                    
                    var Enumerable = {
                    each: function(iterator, context) {
                    var index = 0;
                    try {
                    this._each(function(value) {
                    iterator.call(context, value, index++);
                    });
                    } catch (e) {
                    if (e != $break) throw e;
                    }
                    return this;
                    },
                    
                    eachSlice: function(number, iterator, context) {
                    var index = -number, slices = [], array = this.toArray();
                    if (number < 1) return array;
                        while ((index += number) < array.length)
                        slices.push(array.slice(index, index+number));
                        return slices.collect(iterator, context);
                        },
                        
                        all: function(iterator, context) {
                        iterator = iterator || Prototype.K;
                        var result = true;
                        this.each(function(value, index) {
                        result = result && !!iterator.call(context, value, index);
                        if (!result) throw $break;
                        });
                        return result;
                        },
                        
                        any: function(iterator, context) {
                        iterator = iterator || Prototype.K;
                        var result = false;
                        this.each(function(value, index) {
                        if (result = !!iterator.call(context, value, index))
                        throw $break;
                        });
                        return result;
                        },
                        
                        collect: function(iterator, context) {
                        iterator = iterator || Prototype.K;
                        var results = [];
                        this.each(function(value, index) {
                        results.push(iterator.call(context, value, index));
                        });
                        return results;
                        },
                        
                        detect: function(iterator, context) {
                        var result;
                        this.each(function(value, index) {
                        if (iterator.call(context, value, index)) {
                        result = value;
                        throw $break;
                        }
                        });
                        return result;
                        },
                        
                        findAll: function(iterator, context) {
                        var results = [];
                        this.each(function(value, index) {
                        if (iterator.call(context, value, index))
                        results.push(value);
                        });
                        return results;
                        },
                        
                        grep: function(filter, iterator, context) {
                        iterator = iterator || Prototype.K;
                        var results = [];
                        
                        if (Object.isString(filter))
                        filter = new RegExp(filter);
                        
                        this.each(function(value, index) {
                        if (filter.match(value))
                        results.push(iterator.call(context, value, index));
                        });
                        return results;
                        },
                        
                        include: function(object) {
                        if (Object.isFunction(this.indexOf))
                        if (this.indexOf(object) != -1) return true;
                        
                        var found = false;
                        this.each(function(value) {
                        if (value == object) {
                        found = true;
                        throw $break;
                        }
                        });
                        return found;
                        },
                        
                        inGroupsOf: function(number, fillWith) {
                        fillWith = Object.isUndefined(fillWith) ? null : fillWith;
                        return this.eachSlice(number, function(slice) {
                        while(slice.length < number) slice.push(fillWith);
                        return slice;
                        });
                        },
                        
                        inject: function(memo, iterator, context) {
                        this.each(function(value, index) {
                        memo = iterator.call(context, memo, value, index);
                        });
                        return memo;
                        },
                        
                        invoke: function(method) {
                        var args = $A(arguments).slice(1);
                        return this.map(function(value) {
                        return value[method].apply(value, args);
                        });
                        },
                        
                        max: function(iterator, context) {
                        iterator = iterator || Prototype.K;
                        var result;
                        this.each(function(value, index) {
                        value = iterator.call(context, value, index);
                        if (result == null || value >= result)
                        result = value;
                        });
                        return result;
                        },
                        
                        min: function(iterator, context) {
                        iterator = iterator || Prototype.K;
                        var result;
                        this.each(function(value, index) {
                        value = iterator.call(context, value, index);
                        if (result == null || value < result)
                            result = value;
                            });
                            return result;
                            },
                            
                            partition: function(iterator, context) {
                            iterator = iterator || Prototype.K;
                            var trues = [], falses = [];
                            this.each(function(value, index) {
                            (iterator.call(context, value, index) ?
                            trues : falses).push(value);
                            });
                            return [trues, falses];
                            },
                            
                            pluck: function(property) {
                            var results = [];
                            this.each(function(value) {
                            results.push(value[property]);
                            });
                            return results;
                            },
                            
                            reject: function(iterator, context) {
                            var results = [];
                            this.each(function(value, index) {
                            if (!iterator.call(context, value, index))
                            results.push(value);
                            });
                            return results;
                            },
                            
                            sortBy: function(iterator, context) {
                            return this.map(function(value, index) {
                            return {
                            value: value,
                            criteria: iterator.call(context, value, index)
                            };
                            }).sort(function(left, right) {
                            var a = left.criteria, b = right.criteria;
                            return a < b ? -1 : a > b ? 1 : 0;
                            }).pluck('value');
                            },
                            
                            toArray: function() {
                            return this.map();
                            },
                            
                            zip: function() {
                            var iterator = Prototype.K, args = $A(arguments);
                            if (Object.isFunction(args.last()))
                            iterator = args.pop();
                            
                            var collections = [this].concat(args).map($A);
                            return this.map(function(value, index) {
                            return iterator(collections.pluck(index));
                            });
                            },
                            
                            size: function() {
                            return this.toArray().length;
                            },
                            
                            inspect: function() {
                            return '#<Enumerable:' + this.toArray().inspect() + '>';
                                }
                                };
                                
                                Object.extend(Enumerable, {
                                map:     Enumerable.collect,
                                find:    Enumerable.detect,
                                select:  Enumerable.findAll,
                                filter:  Enumerable.findAll,
                                member:  Enumerable.include,
                                entries: Enumerable.toArray,
                                every:   Enumerable.all,
                                some:    Enumerable.any
                                });
                                function $A(iterable) {
                                if (!iterable) return [];
                                if (iterable.toArray) return iterable.toArray();
                                var length = iterable.length || 0, results = new Array(length);
                                while (length--) results[length] = iterable[length];
                                return results;
                                }
                                
                                if (Prototype.Browser.WebKit) {
                                $A = function(iterable) {
                                if (!iterable) return [];
                                // In Safari, only use the `toArray` method if it's not a NodeList.
                                // A NodeList is a function, has an function `item` property, and a numeric
                                // `length` property. Adapted from Google Doctype.
                                if (!(typeof iterable === 'function' && typeof iterable.length ===
                                'number' && typeof iterable.item === 'function') && iterable.toArray)
                                return iterable.toArray();
                                var length = iterable.length || 0, results = new Array(length);
                                while (length--) results[length] = iterable[length];
                                return results;
                                };
                                }
                                
                                Array.from = $A;
                                
                                Object.extend(Array.prototype, Enumerable);
                                
                                if (!Array.prototype._reverse) Array.prototype._reverse = Array.prototype.reverse;
                                
                                Object.extend(Array.prototype, {
                                _each: function(iterator) {
                                for (var i = 0, length = this.length; i < length; i++)
                                    iterator(this[i]);
                                    },
                                    
                                    clear: function() {
                                    this.length = 0;
                                    return this;
                                    },
                                    
                                    first: function() {
                                    return this[0];
                                    },
                                    
                                    last: function() {
                                    return this[this.length - 1];
                                    },
                                    
                                    compact: function() {
                                    return this.select(function(value) {
                                    return value != null;
                                    });
                                    },
                                    
                                    flatten: function() {
                                    return this.inject([], function(array, value) {
                                    return array.concat(Object.isArray(value) ?
                                    value.flatten() : [value]);
                                    });
                                    },
                                    
                                    without: function() {
                                    var values = $A(arguments);
                                    return this.select(function(value) {
                                    return !values.include(value);
                                    });
                                    },
                                    
                                    reverse: function(inline) {
                                    return (inline !== false ? this : this.toArray())._reverse();
                                    },
                                    
                                    reduce: function() {
                                    return this.length > 1 ? this : this[0];
                                    },
                                    
                                    uniq: function(sorted) {
                                    return this.inject([], function(array, value, index) {
                                    if (0 == index || (sorted ? array.last() != value : !array.include(value)))
                                    array.push(value);
                                    return array;
                                    });
                                    },
                                    
                                    intersect: function(array) {
                                    return this.uniq().findAll(function(item) {
                                    return array.detect(function(value) { return item === value });
                                    });
                                    },
                                    
                                    clone: function() {
                                    return [].concat(this);
                                    },
                                    
                                    size: function() {
                                    return this.length;
                                    },
                                    
                                    inspect: function() {
                                    return '[' + this.map(Object.inspect).join(', ') + ']';
                                    },
                                    
                                    toJSON: function() {
                                    var results = [];
                                    this.each(function(object) {
                                    var value = Object.toJSON(object);
                                    if (!Object.isUndefined(value)) results.push(value);
                                    });
                                    return '[' + results.join(', ') + ']';
                                    }
                                    });
                                    
                                    // use native browser JS 1.6 implementation if available
                                    if (Object.isFunction(Array.prototype.forEach))
                                    Array.prototype._each = Array.prototype.forEach;
                                    
                                    if (!Array.prototype.indexOf) Array.prototype.indexOf = function(item, i) {
                                    i || (i = 0);
                                    var length = this.length;
                                    if (i < 0) i = length + i;
                                        for (; i < length; i++)
                                        if (this[i] === item) return i;
                                        return -1;
                                        };
                                        
                                        if (!Array.prototype.lastIndexOf) Array.prototype.lastIndexOf = function(item, i) {
                                        i = isNaN(i) ? this.length : (i < 0 ? this.length + i : i) + 1;
                                        var n = this.slice(0, i).reverse().indexOf(item);
                                        return (n < 0) ? n : i - n - 1;
                                        };
                                        
                                        Array.prototype.toArray = Array.prototype.clone;
                                        
                                        function $w(string) {
                                        if (!Object.isString(string)) return [];
                                        string = string.strip();
                                        return string ? string.split(/\s+/) : [];
                                        }
                                        
                                        if (Prototype.Browser.Opera){
                                        Array.prototype.concat = function() {
                                        var array = [];
                                        for (var i = 0, length = this.length; i < length; i++) array.push(this[i]);
                                        for (var i = 0, length = arguments.length; i < length; i++) {
                                        if (Object.isArray(arguments[i])) {
                                        for (var j = 0, arrayLength = arguments[i].length; j < arrayLength; j++)
                                        array.push(arguments[i][j]);
                                        } else {
                                        array.push(arguments[i]);
                                        }
                                        }
                                        return array;
                                        };
                                        }
                                        Object.extend(Number.prototype, {
                                        toColorPart: function() {
                                        return this.toPaddedString(2, 16);
                                        },
                                        
                                        succ: function() {
                                        return this + 1;
                                        },
                                        
                                        times: function(iterator, context) {
                                        $R(0, this, true).each(iterator, context);
                                        return this;
                                        },
                                        
                                        toPaddedString: function(length, radix) {
                                        var string = this.toString(radix || 10);
                                        return '0'.times(length - string.length) + string;
                                        },
                                        
                                        toJSON: function() {
                                        return isFinite(this) ? this.toString() : 'null';
                                        }
                                        });
                                        
                                        $w('abs round ceil floor').each(function(method){
                                        Number.prototype[method] = Math[method].methodize();
                                        });
                                        function $H(object) {
                                        return new Hash(object);
                                        };
                                        
                                        var Hash = Class.create(Enumerable, (function() {
                                        
                                        function toQueryPair(key, value) {
                                        if (Object.isUndefined(value)) return key;
                                        return key + '=' + encodeURIComponent(String.interpret(value));
                                        }
                                        
                                        return {
                                        initialize: function(object) {
                                        this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);
                                        },
                                        
                                        _each: function(iterator) {
                                        for (var key in this._object) {
                                        var value = this._object[key], pair = [key, value];
                                        pair.key = key;
                                        pair.value = value;
                                        iterator(pair);
                                        }
                                        },
                                        
                                        set: function(key, value) {
                                        return this._object[key] = value;
                                        },
                                        
                                        get: function(key) {
                                        // simulating poorly supported hasOwnProperty
                                        if (this._object[key] !== Object.prototype[key])
                                        return this._object[key];
                                        },
                                        
                                        unset: function(key) {
                                        var value = this._object[key];
                                        delete this._object[key];
                                        return value;
                                        },
                                        
                                        toObject: function() {
                                        return Object.clone(this._object);
                                        },
                                        
                                        keys: function() {
                                        return this.pluck('key');
                                        },
                                        
                                        values: function() {
                                        return this.pluck('value');
                                        },
                                        
                                        index: function(value) {
                                        var match = this.detect(function(pair) {
                                        return pair.value === value;
                                        });
                                        return match && match.key;
                                        },
                                        
                                        merge: function(object) {
                                        return this.clone().update(object);
                                        },
                                        
                                        update: function(object) {
                                        return new Hash(object).inject(this, function(result, pair) {
                                        result.set(pair.key, pair.value);
                                        return result;
                                        });
                                        },
                                        
                                        toQueryString: function() {
                                        return this.inject([], function(results, pair) {
                                        var key = encodeURIComponent(pair.key), values = pair.value;
                                        
                                        if (values && typeof values == 'object') {
                                        if (Object.isArray(values))
                                        return results.concat(values.map(toQueryPair.curry(key)));
                                        } else results.push(toQueryPair(key, values));
                                        return results;
                                        }).join('&');
                                        },
                                        
                                        inspect: function() {
                                        return '#<Hash:{' + this.map(function(pair) {
                                        return pair.map(Object.inspect).join(': ');
                                        }).join(', ') + '}>';
                                        },
                                        
                                        toJSON: function() {
                                        return Object.toJSON(this.toObject());
                                        },
                                        
                                        clone: function() {
                                        return new Hash(this);
                                        }
                                        }
                                        })());
                                        
                                        Hash.prototype.toTemplateReplacements = Hash.prototype.toObject;
                                        Hash.from = $H;
                                        var ObjectRange = Class.create(Enumerable, {
                                        initialize: function(start, end, exclusive) {
                                        this.start = start;
                                        this.end = end;
                                        this.exclusive = exclusive;
                                        },
                                        
                                        _each: function(iterator) {
                                        var value = this.start;
                                        while (this.include(value)) {
                                        iterator(value);
                                        value = value.succ();
                                        }
                                        },
                                        
                                        include: function(value) {
                                        if (value < this.start)
                                        return false;
                                        if (this.exclusive)
                                        return value < this.end;
                                        return value <= this.end;
                                        }
                                        });
                                        
                                        var $R = function(start, end, exclusive) {
                                        return new ObjectRange(start, end, exclusive);
                                        };
                                        
                                        var Ajax = {
                                        getTransport: function() {
                                        return Try.these(
                                        function() {return new XMLHttpRequest()},
                                        function() {return new ActiveXObject('Msxml2.XMLHTTP')},
                                        function() {return new ActiveXObject('Microsoft.XMLHTTP')}
                                        ) || false;
                                        },
                                        
                                        activeRequestCount: 0
                                        };
                                        
                                        Ajax.Responders = {
                                        responders: [],
                                        
                                        _each: function(iterator) {
                                        this.responders._each(iterator);
                                        },
                                        
                                        register: function(responder) {
                                        if (!this.include(responder))
                                        this.responders.push(responder);
                                        },
                                        
                                        unregister: function(responder) {
                                        this.responders = this.responders.without(responder);
                                        },
                                        
                                        dispatch: function(callback, request, transport, json) {
                                        this.each(function(responder) {
                                        if (Object.isFunction(responder[callback])) {
                                        try {
                                        responder[callback].apply(responder, [request, transport, json]);
                                        } catch (e) { }
                                        }
                                        });
                                        }
                                        };
                                        
                                        Object.extend(Ajax.Responders, Enumerable);
                                        
                                        Ajax.Responders.register({
                                        onCreate:   function() { Ajax.activeRequestCount++ },
                                        onComplete: function() { Ajax.activeRequestCount-- }
                                        });
                                        
                                        Ajax.Base = Class.create({
                                        initialize: function(options) {
                                        this.options = {
                                        method:       'post',
                                        asynchronous: true,
                                        contentType:  'application/x-www-form-urlencoded',
                                        encoding:     'UTF-8',
                                        parameters:   '',
                                        evalJSON:     true,
                                        evalJS:       true
                                        };
                                        Object.extend(this.options, options || { });
                                        
                                        this.options.method = this.options.method.toLowerCase();
                                        
                                        if (Object.isString(this.options.parameters))
                                        this.options.parameters = this.options.parameters.toQueryParams();
                                        else if (Object.isHash(this.options.parameters))
                                        this.options.parameters = this.options.parameters.toObject();
                                        }
                                        });
                                        
                                        Ajax.Request = Class.create(Ajax.Base, {
                                        _complete: false,
                                        
                                        initialize: function($super, url, options) {
                                        $super(options);
                                        this.transport = Ajax.getTransport();
                                        this.request(url);
                                        },
                                        
                                        request: function(url) {
                                        this.url = url;
                                        this.method = this.options.method;
                                        var params = Object.clone(this.options.parameters);
                                        
                                        if (!['get', 'post'].include(this.method)) {
                                        // simulate other verbs over post
                                        params['_method'] = this.method;
                                        this.method = 'post';
                                        }
                                        
                                        this.parameters = params;
                                        
                                        if (params = Object.toQueryString(params)) {
                                        // when GET, append parameters to URL
                                        if (this.method == 'get')
                                        this.url += (this.url.include('?') ? '&' : '?') + params;
                                        else if (/Konqueror|Safari|KHTML/.test(navigator.userAgent))
                                        params += '&_=';
                                        }
                                        
                                        try {
                                        var response = new Ajax.Response(this);
                                        if (this.options.onCreate) this.options.onCreate(response);
                                        Ajax.Responders.dispatch('onCreate', this, response);
                                        
                                        this.transport.open(this.method.toUpperCase(), this.url,
                                        this.options.asynchronous);
                                        
                                        if (this.options.asynchronous) this.respondToReadyState.bind(this).defer(1);
                                        
                                        this.transport.onreadystatechange = this.onStateChange.bind(this);
                                        this.setRequestHeaders();
                                        
                                        this.body = this.method == 'post' ? (this.options.postBody || params) : null;
                                        this.transport.send(this.body);
                                        
                                        /* Force Firefox to handle ready state 4 for synchronous requests */
                                        if (!this.options.asynchronous && this.transport.overrideMimeType)
                                        this.onStateChange();
                                        
                                        }
                                        catch (e) {
                                        this.dispatchException(e);
                                        }
                                        },
                                        
                                        onStateChange: function() {
                                        var readyState = this.transport.readyState;
                                        if (readyState > 1 && !((readyState == 4) && this._complete))
                                        this.respondToReadyState(this.transport.readyState);
                                        },
                                        
                                        setRequestHeaders: function() {
                                        var headers = {
                                        'X-Requested-With': 'XMLHttpRequest',
                                        'X-Prototype-Version': Prototype.Version,
                                        'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
                                        };
                                        
                                        if (this.method == 'post') {
                                        headers['Content-type'] = this.options.contentType +
                                        (this.options.encoding ? '; charset=' + this.options.encoding : '');
                                        
                                        /* Force "Connection: close" for older Mozilla browsers to work
                                        * around a bug where XMLHttpRequest sends an incorrect
                                        * Content-length header. See Mozilla Bugzilla #246651.
                                        */
                                        if (this.transport.overrideMimeType &&
                                        (navigator.userAgent.match(/Gecko\/(\d{4})/) || [0,2005])[1] < 2005)
                                        headers['Connection'] = 'close';
                                        }
                                        
                                        // user-defined headers
                                        if (typeof this.options.requestHeaders == 'object') {
                                        var extras = this.options.requestHeaders;
                                        
                                        if (Object.isFunction(extras.push))
                                        for (var i = 0, length = extras.length; i < length; i += 2)
                                            headers[extras[i]] = extras[i+1];
                                            else
                                            $H(extras).each(function(pair) { headers[pair.key] = pair.value });
                                            }
                                            
                                            for (var name in headers)
                                            this.transport.setRequestHeader(name, headers[name]);
                                            },
                                            
                                            success: function() {
                                            var status = this.getStatus();
                                            return !status || (status >= 200 && status < 300);
                                            },
                                            
                                            getStatus: function() {
                                            try {
                                            return this.transport.status || 0;
                                            } catch (e) { return 0 }
                                            },
                                            
                                            respondToReadyState: function(readyState) {
                                            var state = Ajax.Request.Events[readyState], response = new Ajax.Response(this);
                                            
                                            if (state == 'Complete') {
                                            try {
                                            this._complete = true;
                                            (this.options['on' + response.status]
                                            || this.options['on' + (this.success() ? 'Success' : 'Failure')]
                                            || Prototype.emptyFunction)(response, response.headerJSON);
                                            } catch (e) {
                                            this.dispatchException(e);
                                            }
                                            
                                            var contentType = response.getHeader('Content-type');
                                            if (this.options.evalJS == 'force'
                                            || (this.options.evalJS && this.isSameOrigin() && contentType
                                            && contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
                                            this.evalResponse();
                                            }
                                            
                                            try {
                                            (this.options['on' + state] || Prototype.emptyFunction)(response, response.headerJSON);
                                            Ajax.Responders.dispatch('on' + state, this, response, response.headerJSON);
                                            } catch (e) {
                                            this.dispatchException(e);
                                            }
                                            
                                            if (state == 'Complete') {
                                            // avoid memory leak in MSIE: clean up
                                            this.transport.onreadystatechange = Prototype.emptyFunction;
                                            }
                                            },
                                            
                                            isSameOrigin: function() {
                                            var m = this.url.match(/^\s*https?:\/\/[^\/]*/);
                                            return !m || (m[0] == '#{protocol}//#{domain}#{port}'.interpolate({
                                            protocol: location.protocol,
                                            domain: document.domain,
                                            port: location.port ? ':' + location.port : ''
                                            }));
                                            },
                                            
                                            getHeader: function(name) {
                                            try {
                                            return this.transport.getResponseHeader(name) || null;
                                            } catch (e) { return null }
                                            },
                                            
                                            evalResponse: function() {
                                            try {
                                            return eval((this.transport.responseText || '').unfilterJSON());
                                            } catch (e) {
                                            this.dispatchException(e);
                                            }
                                            },
                                            
                                            dispatchException: function(exception) {
                                            (this.options.onException || Prototype.emptyFunction)(this, exception);
                                            Ajax.Responders.dispatch('onException', this, exception);
                                            }
                                            });
                                            
                                            Ajax.Request.Events =
                                            ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete'];
                                            
                                            Ajax.Response = Class.create({
                                            initialize: function(request){
                                            this.request = request;
                                            var transport  = this.transport  = request.transport,
                                            readyState = this.readyState = transport.readyState;
                                            
                                            if((readyState > 2 && !Prototype.Browser.IE) || readyState == 4) {
                                            this.status       = this.getStatus();
                                            this.statusText   = this.getStatusText();
                                            this.responseText = String.interpret(transport.responseText);
                                            this.headerJSON   = this._getHeaderJSON();
                                            }
                                            
                                            if(readyState == 4) {
                                            var xml = transport.responseXML;
                                            this.responseXML  = Object.isUndefined(xml) ? null : xml;
                                            this.responseJSON = this._getResponseJSON();
                                            }
                                            },
                                            
                                            status:      0,
                                            statusText: '',
                                            
                                            getStatus: Ajax.Request.prototype.getStatus,
                                            
                                            getStatusText: function() {
                                            try {
                                            return this.transport.statusText || '';
                                            } catch (e) { return '' }
                                            },
                                            
                                            getHeader: Ajax.Request.prototype.getHeader,
                                            
                                            getAllHeaders: function() {
                                            try {
                                            return this.getAllResponseHeaders();
                                            } catch (e) { return null }
                                            },
                                            
                                            getResponseHeader: function(name) {
                                            return this.transport.getResponseHeader(name);
                                            },
                                            
                                            getAllResponseHeaders: function() {
                                            return this.transport.getAllResponseHeaders();
                                            },
                                            
                                            _getHeaderJSON: function() {
                                            var json = this.getHeader('X-JSON');
                                            if (!json) return null;
                                            json = decodeURIComponent(escape(json));
                                            try {
                                            return json.evalJSON(this.request.options.sanitizeJSON ||
                                            !this.request.isSameOrigin());
                                            } catch (e) {
                                            this.request.dispatchException(e);
                                            }
                                            },
                                            
                                            _getResponseJSON: function() {
                                            var options = this.request.options;
                                            if (!options.evalJSON || (options.evalJSON != 'force' &&
                                            !(this.getHeader('Content-type') || '').include('application/json')) ||
                                            this.responseText.blank())
                                            return null;
                                            try {
                                            return this.responseText.evalJSON(options.sanitizeJSON ||
                                            !this.request.isSameOrigin());
                                            } catch (e) {
                                            this.request.dispatchException(e);
                                            }
                                            }
                                            });
                                            
                                            Ajax.Updater = Class.create(Ajax.Request, {
                                            initialize: function($super, container, url, options) {
                                            this.container = {
                                            success: (container.success || container),
                                            failure: (container.failure || (container.success ? null : container))
                                            };
                                            
                                            options = Object.clone(options);
                                            var onComplete = options.onComplete;
                                            options.onComplete = (function(response, json) {
                                            this.updateContent(response.responseText);
                                            if (Object.isFunction(onComplete)) onComplete(response, json);
                                            }).bind(this);
                                            
                                            $super(url, options);
                                            },
                                            
                                            updateContent: function(responseText) {
                                            var receiver = this.container[this.success() ? 'success' : 'failure'],
                                            options = this.options;
                                            
                                            if (!options.evalScripts) responseText = responseText.stripScripts();
                                            
                                            if (receiver = $(receiver)) {
                                            if (options.insertion) {
                                            if (Object.isString(options.insertion)) {
                                            var insertion = { }; insertion[options.insertion] = responseText;
                                            receiver.insert(insertion);
                                            }
                                            else options.insertion(receiver, responseText);
                                            }
                                            else receiver.update(responseText);
                                            }
                                            }
                                            });
                                            
                                            Ajax.PeriodicalUpdater = Class.create(Ajax.Base, {
                                            initialize: function($super, container, url, options) {
                                            $super(options);
                                            this.onComplete = this.options.onComplete;
                                            
                                            this.frequency = (this.options.frequency || 2);
                                            this.decay = (this.options.decay || 1);
                                            
                                            this.updater = { };
                                            this.container = container;
                                            this.url = url;
                                            
                                            this.start();
                                            },
                                            
                                            start: function() {
                                            this.options.onComplete = this.updateComplete.bind(this);
                                            this.onTimerEvent();
                                            },
                                            
                                            stop: function() {
                                            this.updater.options.onComplete = undefined;
                                            clearTimeout(this.timer);
                                            (this.onComplete || Prototype.emptyFunction).apply(this, arguments);
                                            },
                                            
                                            updateComplete: function(response) {
                                            if (this.options.decay) {
                                            this.decay = (response.responseText == this.lastText ?
                                            this.decay * this.options.decay : 1);
                                            
                                            this.lastText = response.responseText;
                                            }
                                            this.timer = this.onTimerEvent.bind(this).delay(this.decay * this.frequency);
                                            },
                                            
                                            onTimerEvent: function() {
                                            this.updater = new Ajax.Updater(this.container, this.url, this.options);
                                            }
                                            });
                                            function $(element) {
                                            if (arguments.length > 1) {
                                            for (var i = 0, elements = [], length = arguments.length; i < length; i++)
                                                elements.push($(arguments[i]));
                                                return elements;
                                                }
                                                if (Object.isString(element))
                                                element = document.getElementById(element);
                                                return Element.extend(element);
                                                }
                                                
                                                if (Prototype.BrowserFeatures.XPath) {
                                                document._getElementsByXPath = function(expression, parentElement) {
                                                var results = [];
                                                var query = document.evaluate(expression, $(parentElement) || document,
                                                null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
                                                for (var i = 0, length = query.snapshotLength; i < length; i++)
                                                results.push(Element.extend(query.snapshotItem(i)));
                                                return results;
                                                };
                                                }
                                                
                                                /*--------------------------------------------------------------------------*/
                                                
                                                if (!window.Node) var Node = { };
                                                
                                                if (!Node.ELEMENT_NODE) {
                                                // DOM level 2 ECMAScript Language Binding
                                                Object.extend(Node, {
                                                ELEMENT_NODE: 1,
                                                ATTRIBUTE_NODE: 2,
                                                TEXT_NODE: 3,
                                                CDATA_SECTION_NODE: 4,
                                                ENTITY_REFERENCE_NODE: 5,
                                                ENTITY_NODE: 6,
                                                PROCESSING_INSTRUCTION_NODE: 7,
                                                COMMENT_NODE: 8,
                                                DOCUMENT_NODE: 9,
                                                DOCUMENT_TYPE_NODE: 10,
                                                DOCUMENT_FRAGMENT_NODE: 11,
                                                NOTATION_NODE: 12
                                                });
                                                }
                                                
                                                (function() {
                                                var element = this.Element;
                                                this.Element = function(tagName, attributes) {
                                                attributes = attributes || { };
                                                tagName = tagName.toLowerCase();
                                                var cache = Element.cache;
                                                if (Prototype.Browser.IE && attributes.name) {
                                                tagName = '<' + tagName + ' name="' + attributes.name + '">';
                                                delete attributes.name;
                                                return Element.writeAttribute(document.createElement(tagName), attributes);
                                                }
                                                if (!cache[tagName]) cache[tagName] = Element.extend(document.createElement(tagName));
                                                return Element.writeAttribute(cache[tagName].cloneNode(false), attributes);
                                                };
                                                Object.extend(this.Element, element || { });
                                                if (element) this.Element.prototype = element.prototype;
                                                }).call(window);
                                                
                                                Element.cache = { };
                                                
                                                Element.Methods = {
                                                visible: function(element) {
                                                return $(element).style.display != 'none';
                                                },
                                                
                                                toggle: function(element) {
                                                element = $(element);
                                                Element[Element.visible(element) ? 'hide' : 'show'](element);
                                                return element;
                                                },
                                                
                                                hide: function(element) {
                                                element = $(element);
                                                element.style.display = 'none';
                                                return element;
                                                },
                                                
                                                show: function(element) {
                                                element = $(element);
                                                element.style.display = '';
                                                return element;
                                                },
                                                
                                                remove: function(element) {
                                                element = $(element);
                                                element.parentNode.removeChild(element);
                                                return element;
                                                },
                                                
                                                update: function(element, content) {
                                                element = $(element);
                                                if (content && content.toElement) content = content.toElement();
                                                if (Object.isElement(content)) return element.update().insert(content);
                                                content = Object.toHTML(content);
                                                element.innerHTML = content.stripScripts();
                                                content.evalScripts.bind(content).defer();
                                                return element;
                                                },
                                                
                                                replace: function(element, content) {
                                                element = $(element);
                                                if (content && content.toElement) content = content.toElement();
                                                else if (!Object.isElement(content)) {
                                                content = Object.toHTML(content);
                                                var range = element.ownerDocument.createRange();
                                                range.selectNode(element);
                                                content.evalScripts.bind(content).defer();
                                                content = range.createContextualFragment(content.stripScripts());
                                                }
                                                element.parentNode.replaceChild(content, element);
                                                return element;
                                                },
                                                
                                                insert: function(element, insertions) {
                                                element = $(element);
                                                
                                                if (Object.isString(insertions) || Object.isNumber(insertions) ||
                                                Object.isElement(insertions) || (insertions && (insertions.toElement || insertions.toHTML)))
                                                insertions = {bottom:insertions};
                                                
                                                var content, insert, tagName, childNodes;
                                                
                                                for (var position in insertions) {
                                                content  = insertions[position];
                                                position = position.toLowerCase();
                                                insert = Element._insertionTranslations[position];
                                                
                                                if (content && content.toElement) content = content.toElement();
                                                if (Object.isElement(content)) {
                                                insert(element, content);
                                                continue;
                                                }
                                                
                                                content = Object.toHTML(content);
                                                
                                                tagName = ((position == 'before' || position == 'after')
                                                ? element.parentNode : element).tagName.toUpperCase();
                                                
                                                childNodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts());
                                                
                                                if (position == 'top' || position == 'after') childNodes.reverse();
                                                childNodes.each(insert.curry(element));
                                                
                                                content.evalScripts.bind(content).defer();
                                                }
                                                
                                                return element;
                                                },
                                                
                                                wrap: function(element, wrapper, attributes) {
                                                element = $(element);
                                                if (Object.isElement(wrapper))
                                                $(wrapper).writeAttribute(attributes || { });
                                                else if (Object.isString(wrapper)) wrapper = new Element(wrapper, attributes);
                                                else wrapper = new Element('div', wrapper);
                                                if (element.parentNode)
                                                element.parentNode.replaceChild(wrapper, element);
                                                wrapper.appendChild(element);
                                                return wrapper;
                                                },
                                                
                                                inspect: function(element) {
                                                element = $(element);
                                                var result = '<' + element.tagName.toLowerCase();
                                                $H({'id': 'id', 'className': 'class'}).each(function(pair) {
                                                var property = pair.first(), attribute = pair.last();
                                                var value = (element[property] || '').toString();
                                                if (value) result += ' ' + attribute + '=' + value.inspect(true);
                                                });
                                                return result + '>';
                                                },
                                                
                                                recursivelyCollect: function(element, property) {
                                                element = $(element);
                                                var elements = [];
                                                while (element = element[property])
                                                if (element.nodeType == 1)
                                                elements.push(Element.extend(element));
                                                return elements;
                                                },
                                                
                                                ancestors: function(element) {
                                                return $(element).recursivelyCollect('parentNode');
                                                },
                                                
                                                descendants: function(element) {
                                                return $(element).select("*");
                                                },
                                                
                                                firstDescendant: function(element) {
                                                element = $(element).firstChild;
                                                while (element && element.nodeType != 1) element = element.nextSibling;
                                                return $(element);
                                                },
                                                
                                                immediateDescendants: function(element) {
                                                if (!(element = $(element).firstChild)) return [];
                                                while (element && element.nodeType != 1) element = element.nextSibling;
                                                if (element) return [element].concat($(element).nextSiblings());
                                                return [];
                                                },
                                                
                                                previousSiblings: function(element) {
                                                return $(element).recursivelyCollect('previousSibling');
                                                },
                                                
                                                nextSiblings: function(element) {
                                                return $(element).recursivelyCollect('nextSibling');
                                                },
                                                
                                                siblings: function(element) {
                                                element = $(element);
                                                return element.previousSiblings().reverse().concat(element.nextSiblings());
                                                },
                                                
                                                match: function(element, selector) {
                                                if (Object.isString(selector))
                                                selector = new Selector(selector);
                                                return selector.match($(element));
                                                },
                                                
                                                up: function(element, expression, index) {
                                                element = $(element);
                                                if (arguments.length == 1) return $(element.parentNode);
                                                var ancestors = element.ancestors();
                                                return Object.isNumber(expression) ? ancestors[expression] :
                                                Selector.findElement(ancestors, expression, index);
                                                },
                                                
                                                down: function(element, expression, index) {
                                                element = $(element);
                                                if (arguments.length == 1) return element.firstDescendant();
                                                return Object.isNumber(expression) ? element.descendants()[expression] :
                                                Element.select(element, expression)[index || 0];
                                                },
                                                
                                                previous: function(element, expression, index) {
                                                element = $(element);
                                                if (arguments.length == 1) return $(Selector.handlers.previousElementSibling(element));
                                                var previousSiblings = element.previousSiblings();
                                                return Object.isNumber(expression) ? previousSiblings[expression] :
                                                Selector.findElement(previousSiblings, expression, index);
                                                },
                                                
                                                next: function(element, expression, index) {
                                                element = $(element);
                                                if (arguments.length == 1) return $(Selector.handlers.nextElementSibling(element));
                                                var nextSiblings = element.nextSiblings();
                                                return Object.isNumber(expression) ? nextSiblings[expression] :
                                                Selector.findElement(nextSiblings, expression, index);
                                                },
                                                
                                                select: function() {
                                                var args = $A(arguments), element = $(args.shift());
                                                return Selector.findChildElements(element, args);
                                                },
                                                
                                                adjacent: function() {
                                                var args = $A(arguments), element = $(args.shift());
                                                return Selector.findChildElements(element.parentNode, args).without(element);
                                                },
                                                
                                                identify: function(element) {
                                                element = $(element);
                                                var id = element.readAttribute('id'), self = arguments.callee;
                                                if (id) return id;
                                                do { id = 'anonymous_element_' + self.counter++ } while ($(id));
                                                element.writeAttribute('id', id);
                                                return id;
                                                },
                                                
                                                readAttribute: function(element, name) {
                                                element = $(element);
                                                if (Prototype.Browser.IE) {
                                                var t = Element._attributeTranslations.read;
                                                if (t.values[name]) return t.values[name](element, name);
                                                if (t.names[name]) name = t.names[name];
                                                if (name.include(':')) {
                                                return (!element.attributes || !element.attributes[name]) ? null :
                                                element.attributes[name].value;
                                                }
                                                }
                                                return element.getAttribute(name);
                                                },
                                                
                                                writeAttribute: function(element, name, value) {
                                                element = $(element);
                                                var attributes = { }, t = Element._attributeTranslations.write;
                                                
                                                if (typeof name == 'object') attributes = name;
                                                else attributes[name] = Object.isUndefined(value) ? true : value;
                                                
                                                for (var attr in attributes) {
                                                name = t.names[attr] || attr;
                                                value = attributes[attr];
                                                if (t.values[attr]) name = t.values[attr](element, value);
                                                if (value === false || value === null)
                                                element.removeAttribute(name);
                                                else if (value === true)
                                                element.setAttribute(name, name);
                                                else element.setAttribute(name, value);
                                                }
                                                return element;
                                                },
                                                
                                                getHeight: function(element) {
                                                return $(element).getDimensions().height;
                                                },
                                                
                                                getWidth: function(element) {
                                                return $(element).getDimensions().width;
                                                },
                                                
                                                classNames: function(element) {
                                                return new Element.ClassNames(element);
                                                },
                                                
                                                hasClassName: function(element, className) {
                                                if (!(element = $(element))) return;
                                                var elementClassName = element.className;
                                                return (elementClassName.length > 0 && (elementClassName == className ||
                                                new RegExp("(^|\\s)" + className + "(\\s|$)").test(elementClassName)));
                                                },
                                                
                                                addClassName: function(element, className) {
                                                if (!(element = $(element))) return;
                                                if (!element.hasClassName(className))
                                                element.className += (element.className ? ' ' : '') + className;
                                                return element;
                                                },
                                                
                                                removeClassName: function(element, className) {
                                                if (!(element = $(element))) return;
                                                element.className = element.className.replace(
                                                new RegExp("(^|\\s+)" + className + "(\\s+|$)"), ' ').strip();
                                                return element;
                                                },
                                                
                                                toggleClassName: function(element, className) {
                                                if (!(element = $(element))) return;
                                                return element[element.hasClassName(className) ?
                                                'removeClassName' : 'addClassName'](className);
                                                },
                                                
                                                // removes whitespace-only text node children
                                                cleanWhitespace: function(element) {
                                                element = $(element);
                                                var node = element.firstChild;
                                                while (node) {
                                                var nextNode = node.nextSibling;
                                                if (node.nodeType == 3 && !/\S/.test(node.nodeValue))
                                                element.removeChild(node);
                                                node = nextNode;
                                                }
                                                return element;
                                                },
                                                
                                                empty: function(element) {
                                                return $(element).innerHTML.blank();
                                                },
                                                
                                                descendantOf: function(element, ancestor) {
                                                element = $(element), ancestor = $(ancestor);
                                                
                                                if (element.compareDocumentPosition)
                                                return (element.compareDocumentPosition(ancestor) & 8) === 8;
                                                
                                                if (ancestor.contains)
                                                return ancestor.contains(element) && ancestor !== element;
                                                
                                                while (element = element.parentNode)
                                                if (element == ancestor) return true;
                                                
                                                return false;
                                                },
                                                
                                                scrollTo: function(element) {
                                                element = $(element);
                                                var pos = element.cumulativeOffset();
                                                window.scrollTo(pos[0], pos[1]);
                                                return element;
                                                },
                                                
                                                getStyle: function(element, style) {
                                                element = $(element);
                                                style = style == 'float' ? 'cssFloat' : style.camelize();
                                                var value = element.style[style];
                                                if (!value || value == 'auto') {
                                                var css = document.defaultView.getComputedStyle(element, null);
                                                value = css ? css[style] : null;
                                                }
                                                if (style == 'opacity') return value ? parseFloat(value) : 1.0;
                                                return value == 'auto' ? null : value;
                                                },
                                                
                                                getOpacity: function(element) {
                                                return $(element).getStyle('opacity');
                                                },
                                                
                                                setStyle: function(element, styles) {
                                                element = $(element);
                                                var elementStyle = element.style, match;
                                                if (Object.isString(styles)) {
                                                element.style.cssText += ';' + styles;
                                                return styles.include('opacity') ?
                                                element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]) : element;
                                                }
                                                for (var property in styles)
                                                if (property == 'opacity') element.setOpacity(styles[property]);
                                                else
                                                elementStyle[(property == 'float' || property == 'cssFloat') ?
                                                (Object.isUndefined(elementStyle.styleFloat) ? 'cssFloat' : 'styleFloat') :
                                                property] = styles[property];
                                                
                                                return element;
                                                },
                                                
                                                setOpacity: function(element, value) {
                                                element = $(element);
                                                element.style.opacity = (value == 1 || value === '') ? '' :
                                                (value < 0.00001) ? 0 : value;
                                                    return element;
                                                    },
                                                    
                                                    getDimensions: function(element) {
                                                    element = $(element);
                                                    var display = element.getStyle('display');
                                                    if (display != 'none' && display != null) // Safari bug
                                                    return {width: element.offsetWidth, height: element.offsetHeight};
                                                    
                                                    // All *Width and *Height properties give 0 on elements with display none,
                                                    // so enable the element temporarily
                                                    var els = element.style;
                                                    var originalVisibility = els.visibility;
                                                    var originalPosition = els.position;
                                                    var originalDisplay = els.display;
                                                    els.visibility = 'hidden';
                                                    els.position = 'absolute';
                                                    els.display = 'block';
                                                    var originalWidth = element.clientWidth;
                                                    var originalHeight = element.clientHeight;
                                                    els.display = originalDisplay;
                                                    els.position = originalPosition;
                                                    els.visibility = originalVisibility;
                                                    return {width: originalWidth, height: originalHeight};
                                                    },
                                                    
                                                    makePositioned: function(element) {
                                                    element = $(element);
                                                    var pos = Element.getStyle(element, 'position');
                                                    if (pos == 'static' || !pos) {
                                                    element._madePositioned = true;
                                                    element.style.position = 'relative';
                                                    // Opera returns the offset relative to the positioning context, when an
                                                    // element is position relative but top and left have not been defined
                                                    if (Prototype.Browser.Opera) {
                                                    element.style.top = 0;
                                                    element.style.left = 0;
                                                    }
                                                    }
                                                    return element;
                                                    },
                                                    
                                                    undoPositioned: function(element) {
                                                    element = $(element);
                                                    if (element._madePositioned) {
                                                    element._madePositioned = undefined;
                                                    element.style.position =
                                                    element.style.top =
                                                    element.style.left =
                                                    element.style.bottom =
                                                    element.style.right = '';
                                                    }
                                                    return element;
                                                    },
                                                    
                                                    makeClipping: function(element) {
                                                    element = $(element);
                                                    if (element._overflow) return element;
                                                    element._overflow = Element.getStyle(element, 'overflow') || 'auto';
                                                    if (element._overflow !== 'hidden')
                                                    element.style.overflow = 'hidden';
                                                    return element;
                                                    },
                                                    
                                                    undoClipping: function(element) {
                                                    element = $(element);
                                                    if (!element._overflow) return element;
                                                    element.style.overflow = element._overflow == 'auto' ? '' : element._overflow;
                                                    element._overflow = null;
                                                    return element;
                                                    },
                                                    
                                                    cumulativeOffset: function(element) {
                                                    var valueT = 0, valueL = 0;
                                                    do {
                                                    valueT += element.offsetTop  || 0;
                                                    valueL += element.offsetLeft || 0;
                                                    element = element.offsetParent;
                                                    } while (element);
                                                    return Element._returnOffset(valueL, valueT);
                                                    },
                                                    
                                                    positionedOffset: function(element) {
                                                    var valueT = 0, valueL = 0;
                                                    do {
                                                    valueT += element.offsetTop  || 0;
                                                    valueL += element.offsetLeft || 0;
                                                    element = element.offsetParent;
                                                    if (element) {
                                                    if (element.tagName.toUpperCase() == 'BODY') break;
                                                    var p = Element.getStyle(element, 'position');
                                                    if (p !== 'static') break;
                                                    }
                                                    } while (element);
                                                    return Element._returnOffset(valueL, valueT);
                                                    },
                                                    
                                                    absolutize: function(element) {
                                                    element = $(element);
                                                    if (element.getStyle('position') == 'absolute') return element;
                                                    // Position.prepare(); // To be done manually by Scripty when it needs it.
                                                    
                                                    var offsets = element.positionedOffset();
                                                    var top     = offsets[1];
                                                    var left    = offsets[0];
                                                    var width   = element.clientWidth;
                                                    var height  = element.clientHeight;
                                                    
                                                    element._originalLeft   = left - parseFloat(element.style.left  || 0);
                                                    element._originalTop    = top  - parseFloat(element.style.top || 0);
                                                    element._originalWidth  = element.style.width;
                                                    element._originalHeight = element.style.height;
                                                    
                                                    element.style.position = 'absolute';
                                                    element.style.top    = top + 'px';
                                                    element.style.left   = left + 'px';
                                                    element.style.width  = width + 'px';
                                                    element.style.height = height + 'px';
                                                    return element;
                                                    },
                                                    
                                                    relativize: function(element) {
                                                    element = $(element);
                                                    if (element.getStyle('position') == 'relative') return element;
                                                    // Position.prepare(); // To be done manually by Scripty when it needs it.
                                                    
                                                    element.style.position = 'relative';
                                                    var top  = parseFloat(element.style.top  || 0) - (element._originalTop || 0);
                                                    var left = parseFloat(element.style.left || 0) - (element._originalLeft || 0);
                                                    
                                                    element.style.top    = top + 'px';
                                                    element.style.left   = left + 'px';
                                                    element.style.height = element._originalHeight;
                                                    element.style.width  = element._originalWidth;
                                                    return element;
                                                    },
                                                    
                                                    cumulativeScrollOffset: function(element) {
                                                    var valueT = 0, valueL = 0;
                                                    do {
                                                    valueT += element.scrollTop  || 0;
                                                    valueL += element.scrollLeft || 0;
                                                    element = element.parentNode;
                                                    } while (element);
                                                    return Element._returnOffset(valueL, valueT);
                                                    },
                                                    
                                                    getOffsetParent: function(element) {
                                                    if (element.offsetParent) return $(element.offsetParent);
                                                    if (element == document.body) return $(element);
                                                    
                                                    while ((element = element.parentNode) && element != document.body)
                                                    if (Element.getStyle(element, 'position') != 'static')
                                                    return $(element);
                                                    
                                                    return $(document.body);
                                                    },
                                                    
                                                    viewportOffset: function(forElement) {
                                                    var valueT = 0, valueL = 0;
                                                    
                                                    var element = forElement;
                                                    do {
                                                    valueT += element.offsetTop  || 0;
                                                    valueL += element.offsetLeft || 0;
                                                    
                                                    // Safari fix
                                                    if (element.offsetParent == document.body &&
                                                    Element.getStyle(element, 'position') == 'absolute') break;
                                                    
                                                    } while (element = element.offsetParent);
                                                    
                                                    element = forElement;
                                                    do {
                                                    if (!Prototype.Browser.Opera || (element.tagName && (element.tagName.toUpperCase() == 'BODY'))) {
                                                    valueT -= element.scrollTop  || 0;
                                                    valueL -= element.scrollLeft || 0;
                                                    }
                                                    } while (element = element.parentNode);
                                                    
                                                    return Element._returnOffset(valueL, valueT);
                                                    },
                                                    
                                                    clonePosition: function(element, source) {
                                                    var options = Object.extend({
                                                    setLeft:    true,
                                                    setTop:     true,
                                                    setWidth:   true,
                                                    setHeight:  true,
                                                    offsetTop:  0,
                                                    offsetLeft: 0
                                                    }, arguments[2] || { });
                                                    
                                                    // find page position of source
                                                    source = $(source);
                                                    var p = source.viewportOffset();
                                                    
                                                    // find coordinate system to use
                                                    element = $(element);
                                                    var delta = [0, 0];
                                                    var parent = null;
                                                    // delta [0,0] will do fine with position: fixed elements,
                                                    // position:absolute needs offsetParent deltas
                                                    if (Element.getStyle(element, 'position') == 'absolute') {
                                                    parent = element.getOffsetParent();
                                                    delta = parent.viewportOffset();
                                                    }
                                                    
                                                    // correct by body offsets (fixes Safari)
                                                    if (parent == document.body) {
                                                    delta[0] -= document.body.offsetLeft;
                                                    delta[1] -= document.body.offsetTop;
                                                    }
                                                    
                                                    // set position
                                                    if (options.setLeft)   element.style.left  = (p[0] - delta[0] + options.offsetLeft) + 'px';
                                                    if (options.setTop)    element.style.top   = (p[1] - delta[1] + options.offsetTop) + 'px';
                                                    if (options.setWidth)  element.style.width = source.offsetWidth + 'px';
                                                    if (options.setHeight) element.style.height = source.offsetHeight + 'px';
                                                    return element;
                                                    }
                                                    };
                                                    
                                                    Element.Methods.identify.counter = 1;
                                                    
                                                    Object.extend(Element.Methods, {
                                                    getElementsBySelector: Element.Methods.select,
                                                    childElements: Element.Methods.immediateDescendants
                                                    });
                                                    
                                                    Element._attributeTranslations = {
                                                    write: {
                                                    names: {
                                                    className: 'class',
                                                    htmlFor:   'for'
                                                    },
                                                    values: { }
                                                    }
                                                    };
                                                    
                                                    if (Prototype.Browser.Opera) {
                                                    Element.Methods.getStyle = Element.Methods.getStyle.wrap(
                                                    function(proceed, element, style) {
                                                    switch (style) {
                                                    case 'left': case 'top': case 'right': case 'bottom':
                                                    if (proceed(element, 'position') === 'static') return null;
                                                    case 'height': case 'width':
                                                    // returns '0px' for hidden elements; we want it to return null
                                                    if (!Element.visible(element)) return null;
                                                    
                                                    // returns the border-box dimensions rather than the content-box
                                                    // dimensions, so we subtract padding and borders from the value
                                                    var dim = parseInt(proceed(element, style), 10);
                                                    
                                                    if (dim !== element['offset' + style.capitalize()])
                                                    return dim + 'px';
                                                    
                                                    var properties;
                                                    if (style === 'height') {
                                                    properties = ['border-top-width', 'padding-top',
                                                    'padding-bottom', 'border-bottom-width'];
                                                    }
                                                    else {
                                                    properties = ['border-left-width', 'padding-left',
                                                    'padding-right', 'border-right-width'];
                                                    }
                                                    return properties.inject(dim, function(memo, property) {
                                                    var val = proceed(element, property);
                                                    return val === null ? memo : memo - parseInt(val, 10);
                                                    }) + 'px';
                                                    default: return proceed(element, style);
                                                    }
                                                    }
                                                    );
                                                    
                                                    Element.Methods.readAttribute = Element.Methods.readAttribute.wrap(
                                                    function(proceed, element, attribute) {
                                                    if (attribute === 'title') return element.title;
                                                    return proceed(element, attribute);
                                                    }
                                                    );
                                                    }
                                                    
                                                    else if (Prototype.Browser.IE) {
                                                    // IE doesn't report offsets correctly for static elements, so we change them
                                                    // to "relative" to get the values, then change them back.
                                                    Element.Methods.getOffsetParent = Element.Methods.getOffsetParent.wrap(
                                                    function(proceed, element) {
                                                    element = $(element);
                                                    // IE throws an error if element is not in document
                                                    try { element.offsetParent }
                                                    catch(e) { return $(document.body) }
                                                    var position = element.getStyle('position');
                                                    if (position !== 'static') return proceed(element);
                                                    element.setStyle({ position: 'relative' });
                                                    var value = proceed(element);
                                                    element.setStyle({ position: position });
                                                    return value;
                                                    }
                                                    );
                                                    
                                                    $w('positionedOffset viewportOffset').each(function(method) {
                                                    Element.Methods[method] = Element.Methods[method].wrap(
                                                    function(proceed, element) {
                                                    element = $(element);
                                                    try { element.offsetParent }
                                                    catch(e) { return Element._returnOffset(0,0) }
                                                    var position = element.getStyle('position');
                                                    if (position !== 'static') return proceed(element);
                                                    // Trigger hasLayout on the offset parent so that IE6 reports
                                                    // accurate offsetTop and offsetLeft values for position: fixed.
                                                    var offsetParent = element.getOffsetParent();
                                                    if (offsetParent && offsetParent.getStyle('position') === 'fixed')
                                                    offsetParent.setStyle({ zoom: 1 });
                                                    element.setStyle({ position: 'relative' });
                                                    var value = proceed(element);
                                                    element.setStyle({ position: position });
                                                    return value;
                                                    }
                                                    );
                                                    });
                                                    
                                                    Element.Methods.cumulativeOffset = Element.Methods.cumulativeOffset.wrap(
                                                    function(proceed, element) {
                                                    try { element.offsetParent }
                                                    catch(e) { return Element._returnOffset(0,0) }
                                                    return proceed(element);
                                                    }
                                                    );
                                                    
                                                    Element.Methods.getStyle = function(element, style) {
                                                    element = $(element);
                                                    style = (style == 'float' || style == 'cssFloat') ? 'styleFloat' : style.camelize();
                                                    var value = element.style[style];
                                                    if (!value && element.currentStyle) value = element.currentStyle[style];
                                                    
                                                    if (style == 'opacity') {
                                                    if (value = (element.getStyle('filter') || '').match(/alpha\(opacity=(.*)\)/))
                                                    if (value[1]) return parseFloat(value[1]) / 100;
                                                    return 1.0;
                                                    }
                                                    
                                                    if (value == 'auto') {
                                                    if ((style == 'width' || style == 'height') && (element.getStyle('display') != 'none'))
                                                    return element['offset' + style.capitalize()] + 'px';
                                                    return null;
                                                    }
                                                    return value;
                                                    };
                                                    
                                                    Element.Methods.setOpacity = function(element, value) {
                                                    function stripAlpha(filter){
                                                    return filter.replace(/alpha\([^\)]*\)/gi,'');
                                                    }
                                                    element = $(element);
                                                    var currentStyle = element.currentStyle;
                                                    if ((currentStyle && !currentStyle.hasLayout) ||
                                                    (!currentStyle && element.style.zoom == 'normal'))
                                                    element.style.zoom = 1;
                                                    
                                                    var filter = element.getStyle('filter'), style = element.style;
                                                    if (value == 1 || value === '') {
                                                    (filter = stripAlpha(filter)) ?
                                                    style.filter = filter : style.removeAttribute('filter');
                                                    return element;
                                                    } else if (value < 0.00001) value = 0;
                                                    style.filter = stripAlpha(filter) +
                                                    'alpha(opacity=' + (value * 100) + ')';
                                                    return element;
                                                    };
                                                    
                                                    Element._attributeTranslations = {
                                                    read: {
                                                    names: {
                                                    'class': 'className',
                                                    'for':   'htmlFor'
                                                    },
                                                    values: {
                                                    _getAttr: function(element, attribute) {
                                                    return element.getAttribute(attribute, 2);
                                                    },
                                                    _getAttrNode: function(element, attribute) {
                                                    var node = element.getAttributeNode(attribute);
                                                    return node ? node.value : "";
                                                    },
                                                    _getEv: function(element, attribute) {
                                                    attribute = element.getAttribute(attribute);
                                                    return attribute ? attribute.toString().slice(23, -2) : null;
                                                    },
                                                    _flag: function(element, attribute) {
                                                    return $(element).hasAttribute(attribute) ? attribute : null;
                                                    },
                                                    style: function(element) {
                                                    return element.style.cssText.toLowerCase();
                                                    },
                                                    title: function(element) {
                                                    return element.title;
                                                    }
                                                    }
                                                    }
                                                    };
                                                    
                                                    Element._attributeTranslations.write = {
                                                    names: Object.extend({
                                                    cellpadding: 'cellPadding',
                                                    cellspacing: 'cellSpacing'
                                                    }, Element._attributeTranslations.read.names),
                                                    values: {
                                                    checked: function(element, value) {
                                                    element.checked = !!value;
                                                    },
                                                    
                                                    style: function(element, value) {
                                                    element.style.cssText = value ? value : '';
                                                    }
                                                    }
                                                    };
                                                    
                                                    Element._attributeTranslations.has = {};
                                                    
                                                    $w('colSpan rowSpan vAlign dateTime accessKey tabIndex ' +
                                                    'encType maxLength readOnly longDesc frameBorder').each(function(attr) {
                                                    Element._attributeTranslations.write.names[attr.toLowerCase()] = attr;
                                                    Element._attributeTranslations.has[attr.toLowerCase()] = attr;
                                                    });
                                                    
                                                    (function(v) {
                                                    Object.extend(v, {
                                                    href:        v._getAttr,
                                                    src:         v._getAttr,
                                                    type:        v._getAttr,
                                                    action:      v._getAttrNode,
                                                    disabled:    v._flag,
                                                    checked:     v._flag,
                                                    readonly:    v._flag,
                                                    multiple:    v._flag,
                                                    onload:      v._getEv,
                                                    onunload:    v._getEv,
                                                    onclick:     v._getEv,
                                                    ondblclick:  v._getEv,
                                                    onmousedown: v._getEv,
                                                    onmouseup:   v._getEv,
                                                    onmouseover: v._getEv,
                                                    onmousemove: v._getEv,
                                                    onmouseout:  v._getEv,
                                                    onfocus:     v._getEv,
                                                    onblur:      v._getEv,
                                                    onkeypress:  v._getEv,
                                                    onkeydown:   v._getEv,
                                                    onkeyup:     v._getEv,
                                                    onsubmit:    v._getEv,
                                                    onreset:     v._getEv,
                                                    onselect:    v._getEv,
                                                    onchange:    v._getEv
                                                    });
                                                    })(Element._attributeTranslations.read.values);
                                                    }
                                                    
                                                    else if (Prototype.Browser.Gecko && /rv:1\.8\.0/.test(navigator.userAgent)) {
                                                    Element.Methods.setOpacity = function(element, value) {
                                                    element = $(element);
                                                    element.style.opacity = (value == 1) ? 0.999999 :
                                                    (value === '') ? '' : (value < 0.00001) ? 0 : value;
                                                    return element;
                                                    };
                                                    }
                                                    
                                                    else if (Prototype.Browser.WebKit) {
                                                    Element.Methods.setOpacity = function(element, value) {
                                                    element = $(element);
                                                    element.style.opacity = (value == 1 || value === '') ? '' :
                                                    (value < 0.00001) ? 0 : value;
                                                    
                                                    if (value == 1)
                                                    if(element.tagName.toUpperCase() == 'IMG' && element.width) {
                                                    element.width++; element.width--;
                                                    } else try {
                                                    var n = document.createTextNode(' ');
                                                    element.appendChild(n);
                                                    element.removeChild(n);
                                                    } catch (e) { }
                                                    
                                                    return element;
                                                    };
                                                    
                                                    // Safari returns margins on body which is incorrect if the child is absolutely
                                                    // positioned.  For performance reasons, redefine Element#cumulativeOffset for
                                                    // KHTML/WebKit only.
                                                    Element.Methods.cumulativeOffset = function(element) {
                                                    var valueT = 0, valueL = 0;
                                                    do {
                                                    valueT += element.offsetTop  || 0;
                                                    valueL += element.offsetLeft || 0;
                                                    if (element.offsetParent == document.body)
                                                    if (Element.getStyle(element, 'position') == 'absolute') break;
                                                    
                                                    element = element.offsetParent;
                                                    } while (element);
                                                    
                                                    return Element._returnOffset(valueL, valueT);
                                                    };
                                                    }
                                                    
                                                    if (Prototype.Browser.IE || Prototype.Browser.Opera) {
                                                    // IE and Opera are missing .innerHTML support for TABLE-related and SELECT elements
                                                    Element.Methods.update = function(element, content) {
                                                    element = $(element);
                                                    
                                                    if (content && content.toElement) content = content.toElement();
                                                    if (Object.isElement(content)) return element.update().insert(content);
                                                    
                                                    content = Object.toHTML(content);
                                                    var tagName = element.tagName.toUpperCase();
                                                    
                                                    if (tagName in Element._insertionTranslations.tags) {
                                                    $A(element.childNodes).each(function(node) { element.removeChild(node) });
                                                    Element._getContentFromAnonymousElement(tagName, content.stripScripts())
                                                    .each(function(node) { element.appendChild(node) });
                                                    }
                                                    else element.innerHTML = content.stripScripts();
                                                    
                                                    content.evalScripts.bind(content).defer();
                                                    return element;
                                                    };
                                                    }
                                                    
                                                    if ('outerHTML' in document.createElement('div')) {
                                                    Element.Methods.replace = function(element, content) {
                                                    element = $(element);
                                                    
                                                    if (content && content.toElement) content = content.toElement();
                                                    if (Object.isElement(content)) {
                                                    element.parentNode.replaceChild(content, element);
                                                    return element;
                                                    }
                                                    
                                                    content = Object.toHTML(content);
                                                    var parent = element.parentNode, tagName = parent.tagName.toUpperCase();
                                                    
                                                    if (Element._insertionTranslations.tags[tagName]) {
                                                    var nextSibling = element.next();
                                                    var fragments = Element._getContentFromAnonymousElement(tagName, content.stripScripts());
                                                    parent.removeChild(element);
                                                    if (nextSibling)
                                                    fragments.each(function(node) { parent.insertBefore(node, nextSibling) });
                                                    else
                                                    fragments.each(function(node) { parent.appendChild(node) });
                                                    }
                                                    else element.outerHTML = content.stripScripts();
                                                    
                                                    content.evalScripts.bind(content).defer();
                                                    return element;
                                                    };
                                                    }
                                                    
                                                    Element._returnOffset = function(l, t) {
                                                    var result = [l, t];
                                                    result.left = l;
                                                    result.top = t;
                                                    return result;
                                                    };
                                                    
                                                    Element._getContentFromAnonymousElement = function(tagName, html) {
                                                    var div = new Element('div'), t = Element._insertionTranslations.tags[tagName];
                                                    if (t) {
                                                    div.innerHTML = t[0] + html + t[1];
                                                    t[2].times(function() { div = div.firstChild });
                                                    } else div.innerHTML = html;
                                                    return $A(div.childNodes);
                                                    };
                                                    
                                                    Element._insertionTranslations = {
                                                    before: function(element, node) {
                                                    element.parentNode.insertBefore(node, element);
                                                    },
                                                    top: function(element, node) {
                                                    element.insertBefore(node, element.firstChild);
                                                    },
                                                    bottom: function(element, node) {
                                                    element.appendChild(node);
                                                    },
                                                    after: function(element, node) {
                                                    element.parentNode.insertBefore(node, element.nextSibling);
                                                    },
                                                    tags: {
                                                    TABLE:  ['<table>',                '</table>',                   1],
                                                    TBODY:  ['<table><tbody>',         '</tbody></table>',           2],
                                                    TR:     ['<table><tbody><tr>',     '</tr></tbody></table>',      3],
                                                    TD:     ['<table><tbody><tr><td>', '</td></tr></tbody></table>', 4],
                                                    SELECT: ['<select>',               '</select>',                  1]
                                                    }
                                                    };
                                                    
                                                    (function() {
                                                    Object.extend(this.tags, {
                                                    THEAD: this.tags.TBODY,
                                                    TFOOT: this.tags.TBODY,
                                                    TH:    this.tags.TD
                                                    });
                                                    }).call(Element._insertionTranslations);
                                                    
                                                    Element.Methods.Simulated = {
                                                    hasAttribute: function(element, attribute) {
                                                    attribute = Element._attributeTranslations.has[attribute] || attribute;
                                                    var node = $(element).getAttributeNode(attribute);
                                                    return !!(node && node.specified);
                                                    }
                                                    };
                                                    
                                                    Element.Methods.ByTag = { };
                                                    
                                                    Object.extend(Element, Element.Methods);
                                                    
                                                    if (!Prototype.BrowserFeatures.ElementExtensions &&
                                                    document.createElement('div')['__proto__']) {
                                                    window.HTMLElement = { };
                                                    window.HTMLElement.prototype = document.createElement('div')['__proto__'];
                                                    Prototype.BrowserFeatures.ElementExtensions = true;
                                                    }
                                                    
                                                    Element.extend = (function() {
                                                    if (Prototype.BrowserFeatures.SpecificElementExtensions)
                                                    return Prototype.K;
                                                    
                                                    var Methods = { }, ByTag = Element.Methods.ByTag;
                                                    
                                                    var extend = Object.extend(function(element) {
                                                    if (!element || element._extendedByPrototype ||
                                                    element.nodeType != 1 || element == window) return element;
                                                    
                                                    var methods = Object.clone(Methods),
                                                    tagName = element.tagName.toUpperCase(), property, value;
                                                    
                                                    // extend methods for specific tags
                                                    if (ByTag[tagName]) Object.extend(methods, ByTag[tagName]);
                                                    
                                                    for (property in methods) {
                                                    value = methods[property];
                                                    if (Object.isFunction(value) && !(property in element))
                                                    element[property] = value.methodize();
                                                    }
                                                    
                                                    element._extendedByPrototype = Prototype.emptyFunction;
                                                    return element;
                                                    
                                                    }, {
                                                    refresh: function() {
                                                    // extend methods for all tags (Safari doesn't need this)
                                                    if (!Prototype.BrowserFeatures.ElementExtensions) {
                                                    Object.extend(Methods, Element.Methods);
                                                    Object.extend(Methods, Element.Methods.Simulated);
                                                    }
                                                    }
                                                    });
                                                    
                                                    extend.refresh();
                                                    return extend;
                                                    })();
                                                    
                                                    Element.hasAttribute = function(element, attribute) {
                                                    if (element.hasAttribute) return element.hasAttribute(attribute);
                                                    return Element.Methods.Simulated.hasAttribute(element, attribute);
                                                    };
                                                    
                                                    Element.addMethods = function(methods) {
                                                    var F = Prototype.BrowserFeatures, T = Element.Methods.ByTag;
                                                    
                                                    if (!methods) {
                                                    Object.extend(Form, Form.Methods);
                                                    Object.extend(Form.Element, Form.Element.Methods);
                                                    Object.extend(Element.Methods.ByTag, {
                                                    "FORM":     Object.clone(Form.Methods),
                                                    "INPUT":    Object.clone(Form.Element.Methods),
                                                    "SELECT":   Object.clone(Form.Element.Methods),
                                                    "TEXTAREA": Object.clone(Form.Element.Methods)
                                                    });
                                                    }
                                                    
                                                    if (arguments.length == 2) {
                                                    var tagName = methods;
                                                    methods = arguments[1];
                                                    }
                                                    
                                                    if (!tagName) Object.extend(Element.Methods, methods || { });
                                                    else {
                                                    if (Object.isArray(tagName)) tagName.each(extend);
                                                    else extend(tagName);
                                                    }
                                                    
                                                    function extend(tagName) {
                                                    tagName = tagName.toUpperCase();
                                                    if (!Element.Methods.ByTag[tagName])
                                                    Element.Methods.ByTag[tagName] = { };
                                                    Object.extend(Element.Methods.ByTag[tagName], methods);
                                                    }
                                                    
                                                    function copy(methods, destination, onlyIfAbsent) {
                                                    onlyIfAbsent = onlyIfAbsent || false;
                                                    for (var property in methods) {
                                                    var value = methods[property];
                                                    if (!Object.isFunction(value)) continue;
                                                    if (!onlyIfAbsent || !(property in destination))
                                                    destination[property] = value.methodize();
                                                    }
                                                    }
                                                    
                                                    function findDOMClass(tagName) {
                                                    var klass;
                                                    var trans = {
                                                    "OPTGROUP": "OptGroup", "TEXTAREA": "TextArea", "P": "Paragraph",
                                                    "FIELDSET": "FieldSet", "UL": "UList", "OL": "OList", "DL": "DList",
                                                    "DIR": "Directory", "H1": "Heading", "H2": "Heading", "H3": "Heading",
                                                    "H4": "Heading", "H5": "Heading", "H6": "Heading", "Q": "Quote",
                                                    "INS": "Mod", "DEL": "Mod", "A": "Anchor", "IMG": "Image", "CAPTION":
                                                    "TableCaption", "COL": "TableCol", "COLGROUP": "TableCol", "THEAD":
                                                    "TableSection", "TFOOT": "TableSection", "TBODY": "TableSection", "TR":
                                                    "TableRow", "TH": "TableCell", "TD": "TableCell", "FRAMESET":
                                                    "FrameSet", "IFRAME": "IFrame"
                                                    };
                                                    if (trans[tagName]) klass = 'HTML' + trans[tagName] + 'Element';
                                                    if (window[klass]) return window[klass];
                                                    klass = 'HTML' + tagName + 'Element';
                                                    if (window[klass]) return window[klass];
                                                    klass = 'HTML' + tagName.capitalize() + 'Element';
                                                    if (window[klass]) return window[klass];
                                                    
                                                    window[klass] = { };
                                                    window[klass].prototype = document.createElement(tagName)['__proto__'];
                                                    return window[klass];
                                                    }
                                                    
                                                    if (F.ElementExtensions) {
                                                    copy(Element.Methods, HTMLElement.prototype);
                                                    copy(Element.Methods.Simulated, HTMLElement.prototype, true);
                                                    }
                                                    
                                                    if (F.SpecificElementExtensions) {
                                                    for (var tag in Element.Methods.ByTag) {
                                                    var klass = findDOMClass(tag);
                                                    if (Object.isUndefined(klass)) continue;
                                                    copy(T[tag], klass.prototype);
                                                    }
                                                    }
                                                    
                                                    Object.extend(Element, Element.Methods);
                                                    delete Element.ByTag;
                                                    
                                                    if (Element.extend.refresh) Element.extend.refresh();
                                                    Element.cache = { };
                                                    };
                                                    
                                                    document.viewport = {
                                                    getDimensions: function() {
                                                    var dimensions = { }, B = Prototype.Browser;
                                                    $w('width height').each(function(d) {
                                                    var D = d.capitalize();
                                                    if (B.WebKit && !document.evaluate) {
                                                    // Safari <3.0 needs self.innerWidth/Height
                                                    dimensions[d] = self['inner' + D];
                                                    } else if (B.Opera && parseFloat(window.opera.version()) < 9.5) {
                                                    // Opera <9.5 needs document.body.clientWidth/Height
                                                    dimensions[d] = document.body['client' + D]
                                                    } else {
                                                    dimensions[d] = document.documentElement['client' + D];
                                                    }
                                                    });
                                                    return dimensions;
                                                    },
                                                    
                                                    getWidth: function() {
                                                    return this.getDimensions().width;
                                                    },
                                                    
                                                    getHeight: function() {
                                                    return this.getDimensions().height;
                                                    },
                                                    
                                                    getScrollOffsets: function() {
                                                    return Element._returnOffset(
                                                    window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,
                                                    window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop);
                                                    }
                                                    };
                                                    /* Portions of the Selector class are derived from Jack Slocum's DomQuery,
                                                    * part of YUI-Ext version 0.40, distributed under the terms of an MIT-style
                                                    * license.  Please see http://www.yui-ext.com/ for more information. */
                                                    
                                                    var Selector = Class.create({
                                                    initialize: function(expression) {
                                                    this.expression = expression.strip();
                                                    
                                                    if (this.shouldUseSelectorsAPI()) {
                                                    this.mode = 'selectorsAPI';
                                                    } else if (this.shouldUseXPath()) {
                                                    this.mode = 'xpath';
                                                    this.compileXPathMatcher();
                                                    } else {
                                                    this.mode = "normal";
                                                    this.compileMatcher();
                                                    }
                                                    
                                                    },
                                                    
                                                    shouldUseXPath: function() {
                                                    if (!Prototype.BrowserFeatures.XPath) return false;
                                                    
                                                    var e = this.expression;
                                                    
                                                    // Safari 3 chokes on :*-of-type and :empty
                                                    if (Prototype.Browser.WebKit &&
                                                    (e.include("-of-type") || e.include(":empty")))
                                                    return false;
                                                    
                                                    // XPath can't do namespaced attributes, nor can it read
                                                    // the "checked" property from DOM nodes
                                                    if ((/(\[[\w-]*?:|:checked)/).test(e))
                                                    return false;
                                                    
                                                    return true;
                                                    },
                                                    
                                                    shouldUseSelectorsAPI: function() {
                                                    if (!Prototype.BrowserFeatures.SelectorsAPI) return false;
                                                    
                                                    if (!Selector._div) Selector._div = new Element('div');
                                                    
                                                    // Make sure the browser treats the selector as valid. Test on an
                                                    // isolated element to minimize cost of this check.
                                                    try {
                                                    Selector._div.querySelector(this.expression);
                                                    } catch(e) {
                                                    return false;
                                                    }
                                                    
                                                    return true;
                                                    },
                                                    
                                                    compileMatcher: function() {
                                                    var e = this.expression, ps = Selector.patterns, h = Selector.handlers,
                                                    c = Selector.criteria, le, p, m;
                                                    
                                                    if (Selector._cache[e]) {
                                                    this.matcher = Selector._cache[e];
                                                    return;
                                                    }
                                                    
                                                    this.matcher = ["this.matcher = function(root) {",
                                                    "var r = root, h = Selector.handlers, c = false, n;"];
                                                    
                                                    while (e && le != e && (/\S/).test(e)) {
                                                    le = e;
                                                    for (var i in ps) {
                                                    p = ps[i];
                                                    if (m = e.match(p)) {
                                                    this.matcher.push(Object.isFunction(c[i]) ? c[i](m) :
                                                    new Template(c[i]).evaluate(m));
                                                    e = e.replace(m[0], '');
                                                    break;
                                                    }
                                                    }
                                                    }
                                                    
                                                    this.matcher.push("return h.unique(n);\n}");
                                                    eval(this.matcher.join('\n'));
                                                    Selector._cache[this.expression] = this.matcher;
                                                    },
                                                    
                                                    compileXPathMatcher: function() {
                                                    var e = this.expression, ps = Selector.patterns,
                                                    x = Selector.xpath, le, m;
                                                    
                                                    if (Selector._cache[e]) {
                                                    this.xpath = Selector._cache[e]; return;
                                                    }
                                                    
                                                    this.matcher = ['.//*'];
                                                    while (e && le != e && (/\S/).test(e)) {
                                                    le = e;
                                                    for (var i in ps) {
                                                    if (m = e.match(ps[i])) {
                                                    this.matcher.push(Object.isFunction(x[i]) ? x[i](m) :
                                                    new Template(x[i]).evaluate(m));
                                                    e = e.replace(m[0], '');
                                                    break;
                                                    }
                                                    }
                                                    }
                                                    
                                                    this.xpath = this.matcher.join('');
                                                    Selector._cache[this.expression] = this.xpath;
                                                    },
                                                    
                                                    findElements: function(root) {
                                                    root = root || document;
                                                    var e = this.expression, results;
                                                    
                                                    switch (this.mode) {
                                                    case 'selectorsAPI':
                                                    // querySelectorAll queries document-wide, then filters to descendants
                                                    // of the context element. That's not what we want.
                                                    // Add an explicit context to the selector if necessary.
                                                    if (root !== document) {
                                                    var oldId = root.id, id = $(root).identify();
                                                    e = "#" + id + " " + e;
                                                    }
                                                    
                                                    results = $A(root.querySelectorAll(e)).map(Element.extend);
                                                    root.id = oldId;
                                                    
                                                    return results;
                                                    case 'xpath':
                                                    return document._getElementsByXPath(this.xpath, root);
                                                    default:
                                                    return this.matcher(root);
                                                    }
                                                    },
                                                    
                                                    match: function(element) {
                                                    this.tokens = [];
                                                    
                                                    var e = this.expression, ps = Selector.patterns, as = Selector.assertions;
                                                    var le, p, m;
                                                    
                                                    while (e && le !== e && (/\S/).test(e)) {
                                                    le = e;
                                                    for (var i in ps) {
                                                    p = ps[i];
                                                    if (m = e.match(p)) {
                                                    // use the Selector.assertions methods unless the selector
                                                    // is too complex.
                                                    if (as[i]) {
                                                    this.tokens.push([i, Object.clone(m)]);
                                                    e = e.replace(m[0], '');
                                                    } else {
                                                    // reluctantly do a document-wide search
                                                    // and look for a match in the array
                                                    return this.findElements(document).include(element);
                                                    }
                                                    }
                                                    }
                                                    }
                                                    
                                                    var match = true, name, matches;
                                                    for (var i = 0, token; token = this.tokens[i]; i++) {
                                                    name = token[0], matches = token[1];
                                                    if (!Selector.assertions[name](element, matches)) {
                                                    match = false; break;
                                                    }
                                                    }
                                                    
                                                    return match;
                                                    },
                                                    
                                                    toString: function() {
                                                    return this.expression;
                                                    },
                                                    
                                                    inspect: function() {
                                                    return "#<Selector:" + this.expression.inspect() + ">";
                                                        }
                                                        });
                                                        
                                                        Object.extend(Selector, {
                                                        _cache: { },
                                                        
                                                        xpath: {
                                                        descendant:   "//*",
                                                        child:        "/*",
                                                        adjacent:     "/following-sibling::*[1]",
                                                        laterSibling: '/following-sibling::*',
                                                        tagName:      function(m) {
                                                        if (m[1] == '*') return '';
                                                        return "[local-name()='" + m[1].toLowerCase() +
                                                        "' or local-name()='" + m[1].toUpperCase() + "']";
                                                        },
                                                        className:    "[contains(concat(' ', @class, ' '), ' #{1} ')]",
                                                        id:           "[@id='#{1}']",
                                                        attrPresence: function(m) {
                                                        m[1] = m[1].toLowerCase();
                                                        return new Template("[@#{1}]").evaluate(m);
                                                        },
                                                        attr: function(m) {
                                                        m[1] = m[1].toLowerCase();
                                                        m[3] = m[5] || m[6];
                                                        return new Template(Selector.xpath.operators[m[2]]).evaluate(m);
                                                        },
                                                        pseudo: function(m) {
                                                        var h = Selector.xpath.pseudos[m[1]];
                                                        if (!h) return '';
                                                        if (Object.isFunction(h)) return h(m);
                                                        return new Template(Selector.xpath.pseudos[m[1]]).evaluate(m);
                                                        },
                                                        operators: {
                                                        '=':  "[@#{1}='#{3}']",
                                                        '!=': "[@#{1}!='#{3}']",
                                                        '^=': "[starts-with(@#{1}, '#{3}')]",
                                                        '$=': "[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']",
                                                        '*=': "[contains(@#{1}, '#{3}')]",
                                                        '~=': "[contains(concat(' ', @#{1}, ' '), ' #{3} ')]",
                                                        '|=': "[contains(concat('-', @#{1}, '-'), '-#{3}-')]"
                                                        },
                                                        pseudos: {
                                                        'first-child': '[not(preceding-sibling::*)]',
                                                        'last-child':  '[not(following-sibling::*)]',
                                                        'only-child':  '[not(preceding-sibling::* or following-sibling::*)]',
                                                        'empty':       "[count(*) = 0 and (count(text()) = 0)]",
                                                        'checked':     "[@checked]",
                                                        'disabled':    "[(@disabled) and (@type!='hidden')]",
                                                        'enabled':     "[not(@disabled) and (@type!='hidden')]",
                                                        'not': function(m) {
                                                        var e = m[6], p = Selector.patterns,
                                                        x = Selector.xpath, le, v;
                                                        
                                                        var exclusion = [];
                                                        while (e && le != e && (/\S/).test(e)) {
                                                        le = e;
                                                        for (var i in p) {
                                                        if (m = e.match(p[i])) {
                                                        v = Object.isFunction(x[i]) ? x[i](m) : new Template(x[i]).evaluate(m);
                                                        exclusion.push("(" + v.substring(1, v.length - 1) + ")");
                                                        e = e.replace(m[0], '');
                                                        break;
                                                        }
                                                        }
                                                        }
                                                        return "[not(" + exclusion.join(" and ") + ")]";
                                                        },
                                                        'nth-child':      function(m) {
                                                        return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ", m);
                                                        },
                                                        'nth-last-child': function(m) {
                                                        return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ", m);
                                                        },
                                                        'nth-of-type':    function(m) {
                                                        return Selector.xpath.pseudos.nth("position() ", m);
                                                        },
                                                        'nth-last-of-type': function(m) {
                                                        return Selector.xpath.pseudos.nth("(last() + 1 - position()) ", m);
                                                        },
                                                        'first-of-type':  function(m) {
                                                        m[6] = "1"; return Selector.xpath.pseudos['nth-of-type'](m);
                                                        },
                                                        'last-of-type':   function(m) {
                                                        m[6] = "1"; return Selector.xpath.pseudos['nth-last-of-type'](m);
                                                        },
                                                        'only-of-type':   function(m) {
                                                        var p = Selector.xpath.pseudos; return p['first-of-type'](m) + p['last-of-type'](m);
                                                        },
                                                        nth: function(fragment, m) {
                                                        var mm, formula = m[6], predicate;
                                                        if (formula == 'even') formula = '2n+0';
                                                        if (formula == 'odd')  formula = '2n+1';
                                                        if (mm = formula.match(/^(\d+)$/)) // digit only
                                                        return '[' + fragment + "= " + mm[1] + ']';
                                                        if (mm = formula.match(/^(-?\d*)?n(([+-])(\d+))?/)) { // an+b
                                                        if (mm[1] == "-") mm[1] = -1;
                                                        var a = mm[1] ? Number(mm[1]) : 1;
                                                        var b = mm[2] ? Number(mm[2]) : 0;
                                                        predicate = "[((#{fragment} - #{b}) mod #{a} = 0) and " +
                                                        "((#{fragment} - #{b}) div #{a} >= 0)]";
                                                        return new Template(predicate).evaluate({
                                                        fragment: fragment, a: a, b: b });
                                                        }
                                                        }
                                                        }
                                                        },
                                                        
                                                        criteria: {
                                                        tagName:      'n = h.tagName(n, r, "#{1}", c);      c = false;',
                                                        className:    'n = h.className(n, r, "#{1}", c);    c = false;',
                                                        id:           'n = h.id(n, r, "#{1}", c);           c = false;',
                                                        attrPresence: 'n = h.attrPresence(n, r, "#{1}", c); c = false;',
                                                        attr: function(m) {
                                                        m[3] = (m[5] || m[6]);
                                                        return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(m);
                                                        },
                                                        pseudo: function(m) {
                                                        if (m[6]) m[6] = m[6].replace(/"/g, '\\"');
                                                        return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(m);
                                                        },
                                                        descendant:   'c = "descendant";',
                                                        child:        'c = "child";',
                                                        adjacent:     'c = "adjacent";',
                                                        laterSibling: 'c = "laterSibling";'
                                                        },
                                                        
                                                        patterns: {
                                                        // combinators must be listed first
                                                        // (and descendant needs to be last combinator)
                                                        laterSibling: /^\s*~\s*/,
                                                        child:        /^\s*>\s*/,
                                                        adjacent:     /^\s*\+\s*/,
                                                        descendant:   /^\s/,
                                                        
                                                        // selectors follow
                                                        tagName:      /^\s*(\*|[\w\-]+)(\b|$)?/,
                                                        id:           /^#([\w\-\*]+)(\b|$)/,
                                                        className:    /^\.([\w\-\*]+)(\b|$)/,
                                                        pseudo:
                                                        /^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/,
                                                        attrPresence: /^\[((?:[\w]+:)?[\w]+)\]/,
                                                        attr:         /\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/
                                                        },
                                                        
                                                        // for Selector.match and Element#match
                                                        assertions: {
                                                        tagName: function(element, matches) {
                                                        return matches[1].toUpperCase() == element.tagName.toUpperCase();
                                                        },
                                                        
                                                        className: function(element, matches) {
                                                        return Element.hasClassName(element, matches[1]);
                                                        },
                                                        
                                                        id: function(element, matches) {
                                                        return element.id === matches[1];
                                                        },
                                                        
                                                        attrPresence: function(element, matches) {
                                                        return Element.hasAttribute(element, matches[1]);
                                                        },
                                                        
                                                        attr: function(element, matches) {
                                                        var nodeValue = Element.readAttribute(element, matches[1]);
                                                        return nodeValue && Selector.operators[matches[2]](nodeValue, matches[5] || matches[6]);
                                                        }
                                                        },
                                                        
                                                        handlers: {
                                                        // UTILITY FUNCTIONS
                                                        // joins two collections
                                                        concat: function(a, b) {
                                                        for (var i = 0, node; node = b[i]; i++)
                                                        a.push(node);
                                                        return a;
                                                        },
                                                        
                                                        // marks an array of nodes for counting
                                                        mark: function(nodes) {
                                                        var _true = Prototype.emptyFunction;
                                                        for (var i = 0, node; node = nodes[i]; i++)
                                                        node._countedByPrototype = _true;
                                                        return nodes;
                                                        },
                                                        
                                                        unmark: function(nodes) {
                                                        for (var i = 0, node; node = nodes[i]; i++)
                                                        node._countedByPrototype = undefined;
                                                        return nodes;
                                                        },
                                                        
                                                        // mark each child node with its position (for nth calls)
                                                        // "ofType" flag indicates whether we're indexing for nth-of-type
                                                        // rather than nth-child
                                                        index: function(parentNode, reverse, ofType) {
                                                        parentNode._countedByPrototype = Prototype.emptyFunction;
                                                        if (reverse) {
                                                        for (var nodes = parentNode.childNodes, i = nodes.length - 1, j = 1; i >= 0; i--) {
                                                        var node = nodes[i];
                                                        if (node.nodeType == 1 && (!ofType || node._countedByPrototype)) node.nodeIndex = j++;
                                                        }
                                                        } else {
                                                        for (var i = 0, j = 1, nodes = parentNode.childNodes; node = nodes[i]; i++)
                                                        if (node.nodeType == 1 && (!ofType || node._countedByPrototype)) node.nodeIndex = j++;
                                                        }
                                                        },
                                                        
                                                        // filters out duplicates and extends all nodes
                                                        unique: function(nodes) {
                                                        if (nodes.length == 0) return nodes;
                                                        var results = [], n;
                                                        for (var i = 0, l = nodes.length; i < l; i++)
                                                            if (!(n = nodes[i])._countedByPrototype) {
                                                            n._countedByPrototype = Prototype.emptyFunction;
                                                            results.push(Element.extend(n));
                                                            }
                                                            return Selector.handlers.unmark(results);
                                                            },
                                                            
                                                            // COMBINATOR FUNCTIONS
                                                            descendant: function(nodes) {
                                                            var h = Selector.handlers;
                                                            for (var i = 0, results = [], node; node = nodes[i]; i++)
                                                            h.concat(results, node.getElementsByTagName('*'));
                                                            return results;
                                                            },
                                                            
                                                            child: function(nodes) {
                                                            var h = Selector.handlers;
                                                            for (var i = 0, results = [], node; node = nodes[i]; i++) {
                                                            for (var j = 0, child; child = node.childNodes[j]; j++)
                                                            if (child.nodeType == 1 && child.tagName != '!') results.push(child);
                                                            }
                                                            return results;
                                                            },
                                                            
                                                            adjacent: function(nodes) {
                                                            for (var i = 0, results = [], node; node = nodes[i]; i++) {
                                                            var next = this.nextElementSibling(node);
                                                            if (next) results.push(next);
                                                            }
                                                            return results;
                                                            },
                                                            
                                                            laterSibling: function(nodes) {
                                                            var h = Selector.handlers;
                                                            for (var i = 0, results = [], node; node = nodes[i]; i++)
                                                            h.concat(results, Element.nextSiblings(node));
                                                            return results;
                                                            },
                                                            
                                                            nextElementSibling: function(node) {
                                                            while (node = node.nextSibling)
                                                            if (node.nodeType == 1) return node;
                                                            return null;
                                                            },
                                                            
                                                            previousElementSibling: function(node) {
                                                            while (node = node.previousSibling)
                                                            if (node.nodeType == 1) return node;
                                                            return null;
                                                            },
                                                            
                                                            // TOKEN FUNCTIONS
                                                            tagName: function(nodes, root, tagName, combinator) {
                                                            var uTagName = tagName.toUpperCase();
                                                            var results = [], h = Selector.handlers;
                                                            if (nodes) {
                                                            if (combinator) {
                                                            // fastlane for ordinary descendant combinators
                                                            if (combinator == "descendant") {
                                                            for (var i = 0, node; node = nodes[i]; i++)
                                                            h.concat(results, node.getElementsByTagName(tagName));
                                                            return results;
                                                            } else nodes = this[combinator](nodes);
                                                            if (tagName == "*") return nodes;
                                                            }
                                                            for (var i = 0, node; node = nodes[i]; i++)
                                                            if (node.tagName.toUpperCase() === uTagName) results.push(node);
                                                            return results;
                                                            } else return root.getElementsByTagName(tagName);
                                                            },
                                                            
                                                            id: function(nodes, root, id, combinator) {
                                                            var targetNode = $(id), h = Selector.handlers;
                                                            if (!targetNode) return [];
                                                            if (!nodes && root == document) return [targetNode];
                                                            if (nodes) {
                                                            if (combinator) {
                                                            if (combinator == 'child') {
                                                            for (var i = 0, node; node = nodes[i]; i++)
                                                            if (targetNode.parentNode == node) return [targetNode];
                                                            } else if (combinator == 'descendant') {
                                                            for (var i = 0, node; node = nodes[i]; i++)
                                                            if (Element.descendantOf(targetNode, node)) return [targetNode];
                                                            } else if (combinator == 'adjacent') {
                                                            for (var i = 0, node; node = nodes[i]; i++)
                                                            if (Selector.handlers.previousElementSibling(targetNode) == node)
                                                            return [targetNode];
                                                            } else nodes = h[combinator](nodes);
                                                            }
                                                            for (var i = 0, node; node = nodes[i]; i++)
                                                            if (node == targetNode) return [targetNode];
                                                            return [];
                                                            }
                                                            return (targetNode && Element.descendantOf(targetNode, root)) ? [targetNode] : [];
                                                            },
                                                            
                                                            className: function(nodes, root, className, combinator) {
                                                            if (nodes && combinator) nodes = this[combinator](nodes);
                                                            return Selector.handlers.byClassName(nodes, root, className);
                                                            },
                                                            
                                                            byClassName: function(nodes, root, className) {
                                                            if (!nodes) nodes = Selector.handlers.descendant([root]);
                                                            var needle = ' ' + className + ' ';
                                                            for (var i = 0, results = [], node, nodeClassName; node = nodes[i]; i++) {
                                                            nodeClassName = node.className;
                                                            if (nodeClassName.length == 0) continue;
                                                            if (nodeClassName == className || (' ' + nodeClassName + ' ').include(needle))
                                                            results.push(node);
                                                            }
                                                            return results;
                                                            },
                                                            
                                                            attrPresence: function(nodes, root, attr, combinator) {
                                                            if (!nodes) nodes = root.getElementsByTagName("*");
                                                            if (nodes && combinator) nodes = this[combinator](nodes);
                                                            var results = [];
                                                            for (var i = 0, node; node = nodes[i]; i++)
                                                            if (Element.hasAttribute(node, attr)) results.push(node);
                                                            return results;
                                                            },
                                                            
                                                            attr: function(nodes, root, attr, value, operator, combinator) {
                                                            if (!nodes) nodes = root.getElementsByTagName("*");
                                                            if (nodes && combinator) nodes = this[combinator](nodes);
                                                            var handler = Selector.operators[operator], results = [];
                                                            for (var i = 0, node; node = nodes[i]; i++) {
                                                            var nodeValue = Element.readAttribute(node, attr);
                                                            if (nodeValue === null) continue;
                                                            if (handler(nodeValue, value)) results.push(node);
                                                            }
                                                            return results;
                                                            },
                                                            
                                                            pseudo: function(nodes, name, value, root, combinator) {
                                                            if (nodes && combinator) nodes = this[combinator](nodes);
                                                            if (!nodes) nodes = root.getElementsByTagName("*");
                                                            return Selector.pseudos[name](nodes, value, root);
                                                            }
                                                            },
                                                            
                                                            pseudos: {
                                                            'first-child': function(nodes, value, root) {
                                                            for (var i = 0, results = [], node; node = nodes[i]; i++) {
                                                            if (Selector.handlers.previousElementSibling(node)) continue;
                                                            results.push(node);
                                                            }
                                                            return results;
                                                            },
                                                            'last-child': function(nodes, value, root) {
                                                            for (var i = 0, results = [], node; node = nodes[i]; i++) {
                                                            if (Selector.handlers.nextElementSibling(node)) continue;
                                                            results.push(node);
                                                            }
                                                            return results;
                                                            },
                                                            'only-child': function(nodes, value, root) {
                                                            var h = Selector.handlers;
                                                            for (var i = 0, results = [], node; node = nodes[i]; i++)
                                                            if (!h.previousElementSibling(node) && !h.nextElementSibling(node))
                                                            results.push(node);
                                                            return results;
                                                            },
                                                            'nth-child':        function(nodes, formula, root) {
                                                            return Selector.pseudos.nth(nodes, formula, root);
                                                            },
                                                            'nth-last-child':   function(nodes, formula, root) {
                                                            return Selector.pseudos.nth(nodes, formula, root, true);
                                                            },
                                                            'nth-of-type':      function(nodes, formula, root) {
                                                            return Selector.pseudos.nth(nodes, formula, root, false, true);
                                                            },
                                                            'nth-last-of-type': function(nodes, formula, root) {
                                                            return Selector.pseudos.nth(nodes, formula, root, true, true);
                                                            },
                                                            'first-of-type':    function(nodes, formula, root) {
                                                            return Selector.pseudos.nth(nodes, "1", root, false, true);
                                                            },
                                                            'last-of-type':     function(nodes, formula, root) {
                                                            return Selector.pseudos.nth(nodes, "1", root, true, true);
                                                            },
                                                            'only-of-type':     function(nodes, formula, root) {
                                                            var p = Selector.pseudos;
                                                            return p['last-of-type'](p['first-of-type'](nodes, formula, root), formula, root);
                                                            },
                                                            
                                                            // handles the an+b logic
                                                            getIndices: function(a, b, total) {
                                                            if (a == 0) return b > 0 ? [b] : [];
                                                            return $R(1, total).inject([], function(memo, i) {
                                                            if (0 == (i - b) % a && (i - b) / a >= 0) memo.push(i);
                                                            return memo;
                                                            });
                                                            },
                                                            
                                                            // handles nth(-last)-child, nth(-last)-of-type, and (first|last)-of-type
                                                            nth: function(nodes, formula, root, reverse, ofType) {
                                                            if (nodes.length == 0) return [];
                                                            if (formula == 'even') formula = '2n+0';
                                                            if (formula == 'odd')  formula = '2n+1';
                                                            var h = Selector.handlers, results = [], indexed = [], m;
                                                            h.mark(nodes);
                                                            for (var i = 0, node; node = nodes[i]; i++) {
                                                            if (!node.parentNode._countedByPrototype) {
                                                            h.index(node.parentNode, reverse, ofType);
                                                            indexed.push(node.parentNode);
                                                            }
                                                            }
                                                            if (formula.match(/^\d+$/)) { // just a number
                                                            formula = Number(formula);
                                                            for (var i = 0, node; node = nodes[i]; i++)
                                                            if (node.nodeIndex == formula) results.push(node);
                                                            } else if (m = formula.match(/^(-?\d*)?n(([+-])(\d+))?/)) { // an+b
                                                            if (m[1] == "-") m[1] = -1;
                                                            var a = m[1] ? Number(m[1]) : 1;
                                                            var b = m[2] ? Number(m[2]) : 0;
                                                            var indices = Selector.pseudos.getIndices(a, b, nodes.length);
                                                            for (var i = 0, node, l = indices.length; node = nodes[i]; i++) {
                                                            for (var j = 0; j < l; j++)
                                                                if (node.nodeIndex == indices[j]) results.push(node);
                                                                }
                                                                }
                                                                h.unmark(nodes);
                                                                h.unmark(indexed);
                                                                return results;
                                                                },
                                                                
                                                                'empty': function(nodes, value, root) {
                                                                for (var i = 0, results = [], node; node = nodes[i]; i++) {
                                                                // IE treats comments as element nodes
                                                                if (node.tagName == '!' || node.firstChild) continue;
                                                                results.push(node);
                                                                }
                                                                return results;
                                                                },
                                                                
                                                                'not': function(nodes, selector, root) {
                                                                var h = Selector.handlers, selectorType, m;
                                                                var exclusions = new Selector(selector).findElements(root);
                                                                h.mark(exclusions);
                                                                for (var i = 0, results = [], node; node = nodes[i]; i++)
                                                                if (!node._countedByPrototype) results.push(node);
                                                                h.unmark(exclusions);
                                                                return results;
                                                                },
                                                                
                                                                'enabled': function(nodes, value, root) {
                                                                for (var i = 0, results = [], node; node = nodes[i]; i++)
                                                                if (!node.disabled && (!node.type || node.type !== 'hidden'))
                                                                results.push(node);
                                                                return results;
                                                                },
                                                                
                                                                'disabled': function(nodes, value, root) {
                                                                for (var i = 0, results = [], node; node = nodes[i]; i++)
                                                                if (node.disabled) results.push(node);
                                                                return results;
                                                                },
                                                                
                                                                'checked': function(nodes, value, root) {
                                                                for (var i = 0, results = [], node; node = nodes[i]; i++)
                                                                if (node.checked) results.push(node);
                                                                return results;
                                                                }
                                                                },
                                                                
                                                                operators: {
                                                                '=':  function(nv, v) { return nv == v; },
                                                                '!=': function(nv, v) { return nv != v; },
                                                                '^=': function(nv, v) { return nv == v || nv && nv.startsWith(v); },
                                                                '$=': function(nv, v) { return nv == v || nv && nv.endsWith(v); },
                                                                '*=': function(nv, v) { return nv == v || nv && nv.include(v); },
                                                                '$=': function(nv, v) { return nv.endsWith(v); },
                                                                '*=': function(nv, v) { return nv.include(v); },
                                                                '~=': function(nv, v) { return (' ' + nv + ' ').include(' ' + v + ' '); },
                                                                '|=': function(nv, v) { return ('-' + (nv || "").toUpperCase() +
                                                                '-').include('-' + (v || "").toUpperCase() + '-'); }
                                                                },
                                                                
                                                                split: function(expression) {
                                                                var expressions = [];
                                                                expression.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/, function(m) {
                                                                expressions.push(m[1].strip());
                                                                });
                                                                return expressions;
                                                                },
                                                                
                                                                matchElements: function(elements, expression) {
                                                                var matches = $$(expression), h = Selector.handlers;
                                                                h.mark(matches);
                                                                for (var i = 0, results = [], element; element = elements[i]; i++)
                                                                if (element._countedByPrototype) results.push(element);
                                                                h.unmark(matches);
                                                                return results;
                                                                },
                                                                
                                                                findElement: function(elements, expression, index) {
                                                                if (Object.isNumber(expression)) {
                                                                index = expression; expression = false;
                                                                }
                                                                return Selector.matchElements(elements, expression || '*')[index || 0];
                                                                },
                                                                
                                                                findChildElements: function(element, expressions) {
                                                                expressions = Selector.split(expressions.join(','));
                                                                var results = [], h = Selector.handlers;
                                                                for (var i = 0, l = expressions.length, selector; i < l; i++) {
                                                                    selector = new Selector(expressions[i].strip());
                                                                    h.concat(results, selector.findElements(element));
                                                                    }
                                                                    return (l > 1) ? h.unique(results) : results;
                                                                    }
                                                                    });
                                                                    
                                                                    if (Prototype.Browser.IE) {
                                                                    Object.extend(Selector.handlers, {
                                                                    // IE returns comment nodes on getElementsByTagName("*").
                                                                    // Filter them out.
                                                                    concat: function(a, b) {
                                                                    for (var i = 0, node; node = b[i]; i++)
                                                                    if (node.tagName !== "!") a.push(node);
                                                                    return a;
                                                                    },
                                                                    
                                                                    // IE improperly serializes _countedByPrototype in (inner|outer)HTML.
                                                                    unmark: function(nodes) {
                                                                    for (var i = 0, node; node = nodes[i]; i++)
                                                                    node.removeAttribute('_countedByPrototype');
                                                                    return nodes;
                                                                    }
                                                                    });
                                                                    }
                                                                    
                                                                    function $$() {
                                                                    return Selector.findChildElements(document, $A(arguments));
                                                                    }
                                                                    var Form = {
                                                                    reset: function(form) {
                                                                    $(form).reset();
                                                                    return form;
                                                                    },
                                                                    
                                                                    serializeElements: function(elements, options) {
                                                                    if (typeof options != 'object') options = { hash: !!options };
                                                                    else if (Object.isUndefined(options.hash)) options.hash = true;
                                                                    var key, value, submitted = false, submit = options.submit;
                                                                    
                                                                    var data = elements.inject({ }, function(result, element) {
                                                                    if (!element.disabled && element.name) {
                                                                    key = element.name; value = $(element).getValue();
                                                                    if (value != null && element.type != 'file' && (element.type != 'submit' || (!submitted &&
                                                                    submit !== false && (!submit || key == submit) && (submitted = true)))) {
                                                                    if (key in result) {
                                                                    // a key is already present; construct an array of values
                                                                    if (!Object.isArray(result[key])) result[key] = [result[key]];
                                                                    result[key].push(value);
                                                                    }
                                                                    else result[key] = value;
                                                                    }
                                                                    }
                                                                    return result;
                                                                    });
                                                                    
                                                                    return options.hash ? data : Object.toQueryString(data);
                                                                    }
                                                                    };
                                                                    
                                                                    Form.Methods = {
                                                                    serialize: function(form, options) {
                                                                    return Form.serializeElements(Form.getElements(form), options);
                                                                    },
                                                                    
                                                                    getElements: function(form) {
                                                                    return $A($(form).getElementsByTagName('*')).inject([],
                                                                    function(elements, child) {
                                                                    if (Form.Element.Serializers[child.tagName.toLowerCase()])
                                                                    elements.push(Element.extend(child));
                                                                    return elements;
                                                                    }
                                                                    );
                                                                    },
                                                                    
                                                                    getInputs: function(form, typeName, name) {
                                                                    form = $(form);
                                                                    var inputs = form.getElementsByTagName('input');
                                                                    
                                                                    if (!typeName && !name) return $A(inputs).map(Element.extend);
                                                                    
                                                                    for (var i = 0, matchingInputs = [], length = inputs.length; i < length; i++) {
                                                                        var input = inputs[i];
                                                                        if ((typeName && input.type != typeName) || (name && input.name != name))
                                                                        continue;
                                                                        matchingInputs.push(Element.extend(input));
                                                                        }
                                                                        
                                                                        return matchingInputs;
                                                                        },
                                                                        
                                                                        disable: function(form) {
                                                                        form = $(form);
                                                                        Form.getElements(form).invoke('disable');
                                                                        return form;
                                                                        },
                                                                        
                                                                        enable: function(form) {
                                                                        form = $(form);
                                                                        Form.getElements(form).invoke('enable');
                                                                        return form;
                                                                        },
                                                                        
                                                                        findFirstElement: function(form) {
                                                                        var elements = $(form).getElements().findAll(function(element) {
                                                                        return 'hidden' != element.type && !element.disabled;
                                                                        });
                                                                        var firstByIndex = elements.findAll(function(element) {
                                                                        return element.hasAttribute('tabIndex') && element.tabIndex >= 0;
                                                                        }).sortBy(function(element) { return element.tabIndex }).first();
                                                                        
                                                                        return firstByIndex ? firstByIndex : elements.find(function(element) {
                                                                        return ['input', 'select', 'textarea'].include(element.tagName.toLowerCase());
                                                                        });
                                                                        },
                                                                        
                                                                        focusFirstElement: function(form) {
                                                                        form = $(form);
                                                                        form.findFirstElement().activate();
                                                                        return form;
                                                                        },
                                                                        
                                                                        request: function(form, options) {
                                                                        form = $(form), options = Object.clone(options || { });
                                                                        
                                                                        var params = options.parameters, action = form.readAttribute('action') || '';
                                                                        if (action.blank()) action = window.location.href;
                                                                        options.parameters = form.serialize(true);
                                                                        
                                                                        if (params) {
                                                                        if (Object.isString(params)) params = params.toQueryParams();
                                                                        Object.extend(options.parameters, params);
                                                                        }
                                                                        
                                                                        if (form.hasAttribute('method') && !options.method)
                                                                        options.method = form.method;
                                                                        
                                                                        return new Ajax.Request(action, options);
                                                                        }
                                                                        };
                                                                        
                                                                        /*--------------------------------------------------------------------------*/
                                                                        
                                                                        Form.Element = {
                                                                        focus: function(element) {
                                                                        $(element).focus();
                                                                        return element;
                                                                        },
                                                                        
                                                                        select: function(element) {
                                                                        $(element).select();
                                                                        return element;
                                                                        }
                                                                        };
                                                                        
                                                                        Form.Element.Methods = {
                                                                        serialize: function(element) {
                                                                        element = $(element);
                                                                        if (!element.disabled && element.name) {
                                                                        var value = element.getValue();
                                                                        if (value != undefined) {
                                                                        var pair = { };
                                                                        pair[element.name] = value;
                                                                        return Object.toQueryString(pair);
                                                                        }
                                                                        }
                                                                        return '';
                                                                        },
                                                                        
                                                                        getValue: function(element) {
                                                                        element = $(element);
                                                                        var method = element.tagName.toLowerCase();
                                                                        return Form.Element.Serializers[method](element);
                                                                        },
                                                                        
                                                                        setValue: function(element, value) {
                                                                        element = $(element);
                                                                        var method = element.tagName.toLowerCase();
                                                                        Form.Element.Serializers[method](element, value);
                                                                        return element;
                                                                        },
                                                                        
                                                                        clear: function(element) {
                                                                        $(element).value = '';
                                                                        return element;
                                                                        },
                                                                        
                                                                        present: function(element) {
                                                                        return $(element).value != '';
                                                                        },
                                                                        
                                                                        activate: function(element) {
                                                                        element = $(element);
                                                                        try {
                                                                        element.focus();
                                                                        if (element.select && (element.tagName.toLowerCase() != 'input' ||
                                                                        !['button', 'reset', 'submit'].include(element.type)))
                                                                        element.select();
                                                                        } catch (e) { }
                                                                        return element;
                                                                        },
                                                                        
                                                                        disable: function(element) {
                                                                        element = $(element);
                                                                        element.disabled = true;
                                                                        return element;
                                                                        },
                                                                        
                                                                        enable: function(element) {
                                                                        element = $(element);
                                                                        element.disabled = false;
                                                                        return element;
                                                                        }
                                                                        };
                                                                        
                                                                        /*--------------------------------------------------------------------------*/
                                                                        
                                                                        var Field = Form.Element;
                                                                        var $F = Form.Element.Methods.getValue;
                                                                        
                                                                        /*--------------------------------------------------------------------------*/
                                                                        
                                                                        Form.Element.Serializers = {
                                                                        input: function(element, value) {
                                                                        switch (element.type.toLowerCase()) {
                                                                        case 'checkbox':
                                                                        case 'radio':
                                                                        return Form.Element.Serializers.inputSelector(element, value);
                                                                        default:
                                                                        return Form.Element.Serializers.textarea(element, value);
                                                                        }
                                                                        },
                                                                        
                                                                        inputSelector: function(element, value) {
                                                                        if (Object.isUndefined(value)) return element.checked ? element.value : null;
                                                                        else element.checked = !!value;
                                                                        },
                                                                        
                                                                        textarea: function(element, value) {
                                                                        if (Object.isUndefined(value)) return element.value;
                                                                        else element.value = value;
                                                                        },
                                                                        
                                                                        select: function(element, value) {
                                                                        if (Object.isUndefined(value))
                                                                        return this[element.type == 'select-one' ?
                                                                        'selectOne' : 'selectMany'](element);
                                                                        else {
                                                                        var opt, currentValue, single = !Object.isArray(value);
                                                                        for (var i = 0, length = element.length; i < length; i++) {
                                                                            opt = element.options[i];
                                                                            currentValue = this.optionValue(opt);
                                                                            if (single) {
                                                                            if (currentValue == value) {
                                                                            opt.selected = true;
                                                                            return;
                                                                            }
                                                                            }
                                                                            else opt.selected = value.include(currentValue);
                                                                            }
                                                                            }
                                                                            },
                                                                            
                                                                            selectOne: function(element) {
                                                                            var index = element.selectedIndex;
                                                                            return index >= 0 ? this.optionValue(element.options[index]) : null;
                                                                            },
                                                                            
                                                                            selectMany: function(element) {
                                                                            var values, length = element.length;
                                                                            if (!length) return null;
                                                                            
                                                                            for (var i = 0, values = []; i < length; i++) {
                                                                                var opt = element.options[i];
                                                                                if (opt.selected) values.push(this.optionValue(opt));
                                                                                }
                                                                                return values;
                                                                                },
                                                                                
                                                                                optionValue: function(opt) {
                                                                                // extend element because hasAttribute may not be native
                                                                                return Element.extend(opt).hasAttribute('value') ? opt.value : opt.text;
                                                                                }
                                                                                };
                                                                                
                                                                                /*--------------------------------------------------------------------------*/
                                                                                
                                                                                Abstract.TimedObserver = Class.create(PeriodicalExecuter, {
                                                                                initialize: function($super, element, frequency, callback) {
                                                                                $super(callback, frequency);
                                                                                this.element   = $(element);
                                                                                this.lastValue = this.getValue();
                                                                                },
                                                                                
                                                                                execute: function() {
                                                                                var value = this.getValue();
                                                                                if (Object.isString(this.lastValue) && Object.isString(value) ?
                                                                                this.lastValue != value : String(this.lastValue) != String(value)) {
                                                                                this.callback(this.element, value);
                                                                                this.lastValue = value;
                                                                                }
                                                                                }
                                                                                });
                                                                                
                                                                                Form.Element.Observer = Class.create(Abstract.TimedObserver, {
                                                                                getValue: function() {
                                                                                return Form.Element.getValue(this.element);
                                                                                }
                                                                                });
                                                                                
                                                                                Form.Observer = Class.create(Abstract.TimedObserver, {
                                                                                getValue: function() {
                                                                                return Form.serialize(this.element);
                                                                                }
                                                                                });
                                                                                
                                                                                /*--------------------------------------------------------------------------*/
                                                                                
                                                                                Abstract.EventObserver = Class.create({
                                                                                initialize: function(element, callback) {
                                                                                this.element  = $(element);
                                                                                this.callback = callback;
                                                                                
                                                                                this.lastValue = this.getValue();
                                                                                if (this.element.tagName.toLowerCase() == 'form')
                                                                                this.registerFormCallbacks();
                                                                                else
                                                                                this.registerCallback(this.element);
                                                                                },
                                                                                
                                                                                onElementEvent: function() {
                                                                                var value = this.getValue();
                                                                                if (this.lastValue != value) {
                                                                                this.callback(this.element, value);
                                                                                this.lastValue = value;
                                                                                }
                                                                                },
                                                                                
                                                                                registerFormCallbacks: function() {
                                                                                Form.getElements(this.element).each(this.registerCallback, this);
                                                                                },
                                                                                
                                                                                registerCallback: function(element) {
                                                                                if (element.type) {
                                                                                switch (element.type.toLowerCase()) {
                                                                                case 'checkbox':
                                                                                case 'radio':
                                                                                Event.observe(element, 'click', this.onElementEvent.bind(this));
                                                                                break;
                                                                                default:
                                                                                Event.observe(element, 'change', this.onElementEvent.bind(this));
                                                                                break;
                                                                                }
                                                                                }
                                                                                }
                                                                                });
                                                                                
                                                                                Form.Element.EventObserver = Class.create(Abstract.EventObserver, {
                                                                                getValue: function() {
                                                                                return Form.Element.getValue(this.element);
                                                                                }
                                                                                });
                                                                                
                                                                                Form.EventObserver = Class.create(Abstract.EventObserver, {
                                                                                getValue: function() {
                                                                                return Form.serialize(this.element);
                                                                                }
                                                                                });
                                                                                if (!window.Event) var Event = { };
                                                                                
                                                                                Object.extend(Event, {
                                                                                KEY_BACKSPACE: 8,
                                                                                KEY_TAB:       9,
                                                                                KEY_RETURN:   13,
                                                                                KEY_ESC:      27,
                                                                                KEY_LEFT:     37,
                                                                                KEY_UP:       38,
                                                                                KEY_RIGHT:    39,
                                                                                KEY_DOWN:     40,
                                                                                KEY_DELETE:   46,
                                                                                KEY_HOME:     36,
                                                                                KEY_END:      35,
                                                                                KEY_PAGEUP:   33,
                                                                                KEY_PAGEDOWN: 34,
                                                                                KEY_INSERT:   45,
                                                                                
                                                                                cache: { },
                                                                                
                                                                                relatedTarget: function(event) {
                                                                                var element;
                                                                                switch(event.type) {
                                                                                case 'mouseover': element = event.fromElement; break;
                                                                                case 'mouseout':  element = event.toElement;   break;
                                                                                default: return null;
                                                                                }
                                                                                return Element.extend(element);
                                                                                }
                                                                                });
                                                                                
                                                                                Event.Methods = (function() {
                                                                                var isButton;
                                                                                
                                                                                if (Prototype.Browser.IE) {
                                                                                var buttonMap = { 0: 1, 1: 4, 2: 2 };
                                                                                isButton = function(event, code) {
                                                                                return event.button == buttonMap[code];
                                                                                };
                                                                                
                                                                                } else if (Prototype.Browser.WebKit) {
                                                                                isButton = function(event, code) {
                                                                                switch (code) {
                                                                                case 0: return event.which == 1 && !event.metaKey;
                                                                                case 1: return event.which == 1 && event.metaKey;
                                                                                default: return false;
                                                                                }
                                                                                };
                                                                                
                                                                                } else {
                                                                                isButton = function(event, code) {
                                                                                return event.which ? (event.which === code + 1) : (event.button === code);
                                                                                };
                                                                                }
                                                                                
                                                                                return {
                                                                                isLeftClick:   function(event) { return isButton(event, 0) },
                                                                                isMiddleClick: function(event) { return isButton(event, 1) },
                                                                                isRightClick:  function(event) { return isButton(event, 2) },
                                                                                
                                                                                element: function(event) {
                                                                                event = Event.extend(event);
                                                                                
                                                                                var node          = event.target,
                                                                                type          = event.type,
                                                                                currentTarget = event.currentTarget;
                                                                                
                                                                                if (currentTarget && currentTarget.tagName) {
                                                                                // Firefox screws up the "click" event when moving between radio buttons
                                                                                // via arrow keys. It also screws up the "load" and "error" events on images,
                                                                                // reporting the document as the target instead of the original image.
                                                                                if (type === 'load' || type === 'error' ||
                                                                                (type === 'click' && currentTarget.tagName.toLowerCase() === 'input'
                                                                                && currentTarget.type === 'radio'))
                                                                                node = currentTarget;
                                                                                }
                                                                                if (node.nodeType == Node.TEXT_NODE) node = node.parentNode;
                                                                                return Element.extend(node);
                                                                                },
                                                                                
                                                                                findElement: function(event, expression) {
                                                                                var element = Event.element(event);
                                                                                if (!expression) return element;
                                                                                var elements = [element].concat(element.ancestors());
                                                                                return Selector.findElement(elements, expression, 0);
                                                                                },
                                                                                
                                                                                pointer: function(event) {
                                                                                var docElement = document.documentElement,
                                                                                body = document.body || { scrollLeft: 0, scrollTop: 0 };
                                                                                return {
                                                                                x: event.pageX || (event.clientX +
                                                                                (docElement.scrollLeft || body.scrollLeft) -
                                                                                (docElement.clientLeft || 0)),
                                                                                y: event.pageY || (event.clientY +
                                                                                (docElement.scrollTop || body.scrollTop) -
                                                                                (docElement.clientTop || 0))
                                                                                };
                                                                                },
                                                                                
                                                                                pointerX: function(event) { return Event.pointer(event).x },
                                                                                pointerY: function(event) { return Event.pointer(event).y },
                                                                                
                                                                                stop: function(event) {
                                                                                Event.extend(event);
                                                                                event.preventDefault();
                                                                                event.stopPropagation();
                                                                                event.stopped = true;
                                                                                }
                                                                                };
                                                                                })();
                                                                                
                                                                                Event.extend = (function() {
                                                                                var methods = Object.keys(Event.Methods).inject({ }, function(m, name) {
                                                                                m[name] = Event.Methods[name].methodize();
                                                                                return m;
                                                                                });
                                                                                
                                                                                if (Prototype.Browser.IE) {
                                                                                Object.extend(methods, {
                                                                                stopPropagation: function() { this.cancelBubble = true },
                                                                                preventDefault:  function() { this.returnValue = false },
                                                                                inspect: function() { return "[object Event]" }
                                                                                });
                                                                                
                                                                                return function(event) {
                                                                                if (!event) return false;
                                                                                if (event._extendedByPrototype) return event;
                                                                                
                                                                                event._extendedByPrototype = Prototype.emptyFunction;
                                                                                var pointer = Event.pointer(event);
                                                                                Object.extend(event, {
                                                                                target: event.srcElement,
                                                                                relatedTarget: Event.relatedTarget(event),
                                                                                pageX:  pointer.x,
                                                                                pageY:  pointer.y
                                                                                });
                                                                                return Object.extend(event, methods);
                                                                                };
                                                                                
                                                                                } else {
                                                                                Event.prototype = Event.prototype || document.createEvent("HTMLEvents")['__proto__'];
                                                                                Object.extend(Event.prototype, methods);
                                                                                return Prototype.K;
                                                                                }
                                                                                })();
                                                                                
                                                                                Object.extend(Event, (function() {
                                                                                var cache = Event.cache;
                                                                                
                                                                                function getEventID(element) {
                                                                                if (element._prototypeEventID) return element._prototypeEventID[0];
                                                                                arguments.callee.id = arguments.callee.id || 1;
                                                                                return element._prototypeEventID = [++arguments.callee.id];
                                                                                }
                                                                                
                                                                                function getDOMEventName(eventName) {
                                                                                if (eventName && eventName.include(':')) return "dataavailable";
                                                                                return eventName;
                                                                                }
                                                                                
                                                                                function getCacheForID(id) {
                                                                                return cache[id] = cache[id] || { };
                                                                                }
                                                                                
                                                                                function getWrappersForEventName(id, eventName) {
                                                                                var c = getCacheForID(id);
                                                                                return c[eventName] = c[eventName] || [];
                                                                                }
                                                                                
                                                                                function createWrapper(element, eventName, handler) {
                                                                                var id = getEventID(element);
                                                                                var c = getWrappersForEventName(id, eventName);
                                                                                if (c.pluck("handler").include(handler)) return false;
                                                                                
                                                                                var wrapper = function(event) {
                                                                                if (!Event || !Event.extend ||
                                                                                (event.eventName && event.eventName != eventName))
                                                                                return false;
                                                                                
                                                                                Event.extend(event);
                                                                                handler.call(element, event);
                                                                                };
                                                                                
                                                                                wrapper.handler = handler;
                                                                                c.push(wrapper);
                                                                                return wrapper;
                                                                                }
                                                                                
                                                                                function findWrapper(id, eventName, handler) {
                                                                                var c = getWrappersForEventName(id, eventName);
                                                                                return c.find(function(wrapper) { return wrapper.handler == handler });
                                                                                }
                                                                                
                                                                                function destroyWrapper(id, eventName, handler) {
                                                                                var c = getCacheForID(id);
                                                                                if (!c[eventName]) return false;
                                                                                c[eventName] = c[eventName].without(findWrapper(id, eventName, handler));
                                                                                }
                                                                                
                                                                                function destroyCache() {
                                                                                for (var id in cache)
                                                                                for (var eventName in cache[id])
                                                                                cache[id][eventName] = null;
                                                                                }
                                                                                
                                                                                
                                                                                // Internet Explorer needs to remove event handlers on page unload
                                                                                // in order to avoid memory leaks.
                                                                                if (window.attachEvent) {
                                                                                window.attachEvent("onunload", destroyCache);
                                                                                }
                                                                                
                                                                                // Safari has a dummy event handler on page unload so that it won't
                                                                                // use its bfcache. Safari <= 3.1 has an issue with restoring the "document"
                                                                                // object when page is returned to via the back button using its bfcache.
                                                                                if (Prototype.Browser.WebKit) {
                                                                                window.addEventListener('unload', Prototype.emptyFunction, false);
                                                                                }
                                                                                
                                                                                return {
                                                                                observe: function(element, eventName, handler) {
                                                                                element = $(element);
                                                                                var name = getDOMEventName(eventName);
                                                                                
                                                                                var wrapper = createWrapper(element, eventName, handler);
                                                                                if (!wrapper) return element;
                                                                                
                                                                                if (element.addEventListener) {
                                                                                element.addEventListener(name, wrapper, false);
                                                                                } else {
                                                                                element.attachEvent("on" + name, wrapper);
                                                                                }
                                                                                
                                                                                return element;
                                                                                },
                                                                                
                                                                                stopObserving: function(element, eventName, handler) {
                                                                                element = $(element);
                                                                                var id = getEventID(element), name = getDOMEventName(eventName);
                                                                                
                                                                                if (!handler && eventName) {
                                                                                getWrappersForEventName(id, eventName).each(function(wrapper) {
                                                                                element.stopObserving(eventName, wrapper.handler);
                                                                                });
                                                                                return element;
                                                                                
                                                                                } else if (!eventName) {
                                                                                Object.keys(getCacheForID(id)).each(function(eventName) {
                                                                                element.stopObserving(eventName);
                                                                                });
                                                                                return element;
                                                                                }
                                                                                
                                                                                var wrapper = findWrapper(id, eventName, handler);
                                                                                if (!wrapper) return element;
                                                                                
                                                                                if (element.removeEventListener) {
                                                                                element.removeEventListener(name, wrapper, false);
                                                                                } else {
                                                                                element.detachEvent("on" + name, wrapper);
                                                                                }
                                                                                
                                                                                destroyWrapper(id, eventName, handler);
                                                                                
                                                                                return element;
                                                                                },
                                                                                
                                                                                fire: function(element, eventName, memo) {
                                                                                element = $(element);
                                                                                if (element == document && document.createEvent && !element.dispatchEvent)
                                                                                element = document.documentElement;
                                                                                
                                                                                var event;
                                                                                if (document.createEvent) {
                                                                                event = document.createEvent("HTMLEvents");
                                                                                event.initEvent("dataavailable", true, true);
                                                                                } else {
                                                                                event = document.createEventObject();
                                                                                event.eventType = "ondataavailable";
                                                                                }
                                                                                
                                                                                event.eventName = eventName;
                                                                                event.memo = memo || { };
                                                                                
                                                                                if (document.createEvent) {
                                                                                element.dispatchEvent(event);
                                                                                } else {
                                                                                element.fireEvent(event.eventType, event);
                                                                                }
                                                                                
                                                                                return Event.extend(event);
                                                                                }
                                                                                };
                                                                                })());
                                                                                
                                                                                Object.extend(Event, Event.Methods);
                                                                                
                                                                                Element.addMethods({
                                                                                fire:          Event.fire,
                                                                                observe:       Event.observe,
                                                                                stopObserving: Event.stopObserving
                                                                                });
                                                                                
                                                                                Object.extend(document, {
                                                                                fire:          Element.Methods.fire.methodize(),
                                                                                observe:       Element.Methods.observe.methodize(),
                                                                                stopObserving: Element.Methods.stopObserving.methodize(),
                                                                                loaded:        false
                                                                                });
                                                                                
                                                                                (function() {
                                                                                /* Support for the DOMContentLoaded event is based on work by Dan Webb,
                                                                                Matthias Miller, Dean Edwards and John Resig. */
                                                                                
                                                                                var timer;
                                                                                
                                                                                function fireContentLoadedEvent() {
                                                                                if (document.loaded) return;
                                                                                if (timer) window.clearInterval(timer);
                                                                                document.fire("dom:loaded");
                                                                                document.loaded = true;
                                                                                }
                                                                                
                                                                                if (document.addEventListener) {
                                                                                if (Prototype.Browser.WebKit) {
                                                                                timer = window.setInterval(function() {
                                                                                if (/loaded|complete/.test(document.readyState))
                                                                                fireContentLoadedEvent();
                                                                                }, 0);
                                                                                
                                                                                Event.observe(window, "load", fireContentLoadedEvent);
                                                                                
                                                                                } else {
                                                                                document.addEventListener("DOMContentLoaded",
                                                                                fireContentLoadedEvent, false);
                                                                                }
                                                                                
                                                                                } else {
                                                                                document.write("<script id=__onDOMContentLoaded defer src=//:><\/script>");
                                                                                $("__onDOMContentLoaded").onreadystatechange = function() {
                                                                                if (this.readyState == "complete") {
                                                                                this.onreadystatechange = null;
                                                                                fireContentLoadedEvent();
                                                                                }
                                                                                };
                                                                                }
                                                                                })();
                                                                                /*------------------------------- DEPRECATED -------------------------------*/
                                                                                
                                                                                Hash.toQueryString = Object.toQueryString;
                                                                                
                                                                                var Toggle = { display: Element.toggle };
                                                                                
                                                                                Element.Methods.childOf = Element.Methods.descendantOf;
                                                                                
                                                                                var Insertion = {
                                                                                Before: function(element, content) {
                                                                                return Element.insert(element, {before:content});
                                                                                },
                                                                                
                                                                                Top: function(element, content) {
                                                                                return Element.insert(element, {top:content});
                                                                                },
                                                                                
                                                                                Bottom: function(element, content) {
                                                                                return Element.insert(element, {bottom:content});
                                                                                },
                                                                                
                                                                                After: function(element, content) {
                                                                                return Element.insert(element, {after:content});
                                                                                }
                                                                                };
                                                                                
                                                                                var $continue = new Error('"throw $continue" is deprecated, use "return" instead');
                                                                                
                                                                                // This should be moved to script.aculo.us; notice the deprecated methods
                                                                                // further below, that map to the newer Element methods.
                                                                                var Position = {
                                                                                // set to true if needed, warning: firefox performance problems
                                                                                // NOT neeeded for page scrolling, only if draggable contained in
                                                                                // scrollable elements
                                                                                includeScrollOffsets: false,
                                                                                
                                                                                // must be called before calling withinIncludingScrolloffset, every time the
                                                                                // page is scrolled
                                                                                prepare: function() {
                                                                                this.deltaX =  window.pageXOffset
                                                                                || document.documentElement.scrollLeft
                                                                                || document.body.scrollLeft
                                                                                || 0;
                                                                                this.deltaY =  window.pageYOffset
                                                                                || document.documentElement.scrollTop
                                                                                || document.body.scrollTop
                                                                                || 0;
                                                                                },
                                                                                
                                                                                // caches x/y coordinate pair to use with overlap
                                                                                within: function(element, x, y) {
                                                                                if (this.includeScrollOffsets)
                                                                                return this.withinIncludingScrolloffsets(element, x, y);
                                                                                this.xcomp = x;
                                                                                this.ycomp = y;
                                                                                this.offset = Element.cumulativeOffset(element);
                                                                                
                                                                                return (y >= this.offset[1] &&
                                                                                y <  this.offset[1] + element.offsetHeight &&
                                                                                x >= this.offset[0] &&
                                                                                x <  this.offset[0] + element.offsetWidth);
                                                                                },
                                                                                
                                                                                withinIncludingScrolloffsets: function(element, x, y) {
                                                                                var offsetcache = Element.cumulativeScrollOffset(element);
                                                                                
                                                                                this.xcomp = x + offsetcache[0] - this.deltaX;
                                                                                this.ycomp = y + offsetcache[1] - this.deltaY;
                                                                                this.offset = Element.cumulativeOffset(element);
                                                                                
                                                                                return (this.ycomp >= this.offset[1] &&
                                                                                this.ycomp <  this.offset[1] + element.offsetHeight &&
                                                                                this.xcomp >= this.offset[0] &&
                                                                                this.xcomp <  this.offset[0] + element.offsetWidth);
                                                                                },
                                                                                
                                                                                // within must be called directly before
                                                                                overlap: function(mode, element) {
                                                                                if (!mode) return 0;
                                                                                if (mode == 'vertical')
                                                                                return ((this.offset[1] + element.offsetHeight) - this.ycomp) /
                                                                                element.offsetHeight;
                                                                                if (mode == 'horizontal')
                                                                                return ((this.offset[0] + element.offsetWidth) - this.xcomp) /
                                                                                element.offsetWidth;
                                                                                },
                                                                                
                                                                                // Deprecation layer -- use newer Element methods now (1.5.2).
                                                                                
                                                                                cumulativeOffset: Element.Methods.cumulativeOffset,
                                                                                
                                                                                positionedOffset: Element.Methods.positionedOffset,
                                                                                
                                                                                absolutize: function(element) {
                                                                                Position.prepare();
                                                                                return Element.absolutize(element);
                                                                                },
                                                                                
                                                                                relativize: function(element) {
                                                                                Position.prepare();
                                                                                return Element.relativize(element);
                                                                                },
                                                                                
                                                                                realOffset: Element.Methods.cumulativeScrollOffset,
                                                                                
                                                                                offsetParent: Element.Methods.getOffsetParent,
                                                                                
                                                                                page: Element.Methods.viewportOffset,
                                                                                
                                                                                clone: function(source, target, options) {
                                                                                options = options || { };
                                                                                return Element.clonePosition(target, source, options);
                                                                                }
                                                                                };
                                                                                
                                                                                /*--------------------------------------------------------------------------*/
                                                                                
                                                                                if (!document.getElementsByClassName) document.getElementsByClassName = function(instanceMethods){
                                                                                function iter(name) {
                                                                                return name.blank() ? null : "[contains(concat(' ', @class, ' '), ' " + name + " ')]";
                                                                                }
                                                                                
                                                                                instanceMethods.getElementsByClassName = Prototype.BrowserFeatures.XPath ?
                                                                                function(element, className) {
                                                                                className = className.toString().strip();
                                                                                var cond = /\s/.test(className) ? $w(className).map(iter).join('') : iter(className);
                                                                                return cond ? document._getElementsByXPath('.//*' + cond, element) : [];
                                                                                } : function(element, className) {
                                                                                className = className.toString().strip();
                                                                                var elements = [], classNames = (/\s/.test(className) ? $w(className) : null);
                                                                                if (!classNames && !className) return elements;
                                                                                
                                                                                var nodes = $(element).getElementsByTagName('*');
                                                                                className = ' ' + className + ' ';
                                                                                
                                                                                for (var i = 0, child, cn; child = nodes[i]; i++) {
                                                                                if (child.className && (cn = ' ' + child.className + ' ') && (cn.include(className) ||
                                                                                (classNames && classNames.all(function(name) {
                                                                                return !name.toString().blank() && cn.include(' ' + name + ' ');
                                                                                }))))
                                                                                elements.push(Element.extend(child));
                                                                                }
                                                                                return elements;
                                                                                };
                                                                                
                                                                                return function(className, parentElement) {
                                                                                return $(parentElement || document.body).getElementsByClassName(className);
                                                                                };
                                                                                }(Element.Methods);
                                                                                
                                                                                /*--------------------------------------------------------------------------*/
                                                                                
                                                                                Element.ClassNames = Class.create();
                                                                                Element.ClassNames.prototype = {
                                                                                initialize: function(element) {
                                                                                this.element = $(element);
                                                                                },
                                                                                
                                                                                _each: function(iterator) {
                                                                                this.element.className.split(/\s+/).select(function(name) {
                                                                                return name.length > 0;
                                                                                })._each(iterator);
                                                                                },
                                                                                
                                                                                set: function(className) {
                                                                                this.element.className = className;
                                                                                },
                                                                                
                                                                                add: function(classNameToAdd) {
                                                                                if (this.include(classNameToAdd)) return;
                                                                                this.set($A(this).concat(classNameToAdd).join(' '));
                                                                                },
                                                                                
                                                                                remove: function(classNameToRemove) {
                                                                                if (!this.include(classNameToRemove)) return;
                                                                                this.set($A(this).without(classNameToRemove).join(' '));
                                                                                },
                                                                                
                                                                                toString: function() {
                                                                                return $A(this).join(' ');
                                                                                }
                                                                                };
                                                                                
                                                                                Object.extend(Element.ClassNames.prototype, Enumerable);
                                                                                
                                                                                /*--------------------------------------------------------------------------*/
                                                                                
                                                                                Element.addMethods();
                                                                                
                                                                                /*
                                                                                * Raphael 0.8.1 - JavaScript Vector Library
                                                                                *
                                                                                * Copyright (c) 2008 - 2009 Dmitry Baranovskiy (http://raphaeljs.com)
                                                                                * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
                                                                                */
                                                                                
                                                                                
                                                                                window.Raphael = (function () {
                                                                                var separator = /[, ]+/,
                                                                                doc = document,
                                                                                win = window,
                                                                                oldRaphael = {
                                                                                was: "Raphael" in window,
                                                                                is: window.Raphael
                                                                                },
                                                                                R = function () {
                                                                                return create.apply(R, arguments);
                                                                                },
                                                                                paper = {},
                                                                                availableAttrs = {cx: 0, cy: 0, fill: "#fff", "fill-opacity": 1, font: '10px "Arial"', "font-family": '"Arial"', "font-size": "10", "font-style": "normal", "font-weight": 400, gradient: 0, height: 0, href: "http://raphaeljs.com/", opacity: 1, path: "M0,0", r: 0, rotation: 0, rx: 0, ry: 0, scale: "1 1", src: "", stroke: "#000", "stroke-dasharray": "", "stroke-linecap": "butt", "stroke-linejoin": "butt", "stroke-miterlimit": 0, "stroke-opacity": 1, "stroke-width": 1, target: "_blank", "text-anchor": "middle", title: "Raphael", translation: "0 0", width: 0, x: 0, y: 0},
                                                                                availableAnimAttrs = {cx: "number", cy: "number", fill: "colour", "fill-opacity": "number", "font-size": "number", height: "number", opacity: "number", path: "path", r: "number", rotation: "csv", rx: "number", ry: "number", scale: "csv", stroke: "colour", "stroke-opacity": "number", "stroke-width": "number", translation: "csv", width: "number", x: "number", y: "number"},
                                                                                events = ["click", "dblclick", "mousedown", "mousemove", "mouseout", "mouseover", "mouseup"];
                                                                                R.version = "0.8";
                                                                                R.type = (window.SVGAngle || document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1") ? "SVG" : "VML");
                                                                                R.svg = !(R.vml = R.type == "VML");
                                                                                R.idGenerator = 0;
                                                                                R.fn = {};
                                                                                R.setWindow = function (newwin) {
                                                                                win = newwin;
                                                                                doc = win.document;
                                                                                };
                                                                                // colour utilities
                                                                                R.hsb2rgb = function (hue, saturation, brightness) {
                                                                                if (typeof hue == "object" && "h" in hue && "s" in hue && "b" in hue) {
                                                                                brightness = hue.b;
                                                                                saturation = hue.s;
                                                                                hue = hue.h;
                                                                                }
                                                                                var red,
                                                                                green,
                                                                                blue;
                                                                                if (brightness == 0) {
                                                                                return {r: 0, g: 0, b: 0, hex: "#000"};
                                                                                }
                                                                                if (hue > 1 || saturation > 1 || brightness > 1) {
                                                                                hue /= 255;
                                                                                saturation /= 255;
                                                                                brightness /= 255;
                                                                                }
                                                                                var i = Math.floor(hue * 6),
                                                                                f = (hue * 6) - i,
                                                                                p = brightness * (1 - saturation),
                                                                                q = brightness * (1 - (saturation * f)),
                                                                                t = brightness * (1 - (saturation * (1 - f)));
                                                                                red = [brightness, q, p, p, t, brightness, brightness][i];
                                                                                green = [t, brightness, brightness, q, p, p, t][i];
                                                                                blue = [p, p, t, brightness, brightness, q, p][i];
                                                                                red *= 255;
                                                                                green *= 255;
                                                                                blue *= 255;
                                                                                var rgb = {r: red, g: green, b: blue};
                                                                                var r = Math.round(red).toString(16);
                                                                                if (r.length == 1) {
                                                                                r = "0" + r;
                                                                                }
                                                                                var g = Math.round(green).toString(16);
                                                                                if (g.length == 1) {
                                                                                g = "0" + g;
                                                                                }
                                                                                var b = Math.round(blue).toString(16);
                                                                                if (b.length == 1) {
                                                                                b = "0" + b;
                                                                                }
                                                                                rgb.hex = "#" + r + g + b;
                                                                                return rgb;
                                                                                };
                                                                                R.rgb2hsb = function (red, green, blue) {
                                                                                if (typeof red == "object" && "r" in red && "g" in red && "b" in red) {
                                                                                blue = red.b;
                                                                                green = red.g;
                                                                                red = red.r;
                                                                                }
                                                                                if (typeof red == "string") {
                                                                                var clr = R.getRGB(red);
                                                                                red = clr.r;
                                                                                green = clr.g;
                                                                                blue = clr.b;
                                                                                }
                                                                                if (red > 1 || green > 1 || blue > 1) {
                                                                                red /= 255;
                                                                                green /= 255;
                                                                                blue /= 255;
                                                                                }
                                                                                var max = Math.max(red, green, blue),
                                                                                min = Math.min(red, green, blue),
                                                                                hue,
                                                                                saturation,
                                                                                brightness = max;
                                                                                if (min == max) {
                                                                                return {h: 0, s: 0, b: max};
                                                                                } else {
                                                                                var delta = (max - min);
                                                                                saturation = delta / max;
                                                                                if (red == max) {
                                                                                hue = (green - blue) / delta;
                                                                                } else if (green == max) {
                                                                                hue = 2 + ((blue - red) / delta);
                                                                                } else {
                                                                                hue = 4 + ((red - green) / delta);
                                                                                }
                                                                                hue /= 6;
                                                                                if (hue < 0) {
                                                                                hue += 1;
                                                                                }
                                                                                if (hue > 1) {
                                                                                hue -= 1;
                                                                                }
                                                                                }
                                                                                return {h: hue, s: saturation, b: brightness};
                                                                                };
                                                                                var getRGBcache = {}, getRGBcount = [];
                                                                                R.getRGB = function (colour) {
                                                                                if (colour in getRGBcache) {
                                                                                return getRGBcache[colour];
                                                                                }
                                                                                var htmlcolors = {aliceblue: "#f0f8ff", amethyst: "#96c", antiquewhite: "#faebd7", aqua: "#0ff", aquamarine: "#7fffd4", azure: "#f0ffff", beige: "#f5f5dc", bisque: "#ffe4c4", black: "#000", blanchedalmond: "#ffebcd", blue: "#00f", blueviolet: "#8a2be2", brown: "#a52a2a", burlywood: "#deb887", cadetblue: "#5f9ea0", chartreuse: "#7fff00", chocolate: "#d2691e", coral: "#ff7f50", cornflowerblue: "#6495ed", cornsilk: "#fff8dc", crimson: "#dc143c", cyan: "#0ff", darkblue: "#00008b", darkcyan: "#008b8b", darkgoldenrod: "#b8860b", darkgray: "#a9a9a9", darkgreen: "#006400", darkkhaki: "#bdb76b", darkmagenta: "#8b008b", darkolivegreen: "#556b2f", darkorange: "#ff8c00", darkorchid: "#9932cc", darkred: "#8b0000", darksalmon: "#e9967a", darkseagreen: "#8fbc8f", darkslateblue: "#483d8b", darkslategray: "#2f4f4f", darkturquoise: "#00ced1", darkviolet: "#9400d3", deeppink: "#ff1493", deepskyblue: "#00bfff", dimgray: "#696969", dodgerblue: "#1e90ff", firebrick: "#b22222", floralwhite: "#fffaf0", forestgreen: "#228b22", fuchsia: "#f0f", gainsboro: "#dcdcdc", ghostwhite: "#f8f8ff", gold: "#ffd700", goldenrod: "#daa520", gray: "#808080", green: "#008000", greenyellow: "#adff2f", honeydew: "#f0fff0", hotpink: "#ff69b4", indianred: "#cd5c5c", indigo: "#4b0082", ivory: "#fffff0", khaki: "#f0e68c", lavender: "#e6e6fa", lavenderblush: "#fff0f5", lawngreen: "#7cfc00", lemonchiffon: "#fffacd", lightblue: "#add8e6", lightcoral: "#f08080", lightcyan: "#e0ffff", lightgoldenrodyellow: "#fafad2", lightgreen: "#90ee90", lightgrey: "#d3d3d3", lightpink: "#ffb6c1", lightsalmon: "#ffa07a", lightsalmon: "#ffa07a", lightseagreen: "#20b2aa", lightskyblue: "#87cefa", lightslategray: "#789", lightsteelblue: "#b0c4de", lightyellow: "#ffffe0", lime: "#0f0", limegreen: "#32cd32", linen: "#faf0e6", magenta: "#f0f", maroon: "#800000", mediumaquamarine: "#66cdaa", mediumblue: "#0000cd", mediumorchid: "#ba55d3", mediumpurple: "#9370db", mediumseagreen: "#3cb371", mediumslateblue: "#7b68ee", mediumslateblue: "#7b68ee", mediumspringgreen: "#00fa9a", mediumturquoise: "#48d1cc", mediumvioletred: "#c71585", midnightblue: "#191970", mintcream: "#f5fffa", mistyrose: "#ffe4e1", moccasin: "#ffe4b5", navajowhite: "#ffdead", navy: "#000080", oldlace: "#fdf5e6", olive: "#808000", olivedrab: "#6b8e23", orange: "#ffa500", orangered: "#ff4500", orchid: "#da70d6", palegoldenrod: "#eee8aa", palegreen: "#98fb98", paleturquoise: "#afeeee", palevioletred: "#db7093", papayawhip: "#ffefd5", peachpuff: "#ffdab9", peru: "#cd853f", pink: "#ffc0cb", plum: "#dda0dd", powderblue: "#b0e0e6", purple: "#800080", red: "#f00", rosybrown: "#bc8f8f", royalblue: "#4169e1", saddlebrown: "#8b4513", salmon: "#fa8072", sandybrown: "#f4a460", seagreen: "#2e8b57", seashell: "#fff5ee", sienna: "#a0522d", silver: "#c0c0c0", skyblue: "#87ceeb", slateblue: "#6a5acd", slategray: "#708090", snow: "#fffafa", springgreen: "#00ff7f", steelblue: "#4682b4", tan: "#d2b48c", teal: "#008080", thistle: "#d8bfd8", tomato: "#ff6347", turquoise: "#40e0d0", violet: "#ee82ee", wheat: "#f5deb3", white: "#fff", whitesmoke: "#f5f5f5", yellow: "#ff0", yellowgreen: "#9acd32"},
                                                                                res;
                                                                                if ((colour + "").toLowerCase() in htmlcolors) {
                                                                                colour = htmlcolors[colour.toString().toLowerCase()];
                                                                                }
                                                                                if (!colour) {
                                                                                return {r: 0, g: 0, b: 0, hex: "#000"};
                                                                                }
                                                                                if (colour == "none") {
                                                                                return {r: -1, g: -1, b: -1, hex: "none"};
                                                                                }
                                                                                var red, green, blue,
                                                                                rgb = (colour + "").match(/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgb\(\s*([\d\.]+\s*,\s*[\d\.]+\s*,\s*[\d\.]+)\s*\)|rgb\(\s*([\d\.]+%\s*,\s*[\d\.]+%\s*,\s*[\d\.]+%)\s*\)|hsb\(\s*([\d\.]+\s*,\s*[\d\.]+\s*,\s*[\d\.]+)\s*\)|hsb\(\s*([\d\.]+%\s*,\s*[\d\.]+%\s*,\s*[\d\.]+%)\s*\))\s*$/i);
                                                                                if (rgb) {
                                                                                if (rgb[2]) {
                                                                                blue = parseInt(rgb[2].substring(5), 16);
                                                                                green = parseInt(rgb[2].substring(3, 5), 16);
                                                                                red = parseInt(rgb[2].substring(1, 3), 16);
                                                                                }
                                                                                if (rgb[3]) {
                                                                                blue = parseInt(rgb[3].substring(3) + rgb[3].substring(3), 16);
                                                                                green = parseInt(rgb[3].substring(2, 3) + rgb[3].substring(2, 3), 16);
                                                                                red = parseInt(rgb[3].substring(1, 2) + rgb[3].substring(1, 2), 16);
                                                                                }
                                                                                if (rgb[4]) {
                                                                                rgb = rgb[4].split(/\s*,\s*/);
                                                                                red = parseFloat(rgb[0]);
                                                                                green = parseFloat(rgb[1]);
                                                                                blue = parseFloat(rgb[2]);
                                                                                }
                                                                                if (rgb[5]) {
                                                                                rgb = rgb[5].split(/\s*,\s*/);
                                                                                red = parseFloat(rgb[0]) * 2.55;
                                                                                green = parseFloat(rgb[1]) * 2.55;
                                                                                blue = parseFloat(rgb[2]) * 2.55;
                                                                                }
                                                                                if (rgb[6]) {
                                                                                rgb = rgb[6].split(/\s*,\s*/);
                                                                                red = parseFloat(rgb[0]);
                                                                                green = parseFloat(rgb[1]);
                                                                                blue = parseFloat(rgb[2]);
                                                                                return R.hsb2rgb(red, green, blue);
                                                                                }
                                                                                if (rgb[7]) {
                                                                                rgb = rgb[7].split(/\s*,\s*/);
                                                                                red = parseFloat(rgb[0]) * 2.55;
                                                                                green = parseFloat(rgb[1]) * 2.55;
                                                                                blue = parseFloat(rgb[2]) * 2.55;
                                                                                return R.hsb2rgb(red, green, blue);
                                                                                }
                                                                                var rgb = {r: red, g: green, b: blue};
                                                                                var r = Math.round(red).toString(16);
                                                                                (r.length == 1) && (r = "0" + r);
                                                                                var g = Math.round(green).toString(16);
                                                                                (g.length == 1) && (g = "0" + g);
                                                                                var b = Math.round(blue).toString(16);
                                                                                (b.length == 1) && (b = "0" + b);
                                                                                rgb.hex = "#" + r + g + b;
                                                                                res = rgb;
                                                                                } else {
                                                                                res = {r: -1, g: -1, b: -1, hex: "none"};
                                                                                }
                                                                                if (getRGBcount.length > 20) {
                                                                                delete getRGBcache[getRGBcount.unshift()];
                                                                                }
                                                                                getRGBcount.push(colour);
                                                                                getRGBcache[colour] = res;
                                                                                return res;
                                                                                };
                                                                                R.getColor = function (value) {
                                                                                var start = this.getColor.start = this.getColor.start || {h: 0, s: 1, b: value || .75},
                                                                                rgb = this.hsb2rgb(start.h, start.s, start.b);
                                                                                start.h += .075;
                                                                                if (start.h > 1) {
                                                                                start.h = 0;
                                                                                start.s -= .2;
                                                                                if (start.s <= 0) {
                                                                                this.getColor.start = {h: 0, s: 1, b: start.b};
                                                                                }
                                                                                }
                                                                                return rgb.hex;
                                                                                };
                                                                                R.getColor.reset = function () {
                                                                                delete this.start;
                                                                                };
                                                                                // path utilities
                                                                                var pathcache = {}, pathcount = [];
                                                                                R.parsePathString = function (pathString) {
                                                                                if (pathString in pathcache) {
                                                                                return pathcache[pathString];
                                                                                }
                                                                                var paramCounts = {a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0},
                                                                                data = [],
                                                                                toString = function () {
                                                                                var res = "";
                                                                                for (var i = 0, ii = this.length; i < ii; i++) {
                                                                                res += this[i][0] + this[i].join(",").substring(2);
                                                                                }
                                                                                return res;
                                                                                };
                                                                                if (pathString.toString.toString() == toString.toString()) {
                                                                                data = pathString;
                                                                                }
                                                                                if (!data.length) {
                                                                                pathString.replace(/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/ig, function (a, b, c) {
                                                                                var params = [], name = b.toLowerCase();
                                                                                c.replace(/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/ig, function (a, b) {
                                                                                b && params.push(+b);
                                                                                });
                                                                                while (params.length >= paramCounts[name]) {
                                                                                data.push([b].concat(params.splice(0, paramCounts[name])));
                                                                                if (!paramCounts[name]) {
                                                                                break;
                                                                                };
                                                                                }
                                                                                });
                                                                                data.toString = toString;
                                                                                }
                                                                                if (pathcount.length > 20) {
                                                                                delete pathcache[pathcount.unshift()];
                                                                                }
                                                                                pathcount.push(pathString);
                                                                                pathcache[pathString] = data;
                                                                                return data;
                                                                                };
                                                                                var pathDimensions = function (path) {
                                                                                var pathArray = path;
                                                                                if (typeof path == "string") {
                                                                                pathArray = R.parsePathString(path);
                                                                                }
                                                                                pathArray = pathToAbsolute(pathArray);
                                                                                var x = [], y = [], length = 0;
                                                                                for (var i = 0, ii = pathArray.length; i < ii; i++) {
                                                                                var pa = pathArray[i];
                                                                                switch (pa[0]) {
                                                                                case "Z":
                                                                                break;
                                                                                case "A":
                                                                                x.push(pa[pa.length - 2]);
                                                                                y.push(pa[pa.length - 1]);
                                                                                break;
                                                                                default:
                                                                                for (var j = 1, jj = pa.length; j < jj; j++) {
                                                                                (j % 2 ? x : y).push(pa[j]);
                                                                                }
                                                                                }
                                                                                }
                                                                                var minx = Math.min.apply(Math, x),
                                                                                miny = Math.min.apply(Math, y);
                                                                                if (!x.length) {
                                                                                return {
                                                                                x: 0,
                                                                                y: 0,
                                                                                width: 0,
                                                                                height: 0,
                                                                                X: 0,
                                                                                Y: 0
                                                                                };
                                                                                } else {
                                                                                return {
                                                                                x: minx,
                                                                                y: miny,
                                                                                width: Math.max.apply(Math, x) - minx,
                                                                                height: Math.max.apply(Math, y) - miny,
                                                                                X: x,
                                                                                Y: y
                                                                                };
                                                                                }
                                                                                },
                                                                                pathToRelative = function (pathArray) {
                                                                                var res = [];
                                                                                if (typeof pathArray == "string") {
                                                                                pathArray = R.parsePathString(pathArray);
                                                                                }
                                                                                var x = 0, y = 0, start = 0;
                                                                                if (pathArray[0][0] == "M") {
                                                                                x = pathArray[0][1];
                                                                                y = pathArray[0][2];
                                                                                start++;
                                                                                res.push(["M", x, y]);
                                                                                }
                                                                                for (var i = start, ii = pathArray.length; i < ii; i++) {
                                                                                var r = res[i] = [],
                                                                                pa = pathArray[i];
                                                                                if (pa[0] != pa[0].toLowerCase()) {
                                                                                r[0] = pa[0].toLowerCase();
                                                                                switch (r[0]) {
                                                                                case "a":
                                                                                r[1] = pa[1];
                                                                                r[2] = pa[2];
                                                                                r[3] = 0;
                                                                                r[4] = pa[4];
                                                                                r[5] = pa[5];
                                                                                r[6] = +(pa[6] - x).toFixed(3);
                                                                                r[7] = +(pa[7] - y).toFixed(3);
                                                                                break;
                                                                                case "v":
                                                                                r[1] = (pa[1] - y).toFixed(3);
                                                                                break;
                                                                                default:
                                                                                for (var j = 1, jj = pa.length; j < jj; j++) {
                                                                                r[j] = +(pa[j] - ((j % 2) ? x : y)).toFixed(3);
                                                                                }
                                                                                }
                                                                                } else {
                                                                                r = res[i] = [];
                                                                                for (var k = 0, kk = pa.length; k < kk; k++) {
                                                                                res[i][k] = pa[k];
                                                                                }
                                                                                }
                                                                                switch (res[i][0]) {
                                                                                case "z":
                                                                                break;
                                                                                case "h":
                                                                                x += res[i][res[i].length - 1];
                                                                                break;
                                                                                case "v":
                                                                                y += res[i][res[i].length - 1];
                                                                                break;
                                                                                default:
                                                                                x += res[i][res[i].length - 2];
                                                                                y += res[i][res[i].length - 1];
                                                                                }
                                                                                }
                                                                                res.toString = pathArray.toString;
                                                                                return res;
                                                                                },
                                                                                pathToAbsolute = function (pathArray) {
                                                                                var res = [];
                                                                                if (typeof pathArray == "string") {
                                                                                pathArray = R.parsePathString(pathArray);
                                                                                }
                                                                                var x = 0,
                                                                                y = 0,
                                                                                start = 0;
                                                                                if (pathArray[0][0] == "M") {
                                                                                x = +pathArray[0][1];
                                                                                y = +pathArray[0][2];
                                                                                start++;
                                                                                res[0] = ["M", x, y];
                                                                                }
                                                                                for (var i = start, ii = pathArray.length; i < ii; i++) {
                                                                                var r = res[i] = [],
                                                                                pa = pathArray[i];
                                                                                if (pa[0] != (pa[0] + "").toUpperCase()) {
                                                                                r[0] = (pa[0] + "").toUpperCase();
                                                                                switch (r[0]) {
                                                                                case "A":
                                                                                r[1] = pa[1];
                                                                                r[2] = pa[2];
                                                                                r[3] = 0;
                                                                                r[4] = pa[4];
                                                                                r[5] = pa[5];
                                                                                r[6] = +(pa[6] + x).toFixed(3);
                                                                                r[7] = +(pa[7] + y).toFixed(3);
                                                                                break;
                                                                                case "V":
                                                                                r[1] = +pa[1] + y;
                                                                                break;
                                                                                case "H":
                                                                                r[1] = +pa[1] + x;
                                                                                break;
                                                                                default:
                                                                                for (var j = 1, jj = pa.length; j < jj; j++) {
                                                                                r[j] = +pa[j] + ((j % 2) ? x : y);
                                                                                }
                                                                                }
                                                                                } else {
                                                                                r = res[i] = [];
                                                                                for (var k = 0, kk = pa.length; k < kk; k++) {
                                                                                res[i][k] = pa[k];
                                                                                }
                                                                                }
                                                                                switch (r[0]) {
                                                                                case "Z":
                                                                                break;
                                                                                case "H":
                                                                                x = r[1];
                                                                                break;
                                                                                case "V":
                                                                                y = r[1];
                                                                                break;
                                                                                default:
                                                                                x = res[i][res[i].length - 2];
                                                                                y = res[i][res[i].length - 1];
                                                                                }
                                                                                }
                                                                                res.toString = pathArray.toString;
                                                                                return res;
                                                                                },
                                                                                pecache = {}, pecount = [],
                                                                                pathEqualiser = function (path1, path2) {
                                                                                if ((path1 + path2) in pecache) {
                                                                                return pecache[path1 + path2];
                                                                                }
                                                                                var data = [pathToAbsolute(R.parsePathString(path1)), pathToAbsolute(R.parsePathString(path2))],
                                                                                attrs = [{x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0}, {x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0}],
                                                                                processPath = function (path, d) {
                                                                                if (!path) {
                                                                                return ["U"];
                                                                                }
                                                                                switch (path[0]) {
                                                                                case "M":
                                                                                d.X = path[1];
                                                                                d.Y = path[2];
                                                                                break;
                                                                                case "S":
                                                                                var nx = d.x + (d.x - (d.bx || d.x));
                                                                                var ny = d.y + (d.y - (d.by || d.y));
                                                                                path = ["C", nx, ny, path[1], path[2], path[3], path[4]];
                                                                                break;
                                                                                case "T":
                                                                                var nx = d.x + (d.x - (d.bx || d.x));
                                                                                var ny = d.y + (d.y - (d.by || d.y));
                                                                                path = ["Q", nx, ny, path[1], path[2]];
                                                                                break;
                                                                                case "H":
                                                                                path = ["L", path[1], d.y];
                                                                                break;
                                                                                case "V":
                                                                                path = ["L", d.x, path[1]];
                                                                                break;
                                                                                case "Z":
                                                                                path = ["L", d.X, d.Y];
                                                                                break;
                                                                                }
                                                                                return path;
                                                                                },
                                                                                edgeCases = function (a, b, i) {
                                                                                if (data[a][i][0] == "M" && data[b][i][0] != "M") {
                                                                                data[b].splice(i, 0, ["M", attrs[b].x, attrs[b].y]);
                                                                                attrs[a].bx = data[a][i][data[a][i].length - 4] || 0;
                                                                                attrs[a].by = data[a][i][data[a][i].length - 3] || 0;
                                                                                attrs[a].x = data[a][i][data[a][i].length - 2];
                                                                                attrs[a].y = data[a][i][data[a][i].length - 1];
                                                                                return true;
                                                                                } else if (data[a][i][0] == "L" && data[b][i][0] == "C") {
                                                                                data[a][i] = ["C", attrs[a].x, attrs[a].y, data[a][i][1], data[a][i][2], data[a][i][1], data[a][i][2]];
                                                                                } else if (data[a][i][0] == "L" && data[b][i][0] == "Q") {
                                                                                data[a][i] = ["Q", data[a][i][1], data[a][i][2], data[a][i][1], data[a][i][2]];
                                                                                } else if (data[a][i][0] == "Q" && data[b][i][0] == "C") {
                                                                                var x = data[b][i][data[b][i].length - 2];
                                                                                var y = data[b][i][data[b][i].length - 1];
                                                                                data[b].splice(i + 1, 0, ["Q", x, y, x, y]);
                                                                                data[a].splice(i, 0, ["C", attrs[a].x, attrs[a].y, attrs[a].x, attrs[a].y, attrs[a].x, attrs[a].y]);
                                                                                i++;
                                                                                attrs[b].bx = data[b][i][data[b][i].length - 4] || 0;
                                                                                attrs[b].by = data[b][i][data[b][i].length - 3] || 0;
                                                                                attrs[b].x = data[b][i][data[b][i].length - 2];
                                                                                attrs[b].y = data[b][i][data[b][i].length - 1];
                                                                                return true;
                                                                                } else if (data[a][i][0] == "A" && data[b][i][0] == "C") {
                                                                                var x = data[b][i][data[b][i].length - 2];
                                                                                var y = data[b][i][data[b][i].length - 1];
                                                                                data[b].splice(i + 1, 0, ["A", 0, 0, data[a][i][3], data[a][i][4], data[a][i][5], x, y]);
                                                                                data[a].splice(i, 0, ["C", attrs[a].x, attrs[a].y, attrs[a].x, attrs[a].y, attrs[a].x, attrs[a].y]);
                                                                                i++;
                                                                                attrs[b].bx = data[b][i][data[b][i].length - 4] || 0;
                                                                                attrs[b].by = data[b][i][data[b][i].length - 3] || 0;
                                                                                attrs[b].x = data[b][i][data[b][i].length - 2];
                                                                                attrs[b].y = data[b][i][data[b][i].length - 1];
                                                                                return true;
                                                                                } else if (data[a][i][0] == "U") {
                                                                                data[a][i][0] = data[b][i][0];
                                                                                for (var j = 1, jj = data[b][i].length; j < jj; j++) {
                                                                                data[a][i][j] = (j % 2) ? attrs[a].x : attrs[a].y;
                                                                                }
                                                                                }
                                                                                return false;
                                                                                };
                                                                                for (var i = 0; i < Math.max(data[0].length, data[1].length); i++) {
                                                                                data[0][i] = processPath(data[0][i], attrs[0]);
                                                                                data[1][i] = processPath(data[1][i], attrs[1]);
                                                                                if (data[0][i][0] != data[1][i][0] && (edgeCases(0, 1, i) || edgeCases(1, 0, i))) {
                                                                                continue;
                                                                                }
                                                                                attrs[0].bx = data[0][i][data[0][i].length - 4] || 0;
                                                                                attrs[0].by = data[0][i][data[0][i].length - 3] || 0;
                                                                                attrs[0].x = data[0][i][data[0][i].length - 2];
                                                                                attrs[0].y = data[0][i][data[0][i].length - 1];
                                                                                attrs[1].bx = data[1][i][data[1][i].length - 4] || 0;
                                                                                attrs[1].by = data[1][i][data[1][i].length - 3] || 0;
                                                                                attrs[1].x = data[1][i][data[1][i].length - 2];
                                                                                attrs[1].y = data[1][i][data[1][i].length - 1];
                                                                                }
                                                                                if (pecount.length > 20) {
                                                                                delete pecache[pecount.unshift()];
                                                                                }
                                                                                pecount.push(path1 + path2);
                                                                                pecache[path1 + path2] = data;
                                                                                return data;
                                                                                },
                                                                                toGradient = function (gradient) {
                                                                                if (typeof gradient == "string") {
                                                                                gradient = gradient.split(/\s*\-\s*/);
                                                                                var angle = gradient.shift();
                                                                                if (angle.toLowerCase() == "v") {
                                                                                angle = 90;
                                                                                } else if (angle.toLowerCase() == "h") {
                                                                                angle = 0;
                                                                                } else {
                                                                                angle = parseFloat(angle);
                                                                                }
                                                                                angle = -angle;
                                                                                var grobj = {angle: angle, type: "linear", dots: [], vector: [0, 0, Math.cos(angle * Math.PI / 180).toFixed(3), Math.sin(angle * Math.PI / 180).toFixed(3)]};
                                                                                var max = 1 / (Math.max(Math.abs(grobj.vector[2]), Math.abs(grobj.vector[3])) || 1);
                                                                                grobj.vector[2] *= max;
                                                                                grobj.vector[3] *= max;
                                                                                if (grobj.vector[2] < 0) {
                                                                                grobj.vector[0] = -grobj.vector[2];
                                                                                grobj.vector[2] = 0;
                                                                                }
                                                                                if (grobj.vector[3] < 0) {
                                                                                grobj.vector[1] = -grobj.vector[3];
                                                                                grobj.vector[3] = 0;
                                                                                }
                                                                                grobj.vector[0] = grobj.vector[0].toFixed(3);
                                                                                grobj.vector[1] = grobj.vector[1].toFixed(3);
                                                                                grobj.vector[2] = grobj.vector[2].toFixed(3);
                                                                                grobj.vector[3] = grobj.vector[3].toFixed(3);
                                                                                for (var i = 0, ii = gradient.length; i < ii; i++) {
                                                                                var dot = {};
                                                                                var par = gradient[i].match(/^([^:]*):?([\d\.]*)/);
                                                                                dot.color = R.getRGB(par[1]).hex;
                                                                                par[2] && (dot.offset = par[2] + "%");
                                                                                grobj.dots.push(dot);
                                                                                }
                                                                                for (var i = 1, ii = grobj.dots.length - 1; i < ii; i++) {
                                                                                if (!grobj.dots[i].offset) {
                                                                                var start = parseFloat(grobj.dots[i - 1].offset || 0),
                                                                                end = false;
                                                                                for (var j = i + 1; j < ii; j++) {
                                                                                if (grobj.dots[j].offset) {
                                                                                end = grobj.dots[j].offset;
                                                                                break;
                                                                                }
                                                                                }
                                                                                if (!end) {
                                                                                end = 100;
                                                                                j = ii;
                                                                                }
                                                                                end = parseFloat(end);
                                                                                var d = (end - start) / (j - i + 1);
                                                                                for (; i < j; i++) {
                                                                                start += d;
                                                                                grobj.dots[i].offset = start + "%";
                                                                                }
                                                                                }
                                                                                }
                                                                                return grobj;
                                                                                } else {
                                                                                return gradient;
                                                                                }
                                                                                },
                                                                                getContainer = function () {
                                                                                var container, x, y, width, height;
                                                                                if (typeof arguments[0] == "string" || typeof arguments[0] == "object") {
                                                                                if (typeof arguments[0] == "string") {
                                                                                container = doc.getElementById(arguments[0]);
                                                                                } else {
                                                                                container = arguments[0];
                                                                                }
                                                                                if (container.tagName) {
                                                                                if (arguments[1] == null) {
                                                                                return {
                                                                                container: container,
                                                                                width: container.style.pixelWidth || container.offsetWidth,
                                                                                height: container.style.pixelHeight || container.offsetHeight
                                                                                };
                                                                                } else {
                                                                                return {container: container, width: arguments[1], height: arguments[2]};
                                                                                }
                                                                                }
                                                                                } else if (typeof arguments[0] == "number" && arguments.length > 3) {
                                                                                return {container: 1, x: arguments[0], y: arguments[1], width: arguments[2], height: arguments[3]};
                                                                                }
                                                                                },
                                                                                plugins = function (con, add) {
                                                                                var that = this;
                                                                                for (var prop in add) if (add.hasOwnProperty(prop) && !(prop in con)) {
                                                                                switch (typeof add[prop]) {
                                                                                case "function":
                                                                                (function (f) {
                                                                                con[prop] = con === that ? f : function () { return f.apply(that, arguments); };
                                                                                })(add[prop]);
                                                                                break;
                                                                                case "object":
                                                                                con[prop] = con[prop] || {};
                                                                                plugins.call(this, con[prop], add[prop]);
                                                                                break;
                                                                                default:
                                                                                con[prop] = add[prop];
                                                                                break;
                                                                                }
                                                                                }
                                                                                };
                                                                                
                                                                                // SVG
                                                                                if (R.svg) {
                                                                                R.toString = function () {
                                                                                return  "Your browser supports SVG.\nYou are running Rapha\u00ebl " + this.version;
                                                                                };
                                                                                var thePath = function (params, pathString, SVG) {
                                                                                var el = doc.createElementNS(SVG.svgns, "path");
                                                                                if (SVG.canvas) {
                                                                                SVG.canvas.appendChild(el);
                                                                                }
                                                                                var p = new Element(el, SVG);
                                                                                p.isAbsolute = true;
                                                                                p.type = "path";
                                                                                p.last = {x: 0, y: 0, bx: 0, by: 0};
                                                                                p.absolutely = function () {
                                                                                this.isAbsolute = true;
                                                                                return this;
                                                                                };
                                                                                p.relatively = function () {
                                                                                this.isAbsolute = false;
                                                                                return this;
                                                                                };
                                                                                p.moveTo = function (x, y) {
                                                                                var d = this.isAbsolute?"M":"m";
                                                                                d += parseFloat(x).toFixed(3) + " " + parseFloat(y).toFixed(3) + " ";
                                                                                var oldD = this[0].getAttribute("d") || "";
                                                                                (oldD == "M0,0") && (oldD = "");
                                                                                this[0].setAttribute("d", oldD + d);
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(x);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(y);
                                                                                this.attrs.path = oldD + d;
                                                                                return this;
                                                                                };
                                                                                p.lineTo = function (x, y) {
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(x);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(y);
                                                                                var d = this.isAbsolute?"L":"l";
                                                                                d += parseFloat(x).toFixed(3) + " " + parseFloat(y).toFixed(3) + " ";
                                                                                var oldD = this[0].getAttribute("d") || "";
                                                                                this[0].setAttribute("d", oldD + d);
                                                                                this.attrs.path = oldD + d;
                                                                                return this;
                                                                                };
                                                                                p.arcTo = function (rx, ry, large_arc_flag, sweep_flag, x, y) {
                                                                                var d = this.isAbsolute ? "A" : "a";
                                                                                d += [parseFloat(rx).toFixed(3), parseFloat(ry).toFixed(3), 0, large_arc_flag, sweep_flag, parseFloat(x).toFixed(3), parseFloat(y).toFixed(3)].join(" ");
                                                                                var oldD = this[0].getAttribute("d") || "";
                                                                                this[0].setAttribute("d", oldD + d);
                                                                                this.last.x = parseFloat(x);
                                                                                this.last.y = parseFloat(y);
                                                                                this.attrs.path = oldD + d;
                                                                                return this;
                                                                                };
                                                                                p.cplineTo = function (x1, y1, w1) {
                                                                                if (!w1) {
                                                                                return this.lineTo(x1, y1);
                                                                                } else {
                                                                                var p = {};
                                                                                var x = parseFloat(x1);
                                                                                var y = parseFloat(y1);
                                                                                var w = parseFloat(w1);
                                                                                var d = this.isAbsolute?"C":"c";
                                                                                var attr = [+this.last.x + w, +this.last.y, x - w, y, x, y];
                                                                                for (var i = 0, ii = attr.length; i < ii; i++) {
                                                                                d += attr[i].toFixed(3) + " ";
                                                                                }
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + attr[4];
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + attr[5];
                                                                                this.last.bx = attr[2];
                                                                                this.last.by = attr[3];
                                                                                var oldD = this[0].getAttribute("d") || "";
                                                                                this[0].setAttribute("d", oldD + d);
                                                                                this.attrs.path = oldD + d;
                                                                                return this;
                                                                                }
                                                                                };
                                                                                p.curveTo = function () {
                                                                                var p = {},
                                                                                command = [0, 1, 2, 3, "s", 5, "c"];
                                                                                
                                                                                var d = command[arguments.length];
                                                                                if (this.isAbsolute) {
                                                                                d = d.toUpperCase();
                                                                                }
                                                                                for (var i = 0, ii = arguments.length; i < ii; i++) {
                                                                                d += parseFloat(arguments[i]).toFixed(3) + " ";
                                                                                }
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(arguments[arguments.length - 2]);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(arguments[arguments.length - 1]);
                                                                                this.last.bx = parseFloat(arguments[arguments.length - 4]);
                                                                                this.last.by = parseFloat(arguments[arguments.length - 3]);
                                                                                var oldD = this.node.getAttribute("d") || "";
                                                                                this.node.setAttribute("d", oldD + d);
                                                                                this.attrs.path = oldD + d;
                                                                                return this;
                                                                                };
                                                                                p.qcurveTo = function () {
                                                                                var p = {},
                                                                                command = [0, 1, "t", 3, "q"];
                                                                                
                                                                                var d = command[arguments.length];
                                                                                if (this.isAbsolute) {
                                                                                d = d.toUpperCase();
                                                                                }
                                                                                for (var i = 0, ii = arguments.length; i < ii; i++) {
                                                                                d += parseFloat(arguments[i]).toFixed(3) + " ";
                                                                                }
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(arguments[arguments.length - 2]);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(arguments[arguments.length - 1]);
                                                                                if (arguments.length != 2) {
                                                                                this.last.qx = parseFloat(arguments[arguments.length - 4]);
                                                                                this.last.qy = parseFloat(arguments[arguments.length - 3]);
                                                                                }
                                                                                var oldD = this.node.getAttribute("d") || "";
                                                                                this.node.setAttribute("d", oldD + d);
                                                                                this.attrs.path = oldD + d;
                                                                                return this;
                                                                                };
                                                                                p.addRoundedCorner = function (r, dir) {
                                                                                var R = .5522 * r, rollback = this.isAbsolute, o = this;
                                                                                if (rollback) {
                                                                                this.relatively();
                                                                                rollback = function () {
                                                                                o.absolutely();
                                                                                };
                                                                                } else {
                                                                                rollback = function () {};
                                                                                }
                                                                                var actions = {
                                                                                l: function () {
                                                                                return {
                                                                                u: function () {
                                                                                o.curveTo(-R, 0, -r, -(r - R), -r, -r);
                                                                                },
                                                                                d: function () {
                                                                                o.curveTo(-R, 0, -r, r - R, -r, r);
                                                                                }
                                                                                };
                                                                                },
                                                                                r: function () {
                                                                                return {
                                                                                u: function () {
                                                                                o.curveTo(R, 0, r, -(r - R), r, -r);
                                                                                },
                                                                                d: function () {
                                                                                o.curveTo(R, 0, r, r - R, r, r);
                                                                                }
                                                                                };
                                                                                },
                                                                                u: function () {
                                                                                return {
                                                                                r: function () {
                                                                                o.curveTo(0, -R, -(R - r), -r, r, -r);
                                                                                },
                                                                                l: function () {
                                                                                o.curveTo(0, -R, R - r, -r, -r, -r);
                                                                                }
                                                                                };
                                                                                },
                                                                                d: function () {
                                                                                return {
                                                                                r: function () {
                                                                                o.curveTo(0, R, -(R - r), r, r, r);
                                                                                },
                                                                                l: function () {
                                                                                o.curveTo(0, R, R - r, r, -r, r);
                                                                                }
                                                                                };
                                                                                }
                                                                                };
                                                                                actions[dir[0]]()[dir[1]]();
                                                                                rollback();
                                                                                return o;
                                                                                };
                                                                                p.andClose = function () {
                                                                                var oldD = this[0].getAttribute("d") || "";
                                                                                this[0].setAttribute("d", oldD + "Z ");
                                                                                this.attrs.path = oldD + "Z ";
                                                                                return this;
                                                                                };
                                                                                if (pathString) {
                                                                                p.attrs.path = "" + pathString;
                                                                                p.absolutely();
                                                                                paper.pathfinder(p, p.attrs.path);
                                                                                }
                                                                                if (params) {
                                                                                !params.gradient && (params.fill = params.fill || "none");
                                                                                params.stroke = params.stroke || "#000";
                                                                                } else {
                                                                                params = {fill: "none", stroke: "#000"};
                                                                                }
                                                                                setFillAndStroke(p, params);
                                                                                return p;
                                                                                };
                                                                                var addGradientFill = function (o, gradient, SVG) {
                                                                                gradient = toGradient(gradient);
                                                                                var el = doc.createElementNS(SVG.svgns, (gradient.type || "linear") + "Gradient");
                                                                                el.id = "raphael-gradient-" + R.idGenerator++;
                                                                                if (gradient.vector && gradient.vector.length) {
                                                                                el.setAttribute("x1", gradient.vector[0]);
                                                                                el.setAttribute("y1", gradient.vector[1]);
                                                                                el.setAttribute("x2", gradient.vector[2]);
                                                                                el.setAttribute("y2", gradient.vector[3]);
                                                                                }
                                                                                SVG.defs.appendChild(el);
                                                                                var isopacity = true;
                                                                                for (var i = 0, ii = gradient.dots.length; i < ii; i++) {
                                                                                var stop = doc.createElementNS(SVG.svgns, "stop");
                                                                                if (gradient.dots[i].offset) {
                                                                                isopacity = false;
                                                                                }
                                                                                stop.setAttribute("offset", gradient.dots[i].offset ? gradient.dots[i].offset : (i == 0) ? "0%" : "100%");
                                                                                stop.setAttribute("stop-color", R.getRGB(gradient.dots[i].color).hex || "#fff");
                                                                                // ignoring opacity for internal points, because VML doesn't support it
                                                                                el.appendChild(stop);
                                                                                };
                                                                                if (isopacity && typeof gradient.dots[ii - 1].opacity != "undefined") {
                                                                                stop.setAttribute("stop-opacity", gradient.dots[ii - 1].opacity);
                                                                                }
                                                                                o.setAttribute("fill", "url(#" + el.id + ")");
                                                                                o.style.fill = "";
                                                                                o.style.opacity = 1;
                                                                                o.style.fillOpacity = 1;
                                                                                o.setAttribute("opacity", 1);
                                                                                o.setAttribute("fill-opacity", 1);
                                                                                };
                                                                                var updatePosition = function (o) {
                                                                                if (o.pattern) {
                                                                                var bbox = o.getBBox();
                                                                                o.pattern.setAttribute("patternTransform", "translate(".concat(bbox.x, ",", bbox.y, ")"));
                                                                                }
                                                                                };
                                                                                var setFillAndStroke = function (o, params) {
                                                                                var dasharray = {
                                                                                "-": [3, 1],
                                                                                ".": [1, 1],
                                                                                "-.": [3, 1, 1, 1],
                                                                                "-..": [3, 1, 1, 1, 1, 1],
                                                                                ". ": [1, 3],
                                                                                "- ": [4, 3],
                                                                                "--": [8, 3],
                                                                                "- .": [4, 3, 1, 3],
                                                                                "--.": [8, 3, 1, 3],
                                                                                "--..": [8, 3, 1, 3, 1, 3]
                                                                                },
                                                                                node = o.node,
                                                                                attrs = o.attrs;
                                                                                addDashes = function (o, value) {
                                                                                value = dasharray[value.toString().toLowerCase()];
                                                                                if (value) {
                                                                                var width = o.attrs["stroke-width"] || "1",
                                                                                butt = {round: width, square: width, butt: 0}[o.attrs["stroke-linecap"] || params["stroke-linecap"]] || 0,
                                                                                dashes = [];
                                                                                for (var i = 0, ii = value.length; i < ii; i++) {
                                                                                dashes.push(value[i] * width + ((i % 2) ? 1 : -1) * butt);
                                                                                }
                                                                                value = dashes.join(",");
                                                                                node.setAttribute("stroke-dasharray", value);
                                                                                }
                                                                                };
                                                                                for (var att in params) {
                                                                                if (!(att in availableAttrs)) {
                                                                                continue;
                                                                                }
                                                                                var value = params[att];
                                                                                attrs[att] = value;
                                                                                switch (att) {
                                                                                // Hyperlink
                                                                                case "href":
                                                                                case "title":
                                                                                case "target":
                                                                                var pn = node.parentNode;
                                                                                if (pn.tagName.toLowerCase() != "a") {
                                                                                var hl = doc.createElementNS(o.paper.svgns, "a");
                                                                                pn.insertBefore(hl, node);
                                                                                hl.appendChild(node);
                                                                                pn = hl;
                                                                                }
                                                                                pn.setAttributeNS(o.paper.xlink, att, value);
                                                                                break;
                                                                                case "path":
                                                                                if (o.type == "path") {
                                                                                node.setAttribute("d", "M0,0");
                                                                                paper.pathfinder(o, value);
                                                                                }
                                                                                case "width":
                                                                                node.setAttribute(att, value);
                                                                                if (attrs.fx) {
                                                                                att = "x";
                                                                                value = attrs.x;
                                                                                } else {
                                                                                break;
                                                                                }
                                                                                case "x":
                                                                                if (attrs.fx) {
                                                                                value = -attrs.x - (attrs.width || 0);
                                                                                }
                                                                                case "rx":
                                                                                case "cx":
                                                                                node.setAttribute(att, value);
                                                                                updatePosition(o);
                                                                                break;
                                                                                case "height":
                                                                                node.setAttribute(att, value);
                                                                                if (attrs.fy) {
                                                                                att = "y";
                                                                                value = attrs.y;
                                                                                } else {
                                                                                break;
                                                                                }
                                                                                case "y":
                                                                                if (attrs.fy) {
                                                                                value = -attrs.y - (attrs.height || 0);
                                                                                }
                                                                                case "ry":
                                                                                case "cy":
                                                                                node.setAttribute(att, value);
                                                                                updatePosition(o);
                                                                                break;
                                                                                case "r":
                                                                                if (o.type == "rect") {
                                                                                node.setAttribute("rx", value);
                                                                                node.setAttribute("ry", value);
                                                                                } else {
                                                                                node.setAttribute(att, value);
                                                                                }
                                                                                break;
                                                                                case "src":
                                                                                if (o.type == "image") {
                                                                                node.setAttributeNS(o.paper.xlink, "href", value);
                                                                                }
                                                                                break;
                                                                                case "stroke-width":
                                                                                node.style.strokeWidth = value;
                                                                                // Need following line for Firefox
                                                                                node.setAttribute(att, value);
                                                                                if (attrs["stroke-dasharray"]) {
                                                                                addDashes(o, attrs["stroke-dasharray"]);
                                                                                }
                                                                                break;
                                                                                case "stroke-dasharray":
                                                                                addDashes(o, value);
                                                                                break;
                                                                                case "rotation":
                                                                                o.rotate(value, true);
                                                                                break;
                                                                                case "translation":
                                                                                var xy = (value + "").split(separator);
                                                                                o.translate((+xy[0] + 1 || 2) - 1, (+xy[1] + 1 || 2) - 1);
                                                                                break;
                                                                                case "scale":
                                                                                var xy = (value + "").split(separator);
                                                                                o.scale(+xy[0] || 1, +xy[1] || +xy[0] || 1, +xy[2] || null, +xy[3] || null);
                                                                                break;
                                                                                case "fill":
                                                                                var isURL = (value + "").match(/^url\(([^\)]+)\)$/i);
                                                                                if (isURL) {
                                                                                var el = doc.createElementNS(o.paper.svgns, "pattern");
                                                                                var ig = doc.createElementNS(o.paper.svgns, "image");
                                                                                el.id = "raphael-pattern-" + R.idGenerator++;
                                                                                el.setAttribute("x", 0);
                                                                                el.setAttribute("y", 0);
                                                                                el.setAttribute("patternUnits", "userSpaceOnUse");
                                                                                ig.setAttribute("x", 0);
                                                                                ig.setAttribute("y", 0);
                                                                                ig.setAttributeNS(o.paper.xlink, "href", isURL[1]);
                                                                                el.appendChild(ig);
                                                                                
                                                                                var img = doc.createElement("img");
                                                                                img.style.position = "absolute";
                                                                                img.style.top = "-9999em";
                                                                                img.style.left = "-9999em";
                                                                                img.onload = function () {
                                                                                el.setAttribute("width", this.offsetWidth);
                                                                                el.setAttribute("height", this.offsetHeight);
                                                                                ig.setAttribute("width", this.offsetWidth);
                                                                                ig.setAttribute("height", this.offsetHeight);
                                                                                doc.body.removeChild(this);
                                                                                paper.safari();
                                                                                };
                                                                                doc.body.appendChild(img);
                                                                                img.src = isURL[1];
                                                                                o.paper.defs.appendChild(el);
                                                                                node.style.fill = "url(#" + el.id + ")";
                                                                                node.setAttribute("fill", "url(#" + el.id + ")");
                                                                                o.pattern = el;
                                                                                updatePosition(o);
                                                                                break;
                                                                                }
                                                                                delete params.gradient;
                                                                                delete attrs.gradient;
                                                                                if (typeof attrs.opacity != "undefined" && typeof params.opacity == "undefined" ) {
                                                                                node.style.opacity = attrs.opacity;
                                                                                // Need following line for Firefox
                                                                                node.setAttribute("opacity", attrs.opacity);
                                                                                }
                                                                                if (typeof attrs["fill-opacity"] != "undefined" && typeof params["fill-opacity"] == "undefined" ) {
                                                                                node.style.fillOpacity = o.attrs["fill-opacity"];
                                                                                // Need following line for Firefox
                                                                                node.setAttribute("fill-opacity", attrs["fill-opacity"]);
                                                                                }
                                                                                case "stroke":
                                                                                node.style[att] = R.getRGB(value).hex;
                                                                                // Need following line for Firefox
                                                                                node.setAttribute(att, R.getRGB(value).hex);
                                                                                break;
                                                                                case "gradient":
                                                                                addGradientFill(node, value, o.paper);
                                                                                break;
                                                                                case "opacity":
                                                                                case "fill-opacity":
                                                                                if (attrs.gradient) {
                                                                                var gradient = doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g, ""));
                                                                                if (gradient) {
                                                                                var stops = gradient.getElementsByTagName("stop");
                                                                                stops[stops.length - 1].setAttribute("stop-opacity", value);
                                                                                }
                                                                                break;
                                                                                }
                                                                                default :
                                                                                var cssrule = att.replace(/(\-.)/g, function (w) {
                                                                                return w.substring(1).toUpperCase();
                                                                                });
                                                                                node.style[cssrule] = value;
                                                                                // Need following line for Firefox
                                                                                node.setAttribute(att, value);
                                                                                break;
                                                                                }
                                                                                }
                                                                                
                                                                                tuneText(o, params);
                                                                                };
                                                                                var leading = 1.2;
                                                                                var tuneText = function (el, params) {
                                                                                if (el.type != "text" || !("text" in params || "font" in params || "font-size" in params || "x" in params || "y" in params)) {
                                                                                return;
                                                                                }
                                                                                var a = el.attrs,
                                                                                node = el.node,
                                                                                fontSize = node.firstChild ? parseInt(doc.defaultView.getComputedStyle(node.firstChild, "").getPropertyValue("font-size"), 10) : 10;
                                                                                
                                                                                if ("text" in params) {
                                                                                while (node.firstChild) {
                                                                                node.removeChild(node.firstChild);
                                                                                }
                                                                                var texts = (params.text + "").split("\n");
                                                                                for (var i = 0, ii = texts.length; i < ii; i++) {
                                                                                var tspan = doc.createElementNS(el.paper.svgns, "tspan");
                                                                                i && tspan.setAttribute("dy", fontSize * leading);
                                                                                i && tspan.setAttribute("x", a.x);
                                                                                tspan.appendChild(doc.createTextNode(texts[i]));
                                                                                node.appendChild(tspan);
                                                                                }
                                                                                } else {
                                                                                var texts = node.getElementsByTagName("tspan");
                                                                                for (var i = 0, ii = texts.length; i < ii; i++) {
                                                                                i && texts[i].setAttribute("dy", fontSize * leading);
                                                                                i && texts[i].setAttribute("x", a.x);
                                                                                }
                                                                                }
                                                                                node.setAttribute("y", a.y);
                                                                                var bb = el.getBBox(),
                                                                                dif = a.y - (bb.y + bb.height / 2);
                                                                                dif && node.setAttribute("y", a.y + dif);
                                                                                };
                                                                                var Element = function (node, svg) {
                                                                                var X = 0,
                                                                                Y = 0;
                                                                                this[0] = node;
                                                                                this.node = node;
                                                                                this.paper = svg;
                                                                                this.attrs = this.attrs || {};
                                                                                this.transformations = []; // rotate, translate, scale
                                                                                this._ = {
                                                                                tx: 0,
                                                                                ty: 0,
                                                                                rt: {deg: 0, x: 0, y: 0},
                                                                                sx: 1,
                                                                                sy: 1
                                                                                };
                                                                                };
                                                                                Element.prototype.rotate = function (deg, cx, cy) {
                                                                                if (deg == null) {
                                                                                return this._.rt.deg;
                                                                                }
                                                                                var bbox = this.getBBox();
                                                                                deg = deg.toString().split(separator);
                                                                                if (deg.length - 1) {
                                                                                cx = parseFloat(deg[1]);
                                                                                cy = parseFloat(deg[2]);
                                                                                }
                                                                                deg = parseFloat(deg[0]);
                                                                                if (cx != null) {
                                                                                this._.rt.deg = deg;
                                                                                } else {
                                                                                this._.rt.deg += deg;
                                                                                }
                                                                                if (cy == null) {
                                                                                cx = null;
                                                                                }
                                                                                cx = cx == null ? bbox.x + bbox.width / 2 : cx;
                                                                                cy = cy == null ? bbox.y + bbox.height / 2 : cy;
                                                                                if (this._.rt.deg) {
                                                                                this.transformations[0] = ("rotate(" + this._.rt.deg + " " + cx + " " + cy + ")");
                                                                                } else {
                                                                                this.transformations[0] = "";
                                                                                }
                                                                                this.node.setAttribute("transform", this.transformations.join(" "));
                                                                                return this;
                                                                                };
                                                                                Element.prototype.hide = function () {
                                                                                this.node.style.display = "none";
                                                                                return this;
                                                                                };
                                                                                Element.prototype.show = function () {
                                                                                this.node.style.display = "block";
                                                                                return this;
                                                                                };
                                                                                Element.prototype.remove = function () {
                                                                                this.node.parentNode.removeChild(this.node);
                                                                                };
                                                                                Element.prototype.getBBox = function () {
                                                                                var bbox = this.node.getBBox();
                                                                                if (this.type == "text") {
                                                                                bbox = {x: bbox.x, y: Infinity, width: bbox.width, height: 0};
                                                                                for (var i = 0, ii = this.node.getNumberOfChars(); i < ii; i++) {
                                                                                var bb = this.node.getExtentOfChar(i);
                                                                                (bb.y < bbox.y) && (bbox.y = bb.y);
                                                                                (bb.y + bb.height - bbox.y > bbox.height) && (bbox.height = bb.y + bb.height - bbox.y);
                                                                                }
                                                                                }
                                                                                return bbox;
                                                                                };
                                                                                Element.prototype.attr = function () {
                                                                                if (arguments.length == 1 && typeof arguments[0] == "string") {
                                                                                if (arguments[0] == "translation") {
                                                                                return this.translate();
                                                                                }
                                                                                return this.attrs[arguments[0]];
                                                                                }
                                                                                if (arguments.length == 1 && arguments[0] instanceof win.Array) {
                                                                                var values = {};
                                                                                for (var j in arguments[0]) {
                                                                                values[arguments[0][j]] = this.attrs[arguments[0][j]];
                                                                                }
                                                                                return values;
                                                                                }
                                                                                if (arguments.length == 2) {
                                                                                var params = {};
                                                                                params[arguments[0]] = arguments[1];
                                                                                setFillAndStroke(this, params);
                                                                                } else if (arguments.length == 1 && typeof arguments[0] == "object") {
                                                                                setFillAndStroke(this, arguments[0]);
                                                                                }
                                                                                return this;
                                                                                };
                                                                                Element.prototype.toFront = function () {
                                                                                this.node.parentNode.appendChild(this.node);
                                                                                return this;
                                                                                };
                                                                                Element.prototype.toBack = function () {
                                                                                if (this.node.parentNode.firstChild != this.node) {
                                                                                this.node.parentNode.insertBefore(this.node, this.node.parentNode.firstChild);
                                                                                }
                                                                                return this;
                                                                                };
                                                                                Element.prototype.insertAfter = function (element) {
                                                                                if (element.node.nextSibling) {
                                                                                element.node.parentNode.insertBefore(this.node, element.node.nextSibling);
                                                                                } else {
                                                                                element.node.parentNode.appendChild(this.node);
                                                                                }
                                                                                return this;
                                                                                };
                                                                                Element.prototype.insertBefore = function (element) {
                                                                                element.node.parentNode.insertBefore(this.node, element.node);
                                                                                return this;
                                                                                };
                                                                                var theCircle = function (svg, x, y, r) {
                                                                                var el = doc.createElementNS(svg.svgns, "circle");
                                                                                el.setAttribute("cx", x);
                                                                                el.setAttribute("cy", y);
                                                                                el.setAttribute("r", r);
                                                                                el.setAttribute("fill", "none");
                                                                                el.setAttribute("stroke", "#000");
                                                                                if (svg.canvas) {
                                                                                svg.canvas.appendChild(el);
                                                                                }
                                                                                var res = new Element(el, svg);
                                                                                res.attrs = res.attrs || {};
                                                                                res.attrs.cx = x;
                                                                                res.attrs.cy = y;
                                                                                res.attrs.r = r;
                                                                                res.attrs.stroke = "#000";
                                                                                res.type = "circle";
                                                                                return res;
                                                                                };
                                                                                var theRect = function (svg, x, y, w, h, r) {
                                                                                var el = doc.createElementNS(svg.svgns, "rect");
                                                                                el.setAttribute("x", x);
                                                                                el.setAttribute("y", y);
                                                                                el.setAttribute("width", w);
                                                                                el.setAttribute("height", h);
                                                                                if (r) {
                                                                                el.setAttribute("rx", r);
                                                                                el.setAttribute("ry", r);
                                                                                }
                                                                                el.setAttribute("fill", "none");
                                                                                el.setAttribute("stroke", "#000");
                                                                                if (svg.canvas) {
                                                                                svg.canvas.appendChild(el);
                                                                                }
                                                                                var res = new Element(el, svg);
                                                                                res.attrs = res.attrs || {};
                                                                                res.attrs.x = x;
                                                                                res.attrs.y = y;
                                                                                res.attrs.width = w;
                                                                                res.attrs.height = h;
                                                                                res.attrs.stroke = "#000";
                                                                                if (r) {
                                                                                res.attrs.rx = res.attrs.ry = r;
                                                                                }
                                                                                res.type = "rect";
                                                                                return res;
                                                                                };
                                                                                var theEllipse = function (svg, x, y, rx, ry) {
                                                                                var el = doc.createElementNS(svg.svgns, "ellipse");
                                                                                el.setAttribute("cx", x);
                                                                                el.setAttribute("cy", y);
                                                                                el.setAttribute("rx", rx);
                                                                                el.setAttribute("ry", ry);
                                                                                el.setAttribute("fill", "none");
                                                                                el.setAttribute("stroke", "#000");
                                                                                if (svg.canvas) {
                                                                                svg.canvas.appendChild(el);
                                                                                }
                                                                                var res = new Element(el, svg);
                                                                                res.attrs = res.attrs || {};
                                                                                res.attrs.cx = x;
                                                                                res.attrs.cy = y;
                                                                                res.attrs.rx = rx;
                                                                                res.attrs.ry = ry;
                                                                                res.attrs.stroke = "#000";
                                                                                res.type = "ellipse";
                                                                                return res;
                                                                                };
                                                                                var theImage = function (svg, src, x, y, w, h) {
                                                                                var el = doc.createElementNS(svg.svgns, "image");
                                                                                el.setAttribute("x", x);
                                                                                el.setAttribute("y", y);
                                                                                el.setAttribute("width", w);
                                                                                el.setAttribute("height", h);
                                                                                el.setAttribute("preserveAspectRatio", "none");
                                                                                el.setAttributeNS(svg.xlink, "href", src);
                                                                                if (svg.canvas) {
                                                                                svg.canvas.appendChild(el);
                                                                                }
                                                                                var res = new Element(el, svg);
                                                                                res.attrs = res.attrs || {};
                                                                                res.attrs.x = x;
                                                                                res.attrs.y = y;
                                                                                res.attrs.width = w;
                                                                                res.attrs.height = h;
                                                                                res.type = "image";
                                                                                return res;
                                                                                };
                                                                                var theText = function (svg, x, y, text) {
                                                                                var el = doc.createElementNS(svg.svgns, "text");
                                                                                el.setAttribute("x", x);
                                                                                el.setAttribute("y", y);
                                                                                el.setAttribute("text-anchor", "middle");
                                                                                if (svg.canvas) {
                                                                                svg.canvas.appendChild(el);
                                                                                }
                                                                                var res = new Element(el, svg);
                                                                                res.attrs = res.attrs || {};
                                                                                res.attrs.x = x;
                                                                                res.attrs.y = y;
                                                                                res.type = "text";
                                                                                setFillAndStroke(res, {font: availableAttrs.font, stroke: "none", fill: "#000", text: text});
                                                                                return res;
                                                                                };
                                                                                var setSize = function (width, height) {
                                                                                this.width = width || this.width;
                                                                                this.height = height || this.height;
                                                                                this.canvas.setAttribute("width", this.width);
                                                                                this.canvas.setAttribute("height", this.height);
                                                                                return this;
                                                                                };
                                                                                var create = function () {
                                                                                var con = getContainer.apply(null, arguments);
                                                                                var container = con.container,
                                                                                x = con.x,
                                                                                y = con.y,
                                                                                width = con.width,
                                                                                height = con.height;
                                                                                if (!container) {
                                                                                throw new Error("SVG container not found.");
                                                                                }
                                                                                paper.canvas = doc.createElementNS(paper.svgns, "svg");
                                                                                paper.canvas.setAttribute("width", width || 512);
                                                                                paper.width = width || 512;
                                                                                paper.canvas.setAttribute("height", height || 342);
                                                                                paper.height = height || 342;
                                                                                if (container == 1) {
                                                                                doc.body.appendChild(paper.canvas);
                                                                                paper.canvas.style.position = "absolute";
                                                                                paper.canvas.style.left = x + "px";
                                                                                paper.canvas.style.top = y + "px";
                                                                                } else {
                                                                                if (container.firstChild) {
                                                                                container.insertBefore(paper.canvas, container.firstChild);
                                                                                } else {
                                                                                container.appendChild(paper.canvas);
                                                                                }
                                                                                }
                                                                                container = {
                                                                                canvas: paper.canvas,
                                                                                clear: function () {
                                                                                while (this.canvas.firstChild) {
                                                                                this.canvas.removeChild(this.canvas.firstChild);
                                                                                }
                                                                                this.defs = doc.createElementNS(paper.svgns, "defs");
                                                                                this.canvas.appendChild(this.defs);
                                                                                }
                                                                                };
                                                                                for (var prop in paper) {
                                                                                if (prop != "create") {
                                                                                container[prop] = paper[prop];
                                                                                }
                                                                                }
                                                                                plugins.call(container, container, R.fn);
                                                                                container.clear();
                                                                                container.raphael = R;
                                                                                return container;
                                                                                };
                                                                                paper.remove = function () {
                                                                                this.canvas.parentNode.removeChild(this.canvas);
                                                                                };
                                                                                paper.svgns = "http://www.w3.org/2000/svg";
                                                                                paper.xlink = "http://www.w3.org/1999/xlink";
                                                                                paper.safari = function () {
                                                                                if ({"Apple Computer, Inc.": 1, "Google Inc.": 1}[navigator.vendor]) {
                                                                                var rect = this.rect(-this.width, -this.height, this.width * 3, this.height * 3).attr({stroke: "none"});
                                                                                setTimeout(function () {rect.remove();});
                                                                                }
                                                                                };
                                                                                }
                                                                                
                                                                                // VML
                                                                                if (R.vml) {
                                                                                R.toString = function () {
                                                                                return  "Your browser doesn\u2019t support SVG.\nYou are running Rapha\u00ebl " + this.version;
                                                                                };
                                                                                thePath = function (params, pathString, VML) {
                                                                                var g = createNode("group"), gl = g.style;
                                                                                gl.position = "absolute";
                                                                                gl.left = 0;
                                                                                gl.top = 0;
                                                                                gl.width = VML.width + "px";
                                                                                gl.height = VML.height + "px";
                                                                                var el = createNode("shape"), ol = el.style;
                                                                                ol.width = VML.width + "px";
                                                                                ol.height = VML.height + "px";
                                                                                el.path = "";
                                                                                if (params["class"]) {
                                                                                el.className = "rvml " + params["class"];
                                                                                }
                                                                                el.coordsize = this.coordsize;
                                                                                el.coordorigin = this.coordorigin;
                                                                                g.appendChild(el);
                                                                                var p = new Element(el, g, VML);
                                                                                p.isAbsolute = true;
                                                                                p.type = "path";
                                                                                p.path = [];
                                                                                p.last = {x: 0, y: 0, bx: 0, by: 0, isAbsolute: true};
                                                                                p.Path = "";
                                                                                p.absolutely = function () {
                                                                                this.isAbsolute = true;
                                                                                return this;
                                                                                };
                                                                                p.relatively = function () {
                                                                                this.isAbsolute = false;
                                                                                return this;
                                                                                };
                                                                                p.moveTo = function (x, y) {
                                                                                var d = this.isAbsolute?"m":"t";
                                                                                d += Math.round(parseFloat(x)) + " " + Math.round(parseFloat(y));
                                                                                this.node.path = this.Path += d;
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(x);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(y);
                                                                                this.last.isAbsolute = this.isAbsolute;
                                                                                this.attrs.path += (this.isAbsolute ? "M" : "m") + [x, y];
                                                                                return this;
                                                                                };
                                                                                p.lineTo = function (x, y) {
                                                                                var d = this.isAbsolute?"l":"r";
                                                                                d += Math.round(parseFloat(x)) + " " + Math.round(parseFloat(y));
                                                                                this[0].path = this.Path += d;
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(x);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(y);
                                                                                this.last.isAbsolute = this.isAbsolute;
                                                                                this.attrs.path += (this.isAbsolute ? "L" : "l") + [x, y];
                                                                                return this;
                                                                                };
                                                                                p.arcTo = function (rx, ry, large_arc_flag, sweep_flag, x2, y2) {
                                                                                // for more information of where this math came from visit:
                                                                                // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes
                                                                                x2 = (this.isAbsolute ? 0 : this.last.x) + x2;
                                                                                y2 = (this.isAbsolute ? 0 : this.last.y) + y2;
                                                                                var x1 = this.last.x,
                                                                                y1 = this.last.y,
                                                                                x = (x1 - x2) / 2,
                                                                                y = (y1 - y2) / 2,
                                                                                k = (large_arc_flag == sweep_flag ? -1 : 1) *
                                                                                Math.sqrt(Math.abs(rx * rx * ry * ry - rx * rx * y * y - ry * ry * x * x) / (rx * rx * y * y + ry * ry * x * x)),
                                                                                cx = k * rx * y / ry + (x1 + x2) / 2,
                                                                                cy = k * -ry * x / rx + (y1 + y2) / 2,
                                                                                d = sweep_flag ? (this.isAbsolute ? "wa" : "wr") : (this.isAbsolute ? "at" : "ar"),
                                                                                left = Math.round(cx - rx),
                                                                                top = Math.round(cy - ry);
                                                                                d += [left, top, Math.round(left + rx * 2), Math.round(top + ry * 2), Math.round(x1), Math.round(y1), Math.round(parseFloat(x2)), Math.round(parseFloat(y2))].join(", ");
                                                                                this.node.path = this.Path += d;
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(x2);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(y2);
                                                                                this.last.isAbsolute = this.isAbsolute;
                                                                                this.attrs.path += (this.isAbsolute ? "A" : "a") + [rx, ry, 0, large_arc_flag, sweep_flag, x2, y2];
                                                                                return this;
                                                                                };
                                                                                p.cplineTo = function (x1, y1, w1) {
                                                                                if (!w1) {
                                                                                return this.lineTo(x1, y1);
                                                                                } else {
                                                                                var x = Math.round(Math.round(parseFloat(x1) * 100) / 100),
                                                                                y = Math.round(Math.round(parseFloat(y1) * 100) / 100),
                                                                                w = Math.round(Math.round(parseFloat(w1) * 100) / 100),
                                                                                d = this.isAbsolute ? "c" : "v",
                                                                                attr = [Math.round(this.last.x) + w, Math.round(this.last.y), x - w, y, x, y],
                                                                                svgattr = [this.last.x + w1, this.last.y, x1 - w1, y1, x1, y1];
                                                                                d += attr.join(" ") + " ";
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + attr[4];
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + attr[5];
                                                                                this.last.bx = attr[2];
                                                                                this.last.by = attr[3];
                                                                                this.node.path = this.Path += d;
                                                                                this.attrs.path += (this.isAbsolute ? "C" : "c") + svgattr;
                                                                                return this;
                                                                                }
                                                                                };
                                                                                p.curveTo = function () {
                                                                                var d = this.isAbsolute ? "c" : "v";
                                                                                if (arguments.length == 6) {
                                                                                this.last.bx = (this.isAbsolute ? 0 : this.last.x) + parseFloat(arguments[2]);
                                                                                this.last.by = (this.isAbsolute ? 0 : this.last.y) + parseFloat(arguments[3]);
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(arguments[4]);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(arguments[5]);
                                                                                d += [Math.round(parseFloat(arguments[0])),
                                                                                Math.round(parseFloat(arguments[1])),
                                                                                Math.round(parseFloat(arguments[2])),
                                                                                Math.round(parseFloat(arguments[3])),
                                                                                Math.round(parseFloat(arguments[4])),
                                                                                Math.round(parseFloat(arguments[5]))].join(" ") + " ";
                                                                                this.last.isAbsolute = this.isAbsolute;
                                                                                this.attrs.path += (this.isAbsolute ? "C" : "c") + Array.prototype.splice.call(arguments, 0, arguments.length);
                                                                                }
                                                                                if (arguments.length == 4) {
                                                                                var bx = this.last.x * 2 - this.last.bx;
                                                                                var by = this.last.y * 2 - this.last.by;
                                                                                this.last.bx = (this.isAbsolute ? 0 : this.last.x) + parseFloat(arguments[0]);
                                                                                this.last.by = (this.isAbsolute ? 0 : this.last.y) + parseFloat(arguments[1]);
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(arguments[2]);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(arguments[3]);
                                                                                d += [Math.round(bx), Math.round(by),
                                                                                Math.round(parseFloat(arguments[0])),
                                                                                Math.round(parseFloat(arguments[1])),
                                                                                Math.round(parseFloat(arguments[2])),
                                                                                Math.round(parseFloat(arguments[3]))].join(" ") + " ";
                                                                                this.attrs.path += (this.isAbsolute ? "S" : "s") + Array.prototype.splice.call(arguments, 0, arguments.length);
                                                                                }
                                                                                this.node.path = this.Path += d;
                                                                                return this;
                                                                                };
                                                                                p.qcurveTo = function () {
                                                                                var d = "qb";
                                                                                if (arguments.length == 4) {
                                                                                this.last.qx = (this.isAbsolute ? 0 : this.last.x) + parseFloat(arguments[0]);
                                                                                this.last.qy = (this.isAbsolute ? 0 : this.last.y) + parseFloat(arguments[1]);
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(arguments[2]);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(arguments[3]);
                                                                                d += [Math.round(this.last.qx),
                                                                                Math.round(this.last.qy),
                                                                                Math.round(this.last.x),
                                                                                Math.round(this.last.y)].join(" ") + " ";
                                                                                this.last.isAbsolute = this.isAbsolute;
                                                                                this.attrs.path += (this.isAbsolute ? "Q" : "q") + Array.prototype.splice.call(arguments, 0, arguments.length);
                                                                                }
                                                                                if (arguments.length == 2) {
                                                                                this.last.qx = this.last.x * 2 - this.last.qx;
                                                                                this.last.qy = this.last.y * 2 - this.last.qy;
                                                                                this.last.x = (this.isAbsolute ? 0 : this.last.x) + parseFloat(arguments[2]);
                                                                                this.last.y = (this.isAbsolute ? 0 : this.last.y) + parseFloat(arguments[3]);
                                                                                d += [Math.round(this.last.qx),
                                                                                Math.round(this.last.qy),
                                                                                Math.round(this.last.x),
                                                                                Math.round(this.last.y)].join(" ") + " ";
                                                                                this.attrs.path += (this.isAbsolute ? "T" : "t") + Array.prototype.splice.call(arguments, 0, arguments.length);
                                                                                }
                                                                                this.node.path = this.Path += d;
                                                                                this.path.push({type: "qcurve", arg: [].slice.call(arguments, 0), pos: this.isAbsolute});
                                                                                return this;
                                                                                };
                                                                                p.addRoundedCorner = function (r, dir) {
                                                                                var R = .5522 * r, rollback = this.isAbsolute, o = this;
                                                                                if (rollback) {
                                                                                this.relatively();
                                                                                rollback = function () {
                                                                                o.absolutely();
                                                                                };
                                                                                } else {
                                                                                rollback = function () {};
                                                                                }
                                                                                var actions = {
                                                                                l: function () {
                                                                                return {
                                                                                u: function () {
                                                                                o.curveTo(-R, 0, -r, -(r - R), -r, -r);
                                                                                },
                                                                                d: function () {
                                                                                o.curveTo(-R, 0, -r, r - R, -r, r);
                                                                                }
                                                                                };
                                                                                },
                                                                                r: function () {
                                                                                return {
                                                                                u: function () {
                                                                                o.curveTo(R, 0, r, -(r - R), r, -r);
                                                                                },
                                                                                d: function () {
                                                                                o.curveTo(R, 0, r, r - R, r, r);
                                                                                }
                                                                                };
                                                                                },
                                                                                u: function () {
                                                                                return {
                                                                                r: function () {
                                                                                o.curveTo(0, -R, -(R - r), -r, r, -r);
                                                                                },
                                                                                l: function () {
                                                                                o.curveTo(0, -R, R - r, -r, -r, -r);
                                                                                }
                                                                                };
                                                                                },
                                                                                d: function () {
                                                                                return {
                                                                                r: function () {
                                                                                o.curveTo(0, R, -(R - r), r, r, r);
                                                                                },
                                                                                l: function () {
                                                                                o.curveTo(0, R, R - r, r, -r, r);
                                                                                }
                                                                                };
                                                                                }
                                                                                };
                                                                                actions[dir.charAt(0)]()[dir.charAt(1)]();
                                                                                rollback();
                                                                                return o;
                                                                                };
                                                                                p.andClose = function () {
                                                                                this.node.path = (this.Path += "x");
                                                                                this.attrs.path += "z";
                                                                                return this;
                                                                                };
                                                                                if (pathString) {
                                                                                p.absolutely();
                                                                                p.attrs.path = "";
                                                                                paper.pathfinder(p, "" + pathString);
                                                                                }
                                                                                if (params) {
                                                                                params.fill = params.fill || "none";
                                                                                params.stroke = params.stroke || "#000";
                                                                                } else {
                                                                                params = {fill: "none", stroke: "#000"};
                                                                                }
                                                                                setFillAndStroke(p, params);
                                                                                if (params.gradient) {
                                                                                addGradientFill(p, params.gradient);
                                                                                }
                                                                                VML.canvas.appendChild(g);
                                                                                return p;
                                                                                };
                                                                                var setFillAndStroke = function (o, params) {
                                                                                var node = o.node,
                                                                                s = node.style,
                                                                                res = o;
                                                                                o.attrs = o.attrs || {};
                                                                                for (var par in params) {
                                                                                o.attrs[par] = params[par];
                                                                                }
                                                                                params.href && (node.href = params.href);
                                                                                params.title && (node.title = params.title);
                                                                                params.target && (node.target = params.target);
                                                                                if (params.path && o.type == "path") {
                                                                                o.Path = "";
                                                                                o.path = [];
                                                                                paper.pathfinder(o, params.path);
                                                                                }
                                                                                if (params.rotation != null) {
                                                                                o.rotate(params.rotation, true);
                                                                                }
                                                                                if (params.translation) {
                                                                                var xy = (params.translation + "").split(separator);
                                                                                o.translate(xy[0], xy[1]);
                                                                                }
                                                                                if (params.scale) {
                                                                                var xy = (params.scale + "").split(separator);
                                                                                o.scale(+xy[0] || 1, +xy[1] || +xy[0] || 1, +xy[2] || null, +xy[3] || null);
                                                                                }
                                                                                if (o.type == "image" && params.src) {
                                                                                node.src = params.src;
                                                                                }
                                                                                if (o.type == "image" && params.opacity) {
                                                                                node.filterOpacity = " progid:DXImageTransform.Microsoft.Alpha(opacity=" + (params.opacity * 100) + ")";
                                                                                node.style.filter = (node.filterMatrix || "") + (node.filterOpacity || "");
                                                                                }
                                                                                params.font && (s.font = params.font);
                                                                                params["font-family"] && (s.fontFamily = params["font-family"]);
                                                                                params["font-size"] && (s.fontSize = params["font-size"]);
                                                                                params["font-weight"] && (s.fontWeight = params["font-weight"]);
                                                                                params["font-style"] && (s.fontStyle = params["font-style"]);
                                                                                if (typeof params.opacity != "undefined" || typeof params["stroke-width"] != "undefined" || typeof params.fill != "undefined" || typeof params.stroke != "undefined" || params["stroke-width"] || params["stroke-opacity"] || params["fill-opacity"] || params["stroke-dasharray"] || params["stroke-miterlimit"] || params["stroke-linejoin"] || params["stroke-linecap"]) {
                                                                                o = o.shape || node;
                                                                                var fill = (o.getElementsByTagName("fill") && o.getElementsByTagName("fill")[0]) || createNode("fill");
                                                                                if ("fill-opacity" in params || "opacity" in params) {
                                                                                fill.opacity = ((+params["fill-opacity"] + 1 || 2) - 1) * ((+params.opacity + 1 || 2) - 1);
                                                                                }
                                                                                params.fill && (fill.on = true);
                                                                                if (typeof fill.on == "undefined" || params.fill == "none") {
                                                                                fill.on = false;
                                                                                }
                                                                                if (fill.on && params.fill) {
                                                                                var isURL = params.fill.match(/^url\(([^\)]+)\)$/i);
                                                                                if (isURL) {
                                                                                fill.src = isURL[1];
                                                                                fill.type = "tile";
                                                                                } else {
                                                                                fill.color = R.getRGB(params.fill).hex;
                                                                                fill.src = "";
                                                                                fill.type = "solid";
                                                                                }
                                                                                }
                                                                                o.appendChild(fill);
                                                                                var stroke = (o.getElementsByTagName("stroke") && o.getElementsByTagName("stroke")[0]) || createNode("stroke");
                                                                                if ((params.stroke && params.stroke != "none") || params["stroke-width"] || typeof params["stroke-opacity"] != "undefined" || params["stroke-dasharray"] || params["stroke-miterlimit"] || params["stroke-linejoin"] || params["stroke-linecap"]) {
                                                                                stroke.on = true;
                                                                                }
                                                                                if (params.stroke == "none" || typeof stroke.on == "undefined" || params.stroke == 0) {
                                                                                stroke.on = false;
                                                                                }
                                                                                if (stroke.on && params.stroke) {
                                                                                stroke.color = R.getRGB(params.stroke).hex;
                                                                                }
                                                                                stroke.opacity = ((+params["stroke-opacity"] + 1 || 2) - 1) * ((+params.opacity + 1 || 2) - 1);
                                                                                params["stroke-linejoin"] && (stroke.joinstyle = params["stroke-linejoin"] || "miter");
                                                                                stroke.miterlimit = params["stroke-miterlimit"] || 8;
                                                                                params["stroke-linecap"] && (stroke.endcap = {butt: "flat", square: "square", round: "round"}[params["stroke-linecap"]] || "miter");
                                                                                params["stroke-width"] && (stroke.weight = (parseFloat(params["stroke-width"]) || 1) * 12 / 16);
                                                                                if (params["stroke-dasharray"]) {
                                                                                var dasharray = {
                                                                                "-": "shortdash",
                                                                                ".": "shortdot",
                                                                                "-.": "shortdashdot",
                                                                                "-..": "shortdashdotdot",
                                                                                ". ": "dot",
                                                                                "- ": "dash",
                                                                                "--": "longdash",
                                                                                "- .": "dashdot",
                                                                                "--.": "longdashdot",
                                                                                "--..": "longdashdotdot"
                                                                                };
                                                                                stroke.dashstyle = dasharray[params["stroke-dasharray"]] || "";
                                                                                }
                                                                                o.appendChild(stroke);
                                                                                }
                                                                                if (res.type == "text") {
                                                                                var span = doc.createElement("span"),
                                                                                s = span.style,
                                                                                a = res.attrs;
                                                                                s.padding = 0;
                                                                                s.margin = 0;
                                                                                s.lineHeight = 1;
                                                                                s.display = "inline";
                                                                                a.font && (s.font = a.font);
                                                                                a["font-family"] && (s.fontFamily = a["font-family"]);
                                                                                a["font-size"] && (s.fontSize = a["font-size"]);
                                                                                a["font-weight"] && (s.fontWeight = a["font-weight"]);
                                                                                a["font-style"] && (s.fontStyle = a["font-style"]);
                                                                                res.node.parentNode.appendChild(span);
                                                                                span.innerText = res.node.string;
                                                                                res.W = a.w = span.offsetWidth;
                                                                                res.H = a.h = span.offsetHeight;
                                                                                res.X = a.x;
                                                                                res.Y = a.y + Math.round(res.H / 2);
                                                                                res.node.parentNode.removeChild(span);
                                                                                
                                                                                // text-anchor emulation
                                                                                switch (a["text-anchor"]) {
                                                                                case "start":
                                                                                res.node.style["v-text-align"] = "left";
                                                                                res.bbx = Math.round(res.W / 2);
                                                                                break;
                                                                                case "end":
                                                                                res.node.style["v-text-align"] = "right";
                                                                                res.bbx = -Math.round(res.W / 2);
                                                                                break;
                                                                                default:
                                                                                res.node.style["v-text-align"] = "center";
                                                                                break;
                                                                                }
                                                                                }
                                                                                };
                                                                                var getAngle = function (a, b, c, d) {
                                                                                var angle = Math.round(Math.atan((parseFloat(c) - parseFloat(a)) / (parseFloat(d) - parseFloat(b))) * 57.29) || 0;
                                                                                if (!angle && parseFloat(a) < parseFloat(b)) {
                                                                                angle = 180;
                                                                                }
                                                                                angle -= 180;
                                                                                if (angle < 0) {
                                                                                    angle += 360;
                                                                                    }
                                                                                    return angle;
                                                                                    };
                                                                                    var addGradientFill = function (o, gradient) {
                                                                                    gradient = toGradient(gradient);
                                                                                    o.attrs = o.attrs || {};
                                                                                    var attrs = o.attrs;
                                                                                    o.attrs.gradient = gradient;
                                                                                    o = o.shape || o[0];
                                                                                    var fill = o.getElementsByTagName("fill");
                                                                                    if (fill.length) {
                                                                                    fill = fill[0];
                                                                                    } else {
                                                                                    fill = createNode("fill");
                                                                                    }
                                                                                    if (gradient.dots.length) {
                                                                                    fill.on = true;
                                                                                    fill.method = "none";
                                                                                    fill.type = ((gradient.type + "").toLowerCase() == "radial") ? "gradientTitle" : "gradient";
                                                                                    if (typeof gradient.dots[0].color != "undefined") {
                                                                                    fill.color = R.getRGB(gradient.dots[0].color).hex;
                                                                                    }
                                                                                    if (typeof gradient.dots[gradient.dots.length - 1].color != "undefined") {
                                                                                    fill.color2 = R.getRGB(gradient.dots[gradient.dots.length - 1].color).hex;
                                                                                    }
                                                                                    var clrs = [];
                                                                                    for (var i = 0, ii = gradient.dots.length; i < ii; i++) {
                                                                                    if (gradient.dots[i].offset) {
                                                                                    clrs.push(gradient.dots[i].offset + " " + R.getRGB(gradient.dots[i].color).hex);
                                                                                    }
                                                                                    };
                                                                                    var fillOpacity = typeof gradient.dots[gradient.dots.length - 1].opacity == "undefined" ? (typeof attrs.opacity == "undefined" ? 1 : attrs.opacity) : gradient.dots[gradient.dots.length - 1].opacity;
                                                                                    if (clrs.length) {
                                                                                    fill.colors.value = clrs.join(",");
                                                                                    fillOpacity = typeof attrs.opacity == "undefined" ? 1 : attrs.opacity;
                                                                                    } else {
                                                                                    fill.colors && (fill.colors.value = "0% " + fill.color);
                                                                                    }
                                                                                    fill.opacity = fillOpacity;
                                                                                    if (typeof gradient.angle != "undefined") {
                                                                                    fill.angle = (-gradient.angle + 270) % 360;
                                                                                    } else if (gradient.vector) {
                                                                                    fill.angle = getAngle.apply(null, gradient.vector);
                                                                                    }
                                                                                    if ((gradient.type + "").toLowerCase() == "radial") {
                                                                                    fill.focus = "100%";
                                                                                    fill.focusposition = "0.5 0.5";
                                                                                    }
                                                                                    }
                                                                                    };
                                                                                    var Element = function (node, group, vml) {
                                                                                    var Rotation = 0,
                                                                                    RotX = 0,
                                                                                    RotY = 0,
                                                                                    Scale = 1;
                                                                                    this[0] = node;
                                                                                    this.node = node;
                                                                                    this.X = 0;
                                                                                    this.Y = 0;
                                                                                    this.attrs = {};
                                                                                    this.Group = group;
                                                                                    this.paper = vml;
                                                                                    this._ = {
                                                                                    tx: 0,
                                                                                    ty: 0,
                                                                                    rt: {deg:0},
                                                                                    sx: 1,
                                                                                    sy: 1
                                                                                    };
                                                                                    };
                                                                                    Element.prototype.rotate = function (deg, cx, cy) {
                                                                                    if (deg == null) {
                                                                                    return this._.rt.deg;
                                                                                    }
                                                                                    deg = deg.toString().split(separator);
                                                                                    if (deg.length - 1) {
                                                                                    cx = parseFloat(deg[1]);
                                                                                    cy = parseFloat(deg[2]);
                                                                                    }
                                                                                    deg = parseFloat(deg[0]);
                                                                                    if (cx != null) {
                                                                                    this._.rt.deg = deg;
                                                                                    } else {
                                                                                    this._.rt.deg += deg;
                                                                                    }
                                                                                    if (cy == null) {
                                                                                    cx = null;
                                                                                    }
                                                                                    this._.rt.cx = cx;
                                                                                    this._.rt.cy = cy;
                                                                                    this.setBox(null, cx, cy);
                                                                                    this.Group.style.rotation = this._.rt.deg;
                                                                                    // gradient fix for rotation. TODO
                                                                                    // var fill = (this.shape || this.node).getElementsByTagName("fill");
                                                                                    // fill = fill[0] || {};
                                                                                    // var b = ((360 - this._.rt.deg) - 270) % 360;
                                                                                    // typeof fill.angle != "undefined" && (fill.angle = b);
                                                                                    return this;
                                                                                    };
                                                                                    Element.prototype.setBox = function (params, cx, cy) {
                                                                                    var gs = this.Group.style,
                                                                                    os = (this.shape && this.shape.style) || this.node.style;
                                                                                    params = params || {};
                                                                                    for (var i in params) {
                                                                                    this.attrs[i] = params[i];
                                                                                    }
                                                                                    cx = cx || this._.rt.cx;
                                                                                    cy = cy || this._.rt.cy;
                                                                                    var attr = this.attrs, x, y, w, h;
                                                                                    switch (this.type) {
                                                                                    case "circle":
                                                                                    x = attr.cx - attr.r;
                                                                                    y = attr.cy - attr.r;
                                                                                    w = h = attr.r * 2;
                                                                                    break;
                                                                                    case "ellipse":
                                                                                    x = attr.cx - attr.rx;
                                                                                    y = attr.cy - attr.ry;
                                                                                    w = attr.rx * 2;
                                                                                    h = attr.ry * 2;
                                                                                    break;
                                                                                    case "rect":
                                                                                    case "image":
                                                                                    x = attr.x;
                                                                                    y = attr.y;
                                                                                    w = attr.width || 0;
                                                                                    h = attr.height || 0;
                                                                                    break;
                                                                                    case "text":
                                                                                    this.textpath.v = ["m", Math.round(attr.x), ", ", Math.round(attr.y - 2), "l", Math.round(attr.x) + 1, ", ", Math.round(attr.y - 2)].join("");
                                                                                    x = attr.x - Math.round(this.W / 2);
                                                                                    y = attr.y - this.H / 2;
                                                                                    w = this.W;
                                                                                    h = this.H;
                                                                                    break;
                                                                                    case "path":
                                                                                    if (!this.attrs.path) {
                                                                                    x = 0;
                                                                                    y = 0;
                                                                                    w = this.paper.width;
                                                                                    h = this.paper.height;
                                                                                    } else {
                                                                                    var dim = pathDimensions(this.attrs.path),
                                                                                    x = dim.x;
                                                                                    y = dim.y;
                                                                                    w = dim.width;
                                                                                    h = dim.height;
                                                                                    }
                                                                                    break;
                                                                                    default:
                                                                                    x = 0;
                                                                                    y = 0;
                                                                                    w = this.paper.width;
                                                                                    h = this.paper.height;
                                                                                    break;
                                                                                    }
                                                                                    cx = (cx == null) ? x + w / 2 : cx;
                                                                                    cy = (cy == null) ? y + h / 2 : cy;
                                                                                    var left = cx - this.paper.width / 2,
                                                                                    top = cy - this.paper.height / 2;
                                                                                    if (this.type == "path" || this.type == "text") {
                                                                                    (gs.left != left + "px") && (gs.left = left + "px");
                                                                                    (gs.top != top + "px") && (gs.top = top + "px");
                                                                                    this.X = this.type == "text" ? x : -left;
                                                                                    this.Y = this.type == "text" ? y : -top;
                                                                                    this.W = w;
                                                                                    this.H = h;
                                                                                    (os.left != -left + "px") && (os.left = -left + "px");
                                                                                    (os.top != -top + "px") && (os.top = -top + "px");
                                                                                    } else {
                                                                                    (gs.left != left + "px") && (gs.left = left + "px");
                                                                                    (gs.top != top + "px") && (gs.top = top + "px");
                                                                                    this.X = x;
                                                                                    this.Y = y;
                                                                                    this.W = w;
                                                                                    this.H = h;
                                                                                    (gs.width != this.paper.width + "px") && (gs.width = this.paper.width + "px");
                                                                                    (gs.height != this.paper.height + "px") && (gs.height = this.paper.height + "px");
                                                                                    (os.left != x - left + "px") && (os.left = x - left + "px");
                                                                                    (os.top != y - top + "px") && (os.top = y - top + "px");
                                                                                    (os.width != w + "px") && (os.width = w + "px");
                                                                                    (os.height != h + "px") && (os.height = h + "px");
                                                                                    var arcsize = (+params.r || 0) / (Math.min(w, h));
                                                                                    if (this.type == "rect" && this.arcsize != arcsize && (arcsize || this.arcsize)) {
                                                                                    // We should replace element with the new one
                                                                                    var o = createNode(arcsize ? "roundrect" : "rect");
                                                                                    o.arcsize = arcsize;
                                                                                    this.Group.appendChild(o);
                                                                                    this.node.parentNode.removeChild(this.node);
                                                                                    this.node = o;
                                                                                    this.arcsize = arcsize;
                                                                                    setFillAndStroke(this, this.attrs);
                                                                                    this.setBox(this.attrs);
                                                                                    }
                                                                                    }
                                                                                    };
                                                                                    Element.prototype.hide = function () {
                                                                                    this.Group.style.display = "none";
                                                                                    return this;
                                                                                    };
                                                                                    Element.prototype.show = function () {
                                                                                    this.Group.style.display = "block";
                                                                                    return this;
                                                                                    };
                                                                                    Element.prototype.getBBox = function () {
                                                                                    if (this.type == "path") {
                                                                                    return pathDimensions(this.attr("path"));
                                                                                    }
                                                                                    return {
                                                                                    x: this.X + (this.bbx || 0),
                                                                                    y: this.Y,
                                                                                    width: this.W,
                                                                                    height: this.H
                                                                                    };
                                                                                    };
                                                                                    Element.prototype.remove = function () {
                                                                                    this[0].parentNode.removeChild(this[0]);
                                                                                    this.Group.parentNode.removeChild(this.Group);
                                                                                    this.shape && this.shape.parentNode.removeChild(this.shape);
                                                                                    };
                                                                                    Element.prototype.attr = function () {
                                                                                    if (arguments.length == 1 && typeof arguments[0] == "string") {
                                                                                    if (arguments[0] == "translation") {
                                                                                    return this.translate();
                                                                                    }
                                                                                    return this.attrs[arguments[0]];
                                                                                    }
                                                                                    if (this.attrs && arguments.length == 1 && arguments[0] instanceof win.Array) {
                                                                                    var values = {};
                                                                                    for (var i = 0, ii = arguments[0].length; i < ii; i++) {
                                                                                    values[arguments[0][i]] = this.attrs[arguments[0][i]];
                                                                                    };
                                                                                    return values;
                                                                                    }
                                                                                    var params;
                                                                                    if (arguments.length == 2) {
                                                                                    params = {};
                                                                                    params[arguments[0]] = arguments[1];
                                                                                    }
                                                                                    if (arguments.length == 1 && typeof arguments[0] == "object") {
                                                                                    params = arguments[0];
                                                                                    }
                                                                                    if (params) {
                                                                                    if (params.gradient) {
                                                                                    addGradientFill(this, params.gradient);
                                                                                    }
                                                                                    if (params.text && this.type == "text") {
                                                                                    this.node.string = params.text;
                                                                                    }
                                                                                    if (params.id) {
                                                                                    this.node.id = params.id;
                                                                                    }
                                                                                    setFillAndStroke(this, params);
                                                                                    this.setBox(params);
                                                                                    }
                                                                                    return this;
                                                                                    };
                                                                                    Element.prototype.toFront = function () {
                                                                                    this.Group.parentNode.appendChild(this.Group);
                                                                                    return this;
                                                                                    };
                                                                                    Element.prototype.toBack = function () {
                                                                                    if (this.Group.parentNode.firstChild != this.Group) {
                                                                                    this.Group.parentNode.insertBefore(this.Group, this.Group.parentNode.firstChild);
                                                                                    }
                                                                                    return this;
                                                                                    };
                                                                                    Element.prototype.insertAfter = function (element) {
                                                                                    if (element.Group.nextSibling) {
                                                                                    element.Group.parentNode.insertBefore(this.Group, element.Group.nextSibling);
                                                                                    } else {
                                                                                    element.Group.parentNode.appendChild(this.Group);
                                                                                    }
                                                                                    return this;
                                                                                    };
                                                                                    Element.prototype.insertBefore = function (element) {
                                                                                    element.Group.parentNode.insertBefore(this.Group, element.Group);
                                                                                    return this;
                                                                                    };
                                                                                    var theCircle = function (vml, x, y, r) {
                                                                                    var g = createNode("group");
                                                                                    var o = createNode("oval");
                                                                                    g.appendChild(o);
                                                                                    var res = new Element(o, g, vml);
                                                                                    res.type = "circle";
                                                                                    setFillAndStroke(res, {stroke: "#000", fill: "none"});
                                                                                    res.attrs.cx = x;
                                                                                    res.attrs.cy = y;
                                                                                    res.attrs.r = r;
                                                                                    res.setBox({x: x - r, y: y - r, width: r * 2, height: r * 2});
                                                                                    vml.canvas.appendChild(g);
                                                                                    return res;
                                                                                    };
                                                                                    var theRect = function (vml, x, y, w, h, r) {
                                                                                    var g = createNode("group"),
                                                                                    o = createNode(r ? "roundrect" : "rect"),
                                                                                    arcsize = (+r || 0) / (Math.min(w, h));
                                                                                    o.arcsize = arcsize;
                                                                                    g.appendChild(o);
                                                                                    var res = new Element(o, g, vml);
                                                                                    res.type = "rect";
                                                                                    setFillAndStroke(res, {stroke: "#000"});
                                                                                    res.attrs.x = x;
                                                                                    res.attrs.y = y;
                                                                                    res.attrs.w = w;
                                                                                    res.attrs.h = h;
                                                                                    res.attrs.r = +r;
                                                                                    res.arcsize = arcsize;
                                                                                    res.setBox({x: x, y: y, width: w, height: h});
                                                                                    vml.canvas.appendChild(g);
                                                                                    return res;
                                                                                    };
                                                                                    var theEllipse = function (vml, x, y, rx, ry) {
                                                                                    var g = createNode("group");
                                                                                    var o = createNode("oval");
                                                                                    g.appendChild(o);
                                                                                    var res = new Element(o, g, vml);
                                                                                    res.type = "ellipse";
                                                                                    setFillAndStroke(res, {stroke: "#000"});
                                                                                    res.attrs.cx = x;
                                                                                    res.attrs.cy = y;
                                                                                    res.attrs.rx = rx;
                                                                                    res.attrs.ry = ry;
                                                                                    res.setBox({x: x - rx, y: y - ry, width: rx * 2, height: ry * 2});
                                                                                    vml.canvas.appendChild(g);
                                                                                    return res;
                                                                                    };
                                                                                    var theImage = function (vml, src, x, y, w, h) {
                                                                                    var g = createNode("group");
                                                                                    var o = createNode("image");
                                                                                    o.src = src;
                                                                                    g.appendChild(o);
                                                                                    var res = new Element(o, g, vml);
                                                                                    res.type = "image";
                                                                                    res.attrs.x = x;
                                                                                    res.attrs.y = y;
                                                                                    res.attrs.w = w;
                                                                                    res.attrs.h = h;
                                                                                    res.setBox({x: x, y: y, width: w, height: h});
                                                                                    vml.canvas.appendChild(g);
                                                                                    return res;
                                                                                    };
                                                                                    var theText = function (vml, x, y, text) {
                                                                                    var g = createNode("group"), gs = g.style;
                                                                                    var el = createNode("shape"), ol = el.style;
                                                                                    var path = createNode("path"), ps = path.style;
                                                                                    path.v = ["m", Math.round(x), ", ", Math.round(y - 2), "l", Math.round(x) + 1, ", ", Math.round(y - 2)].join("");
                                                                                    path.textpathok = true;
                                                                                    ol.width = vml.width;
                                                                                    ol.height = vml.height;
                                                                                    gs.position = "absolute";
                                                                                    gs.left = 0;
                                                                                    gs.top = 0;
                                                                                    gs.width = vml.width;
                                                                                    gs.height = vml.height;
                                                                                    var o = createNode("textpath");
                                                                                    o.string = text;
                                                                                    o.on = true;
                                                                                    o.coordsize = vml.coordsize;
                                                                                    o.coordorigin = vml.coordorigin;
                                                                                    el.appendChild(o);
                                                                                    el.appendChild(path);
                                                                                    g.appendChild(el);
                                                                                    var res = new Element(o, g, vml);
                                                                                    res.shape = el;
                                                                                    res.textpath = path;
                                                                                    res.type = "text";
                                                                                    res.attrs.x = x;
                                                                                    res.attrs.y = y;
                                                                                    res.attrs.w = 1;
                                                                                    res.attrs.h = 1;
                                                                                    setFillAndStroke(res, {font: availableAttrs.font, stroke: "none", fill: "#000"});
                                                                                    res.setBox();
                                                                                    vml.canvas.appendChild(g);
                                                                                    return res;
                                                                                    };
                                                                                    var setSize = function (width, height) {
                                                                                    this.width = width || this.width;
                                                                                    this.height = height || this.height;
                                                                                    this.canvas.style.width = this.width + "px";
                                                                                    this.canvas.style.height = this.height + "px";
                                                                                    this.canvas.parentNode.style.clip = "rect(0 " + this.width + "px " + this.height + "px 0)";
                                                                                    this.canvas.coordsize = this.width + " " + this.height;
                                                                                    return this;
                                                                                    };
                                                                                    doc.createStyleSheet().addRule(".rvml", "behavior:url(#default#VML)");
                                                                                    try {
                                                                                    if (!doc.namespaces.rvml) {
                                                                                    doc.namespaces.add("rvml", "urn:schemas-microsoft-com:vml");
                                                                                    }
                                                                                    var createNode = function (tagName) {
                                                                                    return doc.createElement('<rvml:' + tagName + ' class="rvml">');
                                                                                    };
                                                                                    } catch (e) {
                                                                                    var createNode = function (tagName) {
                                                                                    return doc.createElement('<' + tagName + ' xmlns="urn:schemas-microsoft.com:vml" class="rvml">');
                                                                                    };
                                                                                    }
                                                                                    var create = function () {
                                                                                    var con = getContainer.apply(null, arguments);
                                                                                    var container = con.container,
                                                                                    x = con.x,
                                                                                    y = con.y,
                                                                                    width = con.width,
                                                                                    height = con.height;
                                                                                    if (!container) {
                                                                                    throw new Error("VML container not found.");
                                                                                    }
                                                                                    var c = doc.createElement("div"),
                                                                                    d = doc.createElement("div"),
                                                                                    r = paper.canvas = createNode("group"),
                                                                                    cs = c.style, rs = r.style;
                                                                                    paper.width = width;
                                                                                    paper.height = height;
                                                                                    width = width || "512px";
                                                                                    height = height || "342px";
                                                                                    cs.clip = "rect(0 " + width + "px " + height + "px 0)";
                                                                                    cs.top = "-2px";
                                                                                    cs.left = "-2px";
                                                                                    cs.position = "absolute";
                                                                                    rs.position = "absolute";
                                                                                    d.style.position = "relative";
                                                                                    rs.width  = width;
                                                                                    rs.height = height;
                                                                                    r.coordsize = (/%$/.test(width) ? width : parseFloat(width)) + " " + (/%$/.test(height) ? height : parseFloat(height));
                                                                                    r.coordorigin = "0 0";
                                                                                    
                                                                                    var b = createNode("rect"), bs = b.style;
                                                                                    bs.left = bs.top = 0;
                                                                                    bs.width  = rs.width;
                                                                                    bs.height = rs.height;
                                                                                    b.filled = b.stroked = "f";
                                                                                    
                                                                                    r.appendChild(b);
                                                                                    c.appendChild(r);
                                                                                    d.appendChild(c);
                                                                                    if (container == 1) {
                                                                                    doc.body.appendChild(d);
                                                                                    cs.position = "absolute";
                                                                                    cs.left = x + "px";
                                                                                    cs.top = y + "px";
                                                                                    cs.width = width;
                                                                                    cs.height = height;
                                                                                    container = {
                                                                                    style: {
                                                                                    width: width,
                                                                                    height: height
                                                                                    }
                                                                                    };
                                                                                    } else {
                                                                                    cs.width = container.style.width = width;
                                                                                    cs.height = container.style.height = height;
                                                                                    if (container.firstChild) {
                                                                                    container.insertBefore(d, container.firstChild);
                                                                                    } else {
                                                                                    container.appendChild(d);
                                                                                    }
                                                                                    }
                                                                                    for (var prop in paper) {
                                                                                    container[prop] = paper[prop];
                                                                                    }
                                                                                    plugins.call(container, container, R.fn);
                                                                                    container.clear = function () {
                                                                                    var todel = [];
                                                                                    for (var i = 0, ii = r.childNodes.length; i < ii; i++) {
                                                                                    if (r.childNodes[i] != b) {
                                                                                    todel.push(r.childNodes[i]);
                                                                                    }
                                                                                    }
                                                                                    for (i = 0, ii = todel.length; i < ii; i++) {
                                                                                    r.removeChild(todel[i]);
                                                                                    }
                                                                                    };
                                                                                    container.raphael = R;
                                                                                    return container;
                                                                                    };
                                                                                    paper.remove = function () {
                                                                                    this.canvas.parentNode.parentNode.parentNode.removeChild(this.canvas.parentNode.parentNode);
                                                                                    };
                                                                                    paper.safari = function () {};
                                                                                    }
                                                                                    
                                                                                    // rest
                                                                                    
                                                                                    // Events
                                                                                    var addEvent = (function () {
                                                                                    if (doc.addEventListener) {
                                                                                    return function (obj, type, fn, element) {
                                                                                    var f = function (e) {
                                                                                    return fn.call(element, e);
                                                                                    };
                                                                                    obj.addEventListener(type, f, false);
                                                                                    return function () {
                                                                                    obj.removeEventListener(type, f, false);
                                                                                    return true;
                                                                                    };
                                                                                    };
                                                                                    } else if (doc.attachEvent) {
                                                                                    return function (obj, type, fn, element) {
                                                                                    var f = function (e) {
                                                                                    return fn.call(element, e || win.event);
                                                                                    };
                                                                                    obj.attachEvent("on" + type, f);
                                                                                    var detacher = function () {
                                                                                    obj.detachEvent("on" + type, f);
                                                                                    return true;
                                                                                    };
                                                                                    if (type == "mouseover") {
                                                                                    obj.attachEvent("onmouseenter", f);
                                                                                    return function () {
                                                                                    obj.detachEvent("onmouseenter", f);
                                                                                    return detacher();
                                                                                    };
                                                                                    } else if (type == "mouseout") {
                                                                                    obj.attachEvent("onmouseleave", f);
                                                                                    return function () {
                                                                                    obj.detachEvent("onmouseleave", f);
                                                                                    return detacher();
                                                                                    };
                                                                                    }
                                                                                    return detacher;
                                                                                    };
                                                                                    }
                                                                                    })();
                                                                                    for (var i = events.length; i--;) {
                                                                                    (function (eventName) {
                                                                                    Element.prototype[eventName] = function (fn) {
                                                                                    if (typeof fn == "function") {
                                                                                    this.events = this.events || {};
                                                                                    this.events[eventName] = this.events[eventName] || {};
                                                                                    this.events[eventName][fn] = this.events[eventName][fn] || [];
                                                                                    this.events[eventName][fn].push(addEvent(this.shape || this.node, eventName, fn, this));
                                                                                    }
                                                                                    return this;
                                                                                    };
                                                                                    Element.prototype["un" + eventName] = function (fn) {
                                                                                    this.events &&
                                                                                    this.events[eventName] &&
                                                                                    this.events[eventName][fn] &&
                                                                                    this.events[eventName][fn].length &&
                                                                                    this.events[eventName][fn].shift()() &&
                                                                                    !this.events[eventName][fn].length &&
                                                                                    delete this.events[eventName][fn];
                                                                                    };
                                                                                    
                                                                                    })(events[i]);
                                                                                    }
                                                                                    paper.circle = function (x, y, r) {
                                                                                    return theCircle(this, x, y, r);
                                                                                    };
                                                                                    paper.rect = function (x, y, w, h, r) {
                                                                                    return theRect(this, x, y, w, h, r);
                                                                                    };
                                                                                    paper.ellipse = function (x, y, rx, ry) {
                                                                                    return theEllipse(this, x, y, rx, ry);
                                                                                    };
                                                                                    paper.path = function (params, pathString) {
                                                                                    return thePath(params, pathString, this);
                                                                                    };
                                                                                    paper.image = function (src, x, y, w, h) {
                                                                                    return theImage(this, src, x, y, w, h);
                                                                                    };
                                                                                    paper.text = function (x, y, text) {
                                                                                    return theText(this, x, y, text);
                                                                                    };
                                                                                    paper.drawGrid = function (x, y, w, h, wv, hv, color) {
                                                                                    color = color || "#000";
                                                                                    var path = ["M", x, y, "L", x + w, y, x + w, y + h, x, y + h, x, y],
                                                                                    rowHeight = h / hv,
                                                                                    columnWidth = w / wv;
                                                                                    for (var i = 1; i < hv; i++) {
                                                                                    path = path.concat(["M", x, y + i * rowHeight, "L", x + w, y + i * rowHeight]);
                                                                                    }
                                                                                    for (var i = 1; i < wv; i++) {
                                                                                    path = path.concat(["M", x + i * columnWidth, y, "L", x + i * columnWidth, y + h]);
                                                                                    }
                                                                                    return this.path({stroke: color, "stroke-width": 1}, path.join(","));
                                                                                    };
                                                                                    paper.pathfinder = function (p, path) {
                                                                                    var commands = {
                                                                                    M: function (x, y) {
                                                                                    this.moveTo(x, y);
                                                                                    },
                                                                                    C: function (x1, y1, x2, y2, x3, y3) {
                                                                                    this.curveTo(x1, y1, x2, y2, x3, y3);
                                                                                    },
                                                                                    Q: function (x1, y1, x2, y2) {
                                                                                    this.qcurveTo(x1, y1, x2, y2);
                                                                                    },
                                                                                    T: function (x, y) {
                                                                                    this.qcurveTo(x, y);
                                                                                    },
                                                                                    S: function (x1, y1, x2, y2) {
                                                                                    p.curveTo(x1, y1, x2, y2);
                                                                                    },
                                                                                    L: function (x, y) {
                                                                                    p.lineTo(x, y);
                                                                                    },
                                                                                    H: function (x) {
                                                                                    this.lineTo(x, this.last.y);
                                                                                    },
                                                                                    V: function (y) {
                                                                                    this.lineTo(this.last.x, y);
                                                                                    },
                                                                                    A: function (rx, ry, xaxisrotation, largearcflag, sweepflag, x, y) {
                                                                                    this.arcTo(rx, ry, largearcflag, sweepflag, x, y);
                                                                                    },
                                                                                    Z: function () {
                                                                                    this.andClose();
                                                                                    }
                                                                                    };
                                                                                    
                                                                                    path = pathToAbsolute(path);
                                                                                    for (var i = 0, ii = path.length; i < ii; i++) {
                                                                                    var b = path[i].shift();
                                                                                    commands[b].apply(p, path[i]);
                                                                                    path[i].unshift(b);
                                                                                    }
                                                                                    };
                                                                                    paper.set = function (itemsArray) {
                                                                                    return new Set(itemsArray);
                                                                                    };
                                                                                    paper.setSize = setSize;
                                                                                    Element.prototype.stop = function () {
                                                                                    clearTimeout(this.animation_in_progress);
                                                                                    };
                                                                                    Element.prototype.scale = function (x, y, cx, cy) {
                                                                                    if (x == null && y == null) {
                                                                                    return {x: this._.sx, y: this._.sy, toString: function () { return this.x.toFixed(3) + " " + this.y.toFixed(3); }};
                                                                                    }
                                                                                    y = y || x;
                                                                                    !+y && (y = x);
                                                                                    var dx, dy, dcx, dcy, a = this.attrs;
                                                                                    if (x != 0) {
                                                                                    var bb = this.type == "path" ? pathDimensions(a.path) : this.getBBox(),
                                                                                    rcx = bb.x + bb.width / 2,
                                                                                    rcy = bb.y + bb.height / 2;
                                                                                    cx = (+cx || cx == 0) ? cx : rcx;
                                                                                    cy = (+cy || cy == 0) ? cy : rcy;
                                                                                    var dirx = Math.round(x / Math.abs(x)),
                                                                                    diry = Math.round(y / Math.abs(y)),
                                                                                    s = this.node.style,
                                                                                    ncx = cx + (rcx - cx) * x * dirx / this._.sx,
                                                                                    ncy = cy + (rcy - cy) * y * diry / this._.sy;
                                                                                    switch (this.type) {
                                                                                    case "rect":
                                                                                    case "image":
                                                                                    var neww = a.width * x * dirx / this._.sx,
                                                                                    newh = a.height * y * diry / this._.sy,
                                                                                    newx = ncx - neww / 2,
                                                                                    newy = ncy - newh / 2;
                                                                                    this.attr({
                                                                                    width: neww,
                                                                                    height: newh,
                                                                                    x: newx,
                                                                                    y: newy
                                                                                    });
                                                                                    break;
                                                                                    case "circle":
                                                                                    case "ellipse":
                                                                                    this.attr({
                                                                                    rx: a.rx * x / this._.sx,
                                                                                    ry: a.ry * y / this._.sy,
                                                                                    r: a.r * x / this._.sx,
                                                                                    cx: ncx,
                                                                                    cy: ncy
                                                                                    });
                                                                                    break;
                                                                                    case "path":
                                                                                    var path = pathToRelative(a.path),
                                                                                    skip = true;
                                                                                    for (var i = 0, ii = path.length; i < ii; i++) {
                                                                                    var p = path[i];
                                                                                    if (p[0].toUpperCase() == "M" && skip) {
                                                                                    continue;
                                                                                    } else {
                                                                                    skip = false;
                                                                                    }
                                                                                    if (R.svg && p[0].toUpperCase() == "A") {
                                                                                    p[path[i].length - 2] *= x / this._.sx;
                                                                                    p[path[i].length - 1] *= y / this._.sy;
                                                                                    p[1] *= x / this._.sx;
                                                                                    p[2] *= y / this._.sy;
                                                                                    p[5] = +(dirx + diry ? !!+p[5] : !+p[5]);
                                                                                    } else {
                                                                                    for (var j = 1, jj = p.length; j < jj; j++) {
                                                                                    p[j] *= (j % 2) ? x / this._.sx : y / this._.sy;
                                                                                    }
                                                                                    }
                                                                                    }
                                                                                    var dim2 = pathDimensions(path),
                                                                                    dx = ncx - dim2.x - dim2.width / 2,
                                                                                    dy = ncy - dim2.y - dim2.height / 2;
                                                                                    path = pathToRelative(path);
                                                                                    path[0][1] += dx;
                                                                                    path[0][2] += dy;
                                                                                    
                                                                                    this.attr({path: path.join(" ")});
                                                                                    break;
                                                                                    }
                                                                                    if (this.type in {text: 1, image:1} && (dirx != 1 || diry != 1)) {
                                                                                    if (this.transformations) {
                                                                                    this.transformations[2] = "scale(".concat(dirx, ",", diry, ")");
                                                                                    this.node.setAttribute("transform", this.transformations.join(" "));
                                                                                    dx = (dirx == -1) ? -a.x - (neww || 0) : a.x;
                                                                                    dy = (diry == -1) ? -a.y - (newh || 0) : a.y;
                                                                                    this.attr({x: dx, y: dy});
                                                                                    a.fx = dirx - 1;
                                                                                    a.fy = diry - 1;
                                                                                    } else {
                                                                                    this.node.filterMatrix = " progid:DXImageTransform.Microsoft.Matrix(M11=".concat(dirx,
                                                                                    ", M12=0, M21=0, M22=", diry,
                                                                                    ", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')");
                                                                                    s.filter = (this.node.filterMatrix || "") + (this.node.filterOpacity || "");
                                                                                    }
                                                                                    } else {
                                                                                    if (this.transformations) {
                                                                                    this.transformations[2] = "";
                                                                                    this.node.setAttribute("transform", this.transformations.join(" "));
                                                                                    a.fx = 0;
                                                                                    a.fy = 0;
                                                                                    } else {
                                                                                    this.node.filterMatrix = "";
                                                                                    s.filter = (this.node.filterMatrix || "") + (this.node.filterOpacity || "");
                                                                                    }
                                                                                    }
                                                                                    a.scale = [x, y, cx, cy].join(" ");
                                                                                    this._.sx = x;
                                                                                    this._.sy = y;
                                                                                    }
                                                                                    return this;
                                                                                    };
                                                                                    Element.prototype.animate = function (params, ms, callback) {
                                                                                    clearTimeout(this.animation_in_progress);
                                                                                    var from = {},
                                                                                    to = {},
                                                                                    diff = {},
                                                                                    t = {x: 0, y: 0};
                                                                                    for (var attr in params) {
                                                                                    if (attr in availableAnimAttrs) {
                                                                                    from[attr] = this.attr(attr);
                                                                                    (typeof from[attr] == "undefined") && (from[attr] = availableAttrs[attr]);
                                                                                    to[attr] = params[attr];
                                                                                    switch (availableAnimAttrs[attr]) {
                                                                                    case "number":
                                                                                    diff[attr] = (to[attr] - from[attr]) / ms;
                                                                                    break;
                                                                                    case "colour":
                                                                                    from[attr] = R.getRGB(from[attr]);
                                                                                    var toColour = R.getRGB(to[attr]);
                                                                                    diff[attr] = {
                                                                                    r: (toColour.r - from[attr].r) / ms,
                                                                                    g: (toColour.g - from[attr].g) / ms,
                                                                                    b: (toColour.b - from[attr].b) / ms
                                                                                    };
                                                                                    break;
                                                                                    case "path":
                                                                                    var pathes = pathEqualiser(from[attr], to[attr]);
                                                                                    from[attr] = pathes[0];
                                                                                    to[attr] = pathes[1];
                                                                                    diff[attr] = [];
                                                                                    for (var i = 0, ii = from[attr].length; i < ii; i++) {
                                                                                    diff[attr][i] = [0];
                                                                                    for (var j = 1, jj = from[attr][i].length; j < jj; j++) {
                                                                                    diff[attr][i][j] = (to[attr][i][j] - from[attr][i][j]) / ms;
                                                                                    }
                                                                                    }
                                                                                    break;
                                                                                    case "csv":
                                                                                    var values = (params[attr] + "").split(separator),
                                                                                    from2 = (from[attr] + "").split(separator);
                                                                                    switch (attr) {
                                                                                    case "translation":
                                                                                    from[attr] = [0, 0];
                                                                                    diff[attr] = [values[0] / ms, values[1] / ms];
                                                                                    break;
                                                                                    case "rotation":
                                                                                    from[attr] = (from2[1] == values[1] && from2[2] == values[2]) ? from2 : [0, values[1], values[2]];
                                                                                    diff[attr] = [(values[0] - from[attr][0]) / ms, 0, 0];
                                                                                    break;
                                                                                    case "scale":
                                                                                    params[attr] = values;
                                                                                    from[attr] = (from[attr] + "").split(separator);
                                                                                    diff[attr] = [(values[0] - from[attr][0]) / ms, (values[1] - from[attr][1]) / ms, 0, 0];
                                                                                    }
                                                                                    to[attr] = values;
                                                                                    }
                                                                                    }
                                                                                    }
                                                                                    var start = +new Date,
                                                                                    prev = 0,
                                                                                    that = this;
                                                                                    (function tick() {
                                                                                    var time = new Date - start,
                                                                                    set = {},
                                                                                    now;
                                                                                    if (time < ms) {
                                                                                    for (var attr in from) {
                                                                                    switch (availableAnimAttrs[attr]) {
                                                                                    case "number":
                                                                                    now = +from[attr] + time * diff[attr];
                                                                                    break;
                                                                                    case "colour":
                                                                                    now = "rgb(" + [
                                                                                    Math.round(from[attr].r + time * diff[attr].r),
                                                                                    Math.round(from[attr].g + time * diff[attr].g),
                                                                                    Math.round(from[attr].b + time * diff[attr].b)
                                                                                    ].join(",") + ")";
                                                                                    break;
                                                                                    case "path":
                                                                                    now = [];
                                                                                    for (var i = 0, ii = from[attr].length; i < ii; i++) {
                                                                                    now[i] = [from[attr][i][0]];
                                                                                    for (var j = 1, jj = from[attr][i].length; j < jj; j++) {
                                                                                    now[i][j] = from[attr][i][j] + time * diff[attr][i][j];
                                                                                    }
                                                                                    now[i] = now[i].join(" ");
                                                                                    }
                                                                                    now = now.join(" ");
                                                                                    break;
                                                                                    case "csv":
                                                                                    switch (attr) {
                                                                                    case "translation":
                                                                                    var x = diff[attr][0] * (time - prev),
                                                                                    y = diff[attr][1] * (time - prev);
                                                                                    t.x += x;
                                                                                    t.y += y;
                                                                                    now = [x, y].join(" ");
                                                                                    break;
                                                                                    case "rotation":
                                                                                    now = +from[attr][0] + time * diff[attr][0];
                                                                                    from[attr][1] && (now += "," + from[attr][1] + "," + from[attr][2]);
                                                                                    break;
                                                                                    case "scale":
                                                                                    now = [+from[attr][0] + time * diff[attr][0], +from[attr][1] + time * diff[attr][1], (2 in params[attr] ? params[attr][2] : ""), (3 in params[attr] ? params[attr][3] : "")].join(" ");
                                                                                    }
                                                                                    break;
                                                                                    }
                                                                                    if (attr == "font-size") {
                                                                                    set[attr] = now + "px";
                                                                                    } else {
                                                                                    set[attr] = now;
                                                                                    }
                                                                                    }
                                                                                    that.attr(set);
                                                                                    that.animation_in_progress = setTimeout(tick);
                                                                                    paper.safari();
                                                                                    } else {
                                                                                    (t.x || t.y) && that.translate(-t.x, -t.y);
                                                                                    that.attr(params);
                                                                                    clearTimeout(that.animation_in_progress);
                                                                                    paper.safari();
                                                                                    (typeof callback == "function") && callback.call(that);
                                                                                    }
                                                                                    prev = time;
                                                                                    })();
                                                                                    return this;
                                                                                    };
                                                                                    Element.prototype.translate = function (x, y) {
                                                                                    if (x == null) {
                                                                                    return {x: this._.tx, y: this._.ty};
                                                                                    }
                                                                                    this._.tx += +x;
                                                                                    this._.ty += +y;
                                                                                    switch (this.type) {
                                                                                    case "circle":
                                                                                    case "ellipse":
                                                                                    this.attr({cx: this.attrs.cx + x, cy: this.attrs.cy + y});
                                                                                    break;
                                                                                    case "rect":
                                                                                    case "image":
                                                                                    case "text":
                                                                                    this.attr({x: this.attrs.x + (+x), y: this.attrs.y + (+y)});
                                                                                    break;
                                                                                    case "path":
                                                                                    var path = pathToRelative(this.attrs.path);
                                                                                    path[0][1] += +x;
                                                                                    path[0][2] += +y;
                                                                                    this.attr({path: path.join(" ")});
                                                                                    break;
                                                                                    }
                                                                                    return this;
                                                                                    };
                                                                                    
                                                                                    // Set
                                                                                    var Set = function () {
                                                                                    this.items = [];
                                                                                    this.length = 0;
                                                                                    for (var i = 0, ii = arguments.length; i < ii; i++) {
                                                                                    if (arguments[i] && (arguments[i].constructor == Element || arguments[i].constructor == Set)) {
                                                                                    this[this.items.length] = this.items[this.items.length] = arguments[i];
                                                                                    this.length++;
                                                                                    }
                                                                                    }
                                                                                    };
                                                                                    Set.prototype.push = function (item) {
                                                                                    if (item && item.constructor == Element || item.constructor == Set) {
                                                                                    var len = this.items.length;
                                                                                    this[len] = this.items[len] = item;
                                                                                    this.length++;
                                                                                    }
                                                                                    return this;
                                                                                    };
                                                                                    Set.prototype.pull = function (id) {
                                                                                    var res = this.items.splice(id, 1)[0];
                                                                                    for (var j = id, jj = this.items.length; j < jj; j++) {
                                                                                    this[j] = this[j + 1];
                                                                                    }
                                                                                    delete this[jj + 1];
                                                                                    this.length--;
                                                                                    return res;
                                                                                    };
                                                                                    for (var method in Element.prototype) {
                                                                                    Set.prototype[method] = (function (methodname) {
                                                                                    return function () {
                                                                                    for (var i = 0, ii = this.items.length; i < ii; i++) {
                                                                                    this.items[i][methodname].apply(this.items[i], arguments);
                                                                                    }
                                                                                    return this;
                                                                                    };
                                                                                    })(method);
                                                                                    }
                                                                                    Set.prototype.attr = function (name, value) {
                                                                                    if (name && name instanceof Array && typeof name[0] == "object") {
                                                                                    for (var j = 0, jj = name.length; j < jj; j++) {
                                                                                    this.items[j].attr(name[j]);
                                                                                    }
                                                                                    } else {
                                                                                    for (var i = 0, ii = this.items.length; i < ii; i++) {
                                                                                    this.items[i].attr.apply(this.items[i], arguments);
                                                                                    }
                                                                                    }
                                                                                    return this;
                                                                                    };
                                                                                    
                                                                                    Set.prototype.getBBox = function () {
                                                                                    var x = [], y = [], w = [], h = [];
                                                                                    for (var i = this.items.length; i--;) {
                                                                                    var box = this.items[i].getBBox();
                                                                                    x.push(box.x);
                                                                                    y.push(box.y);
                                                                                    w.push(box.x + box.width);
                                                                                    h.push(box.y + box.height);
                                                                                    }
                                                                                    x = Math.min.apply(Math, x);
                                                                                    y = Math.min.apply(Math, y);
                                                                                    return {
                                                                                    x: x,
                                                                                    y: y,
                                                                                    width: Math.max.apply(Math, w) - x,
                                                                                    height: Math.max.apply(Math, h) - y
                                                                                    };
                                                                                    };
                                                                                    
                                                                                    R.registerFont = function (font) {
                                                                                    if (!font.face) {
                                                                                    return;
                                                                                    }
                                                                                    this.fonts = this.fonts || {};
                                                                                    if (this.fonts[font.face["font-family"]]) {
                                                                                    this.fonts[font.face["font-family"]].push(font);
                                                                                    } else {
                                                                                    this.fonts[font.face["font-family"]] = [font];
                                                                                    }
                                                                                    if (!font.svg) {
                                                                                    font.face["units-per-em"] = parseInt(font.face["units-per-em"], 10);
                                                                                    
                                                                                    for (var glyph in font.glyphs) {
                                                                                    var path = font.glyphs[glyph];
                                                                                    if (path.d) {
                                                                                    path.d = "M" + path.d.replace(/[mlcxtrv]/g, function (command) {
                                                                                    return {l: "L", c: "C", x: "z", t: "m", r: "l", v: "c"}[command] || "M";
                                                                                    }) + "z";
                                                                                    }
                                                                                    }
                                                                                    }
                                                                                    };
                                                                                    paper.getFont = function (family, weight, style, stretch) {
                                                                                    stretch = stretch || "normal";
                                                                                    style = style || "normal";
                                                                                    weight = +weight || {normal: 400, bold: 700, lighter: 300, bolder: 800}[weight] || 400;
                                                                                    var font = R.fonts[family];
                                                                                    if (!font) {
                                                                                    var name = new RegExp("(^|\\s)" + family.replace(/[^\w\d\s+!~.:_-]/g, "") + "(\\s|$)", "i");
                                                                                    for (var fontName in R.fonts) {
                                                                                    if (name.test(fontName)) {
                                                                                    font = R.fonts[fontName];
                                                                                    break;
                                                                                    }
                                                                                    }
                                                                                    }
                                                                                    var thefont;
                                                                                    if (font) {
                                                                                    for (var i = 0, ii = font.length; i < ii; i++) {
                                                                                    thefont = font[i];
                                                                                    if (thefont.face["font-weight"] == weight && (thefont.face["font-style"] == style || !thefont.face["font-style"]) && thefont.face["font-stretch"] == stretch) {
                                                                                    break;
                                                                                    }
                                                                                    }
                                                                                    }
                                                                                    return thefont;
                                                                                    };
                                                                                    paper.print = function (x, y, string, font, size) {
                                                                                    var out = this.set(),
                                                                                    letters = (string + "").split(""),
                                                                                    shift = 0,
                                                                                    path = "",
                                                                                    scale;
                                                                                    if (font) {
                                                                                    scale = (size || 16) / font.face["units-per-em"];
                                                                                    for (var i = 0, ii = letters.length; i < ii; i++) {
                                                                                    var prev = i && font.glyphs[letters[i - 1]] || {},
                                                                                    curr = font.glyphs[letters[i]];
                                                                                    shift += i ? (prev.w || font.w) + (prev.k && prev.k[letters[i]] || 0) : 0;
                                                                                    curr && curr.d && out.push(this.path({fill: "#000", stroke: "none"}, curr.d).translate(shift, 0));
                                                                                    }
                                                                                    out.scale(scale, scale, 0, y).translate(x, (size || 16) / 2);
                                                                                    }
                                                                                    return out;
                                                                                    };
                                                                                    
                                                                                    R.ninja = function () {
                                                                                    var r = window.Raphael;
                                                                                    if (oldRaphael.was) {
                                                                                    window.Raphael = oldRaphael.is;
                                                                                    } else {
                                                                                    try {
                                                                                    delete window.Raphael;
                                                                                    } catch (e) {
                                                                                    window.Raphael = void(0);
                                                                                    }
                                                                                    }
                                                                                    return r;
                                                                                    };
                                                                                    R.el = Element.prototype;
                                                                                    return R;
                                                                                    })();
                                                                                    
                                                                                    /**
                                                                                    * JTab - Javascript/CSS Guitar Chord and Tab Notation for the Web.
                                                                                    * Version 1.1
                                                                                    * Written by Paul Gallagher (http://tardate.com), 2009.
                                                                                    * See:
                                                                                    *   http://jtab.tardate.com : more information on availability, configuration and use.
                                                                                    *   http://github.com/tardate/jtab/tree/master : source code repository, wiki, documentation
                                                                                    *
                                                                                    * This library also depends on the following two libraries that must be loaded for it to work:
                                                                                    *   prototype - http://www.prototypejs.org/
                                                                                    *   Raphaël - http://raphaeljs.com/
                                                                                    *
                                                                                    *
                                                                                    * This library is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser General 
                                                                                    * Public License as published by the Free Software Foundation; either version 2.1 of the License, or (at your option) 
                                                                                    * any later version.
                                                                                    *
                                                                                    * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied 
                                                                                    * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more 
                                                                                    * details.
                                                                                    *
                                                                                    * You should have received a copy of the GNU Lesser General Public License along with this library; if not, write to 
                                                                                    * the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA 
                                                                                    */
                                                                                    
                                                                                    //
                                                                                    // define the jtab class
                                                                                    //
                                                                                    
                                                                                    var jtab = {
                                                                                    Version : '1.1',
                                                                                    Strings : {
                                                                                    AboutDialog : '<html><head><title>About jTab</title></head><body style=""><p style="">jTab version: {V}</p><p><a href="http://jtab.tardate.com" target="_blank">http://jtab.tardate.com</a></p><p><input type="button" class="close" value="OK" onClick="window.close()"/></p></body></html>'
                                                                                    },
                                                                                    Chords : {
                                                                                    // chord data - currently explicit representation for 6 string guitar, standard tuning only, and 
                                                                                    // each chord is an array of alternate positions
                                                                                    //   0   : 1st (open) position
                                                                                    //   1   : 1st barre position, generally at 12/13/14th fret
                                                                                    //         - minimum, only required for CAGED chords where open strings are used in the 1st (open) position
                                                                                    //           since the main purpose of this is to provide barre fingering positions for CAGED-based chords
                                                                                    //   2.. : alternative positions/fingerings
                                                                                    // each position is an array comprising: 1. base fret (0==nut); 2. 6x note definitions (strings 6,5,4,3,2,1)
                                                                                    // each note is an array: (fret position), (left hand fingering if applicable 1,2,3,4,T)
                                                                                    // fret position: -1 = muted/not played; 0 = open; 1,2,3... = fret position
                                                                                    "A": [[ 0, [-1,0 ],  [0,0],  [2,2],  [2,3],  [2,4],  [0,0] ], []],
                                                                                    "Am": [[ 0, [-1,0 ],  [0,0],  [2,2],  [2,3],  [1,1],  [0,0] ], []],
                                                                                    "Am7": [[ 0, [-1,0 ],  [0,0],  [2,2],  [0,0],  [1,1],  [0,0] ], []],
                                                                                    "A7M": [[ 0, [-1,0 ],  [0,0],  [2,2],  [1,1],  [2,3],  [0,0] ], []],
                                                                                    "A7": [[ 0, [-1,0 ],  [0,0],  [2,2],  [0,0],  [2,3],  [0,0] ], []],
                                                                                    "A9": [[ 0, [-1,0 ],  [0,0],  [2,2],  [2,3],  [0,0],  [0,0] ], []],
                                                                                    "A7(9)": [[ 0, [-1,0 ],  [0,0],  [2,1],  [0,0],  [0,0],  [0,0] ], []],
                                                                                    "A6": [[ 0, [-1,0 ],  [0,0],  [4,3],  [2,1],  [2,1],  [2,1] ], []],
                                                                                    "A6(9)": [[ 0, [-1,0 ],  [0,0],  [4,3],  [4,4],  [2,1],  [0,0] ], []],
                                                                                    "A(5-)": [[ 0, [-1,0 ],  [0,1],  [1,2],  [2,3],  [2,4],  [0,1] ], []],
                                                                                    "Am(5-)": [[ 0, [-1,0 ],  [0,0],  [1,1],  [2,3],  [1,2],  [0,0] ], []],
                                                                                    "A7(5-)": [[ 0, [-1,0 ],  [0,1],  [1,3],  [0,2],  [2,4],  [-1,0] ], []],
                                                                                    "Am7(5-)": [[ 0, [-1,0 ],  [0,1],  [1,3],  [0,2],  [1,4],  [-1,0] ], []],
                                                                                    "Adim7": [[ 0, [-1,0 ],  [0,0],  [1,1],  [2,3],  [1,2],  [2,4] ], []],
                                                                                    "A4": [[ 0, [-1,0 ],  [0,0],  [2,1],  [2,2],  [3,3],  [0,0] ], []],
                                                                                    "Am4": [[ 0, [-1,0 ],  [0,1],  [0,1],  [2,3],  [1,2],  [0,1] ], []],
                                                                                    "Am6": [[ 0, [5,2 ],  [-1,0],  [4,1],  [5,2],  [5,3],  [-1,0] ], []],
                                                                                    "Am9": [[ 0, [-1,0 ],  [0,1],  [2,3],  [4,4],  [1,2],  [0,1] ], []],
                                                                                    "Bb": [[ 0, [-1,0 ],  [1,1],  [3,2],  [3,3],  [3,4],  [1,1] ], []],
                                                                                    "Bbm": [[ 0, [-1,0 ],  [1,1],  [3,3],  [3,4],  [2,2],  [1,1] ], []],
                                                                                    "Bbm7": [[ 0, [-1,0 ],  [1,1],  [3,3],  [1,1],  [2,2],  [1,1] ], []],
                                                                                    "Bb7M": [[ 0, [-1,0 ],  [1,1],  [3,3],  [2,2],  [3,4],  [1,1] ], []],
                                                                                    "Bb7": [[ 0, [-1,0 ],  [1,1],  [3,3],  [1,1],  [3,4],  [1,1] ], []],
                                                                                    "Bb9": [[ 0, [-1,0 ],  [1,1],  [3,3],  [3,4],  [1,1],  [1,1] ], []],
                                                                                    "Bb7(9)": [[ 0, [-1,0 ],  [1,1],  [3,3],  [1,1],  [1,1],  [1,1] ], []],
                                                                                    "Bb6": [[ 0, [-1,0 ],  [1,2],  [-1,0],  [0,1],  [3,4],  [1,3] ], []],
                                                                                    "Bb6(9)": [[ 0, [-1,0 ],  [1,2],  [0,1],  [0,1],  [1,4],  [1,3] ], []],
                                                                                    "Bb(5-)": [[ 0, [-1,0 ],  [1,1],  [2,2],  [3,3],  [3,4],  [1,1] ], []],
                                                                                    "Bbm(5-)": [[ 0, [-1,0 ],  [1,1],  [2,2],  [3,4],  [2,3],  [1,1] ], []],
                                                                                    "Bb7(5-)": [[ 0, [-1,0 ],  [1,1],  [2,3],  [1,2],  [3,4],  [-1,0] ], []],
                                                                                    "Bbm7(5-)": [[ 0, [-1,0 ],  [1,1],  [2,3],  [1,2],  [2,4],  [-1,0] ], []],
                                                                                    "Bbdim7": [[ 0, [-1,0 ],  [1,2],  [2,3],  [0,1],  [2,4],  [-1,0] ], []],
                                                                                    "Bb4": [[ 0, [-1,0 ],  [1,1],  [3,2],  [3,3],  [4,4],  [1,1] ], []],
                                                                                    "Bbm4": [[ 0, [-1,0 ],  [1,1],  [1,1],  [3,3],  [2,2],  [1,1] ], []],
                                                                                    "Bbm6": [[ 0, [-1,0 ],  [1,2],  [3,4],  [0,1],  [2,3],  [1,0] ], []],
                                                                                    "Bbm9": [[ 0, [-1,0 ],  [1,1],  [3,3],  [5,4],  [2,2],  [1,1] ], []],
                                                                                    "B": [[ 0, [-1,0 ],  [2,1],  [4,2],  [4,3],  [4,4],  [2,1] ], []],
                                                                                    "Bm": [[ 0, [-1,0 ],  [2,1],  [4,3],  [4,4],  [3,2],  [2,1] ], []],
                                                                                    "Bm7": [[ 0, [-1,0 ],  [2,1],  [4,3],  [2,1],  [3,2],  [2,1] ], []],
                                                                                    "B7M": [[ 0, [-1,0 ],  [2,1],  [4,3],  [3,2],  [4,4],  [2,1] ], []],
                                                                                    "B7": [[ 0, [-1,0 ],  [2,1],  [4,3],  [2,1],  [4,4],  [2,1] ], []],
                                                                                    "B9": [[ 0, [-1,0 ],  [2,1],  [4,3],  [4,4],  [2,1],  [2,1] ], []],
                                                                                    "B7(9)": [[ 0, [-1,0 ],  [2,1],  [4,3],  [2,1],  [2,1],  [2,1] ], []],
                                                                                    "B6": [[ 0, [-1,0 ],  [2,2],  [-1,0],  [1,1],  [4,4],  [2,3] ], []],
                                                                                    "B6(9)": [[ 0, [-1,0 ],  [2,2],  [1,1],  [1,1],  [2,4],  [2,3] ], []],
                                                                                    "B(5-)": [[ 0, [-1,0 ],  [2,1],  [3,2],  [4,3],  [4,4],  [2,1] ], []],
                                                                                    "Bm(5-)": [[ 0, [-1,0 ],  [2,1],  [3,2],  [4,4],  [3,3],  [2,1] ], []],
                                                                                    "B7(5-)": [[ 0, [-1,0 ],  [2,1],  [3,3],  [2,2],  [4,4],  [-1,0] ], []],
                                                                                    "Bm7(5-)": [[ 0, [-1,0 ],  [2,1],  [3,3],  [2,2],  [3,4],  [-1,0] ], []],
                                                                                    "Bdim7": [[ 0, [-1,0 ],  [2,2],  [3,3],  [1,1],  [3,4],  [-1,0] ], []],
                                                                                    "B4": [[ 0, [-1,0 ],  [2,1],  [4,2],  [4,3],  [5,4],  [2,1] ], []],
                                                                                    "Bm4": [[ 0, [-1,0 ],  [2,1],  [2,1],  [4,3],  [3,2],  [2,1] ], []],
                                                                                    "Bm6": [[ 0, [-1,0 ],  [2,2],  [4,4],  [1,1],  [3,3],  [2,0] ], []],
                                                                                    "Bm9": [[ 0, [-1,0 ],  [2,1],  [4,3],  [6,4],  [3,2],  [2,1] ], []],
                                                                                    "C": [[ 0, [-1,0 ],  [3,1],  [5,2],  [5,3],  [5,4],  [3,1] ], []],
                                                                                    "Cm": [[ 0, [-1,0 ],  [3,1],  [5,3],  [5,4],  [4,2],  [3,1] ], []],
                                                                                    "Cm7": [[ 0, [-1,0 ],  [3,1],  [5,3],  [3,1],  [4,2],  [3,1] ], []],
                                                                                    "C7M": [[ 0, [-1,0 ],  [3,1],  [5,3],  [4,2],  [5,4],  [3,1] ], []],
                                                                                    "C7": [[ 0, [-1,0 ],  [3,1],  [5,3],  [3,1],  [5,4],  [3,1] ], []],
                                                                                    "C9": [[ 0, [-1,0 ],  [3,1],  [5,3],  [5,4],  [3,1],  [3,1] ], []],
                                                                                    "C7(9)": [[ 0, [-1,0 ],  [3,1],  [5,3],  [3,1],  [3,1],  [3,1] ], []],
                                                                                    "C6": [[ 0, [-1,0 ],  [3,2],  [-1,0],  [2,1],  [5,4],  [3,3] ], []],
                                                                                    "C6(9)": [[ 0, [-1,0 ],  [3,2],  [2,1],  [2,1],  [3,4],  [3,3] ], []],
                                                                                    "C(5-)": [[ 0, [-1,0 ],  [3,1],  [4,2],  [5,3],  [5,4],  [3,1] ], []],
                                                                                    "Cm(5-)": [[ 0, [-1,0 ],  [3,1],  [4,2],  [5,4],  [4,3],  [3,1] ], []],
                                                                                    "C7(5-)": [[ 0, [-1,0 ],  [3,1],  [4,3],  [3,2],  [5,4],  [-1,0] ], []],
                                                                                    "Cm7(5-)": [[ 0, [-1,0 ],  [3,1],  [4,3],  [3,2],  [4,4],  [-1,0] ], []],
                                                                                    "Cdim7": [[ 0, [-1,0 ],  [3,2],  [4,3],  [2,1],  [4,4],  [-1,0] ], []],
                                                                                    "C4": [[ 2, [-1,0 ],  [3,1],  [5,2],  [5,3],  [6,4],  [3,1] ], []],
                                                                                    "Cm4": [[ 0, [-1,0 ],  [3,1],  [3,1],  [5,3],  [4,2],  [3,1] ], []],
                                                                                    "Cm6": [[ 0, [-1,0 ],  [3,2],  [5,4],  [2,1],  [4,3],  [3,0] ], []],
                                                                                    "Cm9": [[ 2, [-1,0 ],  [3,1],  [5,3],  [7,4],  [4,2],  [3,1] ], []],
                                                                                    "C#": [[ 3, [-1,0 ],  [4,1],  [6,2],  [6,3],  [6,4],  [4,1] ], []],
                                                                                    "C#m": [[ 3, [-1,0 ],  [4,1],  [6,3],  [6,4],  [5,2],  [4,1] ], []],
                                                                                    "C#m7": [[ 3, [-1,0 ],  [4,1],  [6,3],  [4,1],  [5,2],  [4,1] ], []],
                                                                                    "C#7M": [[ 3, [-1,0 ],  [4,1],  [6,3],  [5,2],  [6,4],  [4,1] ], []],
                                                                                    "C#7": [[ 3, [-1,0 ],  [4,1],  [6,3],  [4,1],  [6,4],  [4,1] ], []],
                                                                                    "C#9": [[ 3, [-1,0 ],  [4,1],  [6,3],  [6,4],  [4,1],  [4,1] ], []],
                                                                                    "C#7(9)": [[ 3, [-1,0 ],  [4,1],  [6,3],  [4,1],  [4,1],  [4,1] ], []],
                                                                                    "C#6": [[ 2, [-1,0 ],  [4,2],  [-1,0],  [3,1],  [6,4],  [4,3] ], []],
                                                                                    "C#6(9)": [[ 0, [-1,0 ],  [4,2],  [3,1],  [3,1],  [4,4],  [4,3] ], []],
                                                                                    "C#(5-)": [[ 3, [-1,0 ],  [4,1],  [5,2],  [6,3],  [6,4],  [4,1] ], []],
                                                                                    "C#m(5-)": [[ 3, [-1,0 ],  [4,1],  [5,2],  [6,4],  [5,3],  [4,1] ], []],
                                                                                    "C#7(5-)": [[ 3, [-1,0 ],  [4,1],  [5,3],  [4,2],  [6,4],  [-1,0] ], []],
                                                                                    "C#m7(5-)": [[ 0, [-1,0 ],  [4,1],  [5,3],  [4,2],  [5,4],  [-1,0] ], []],
                                                                                    "C#dim7": [[ 0, [-1,0 ],  [4,2],  [5,3],  [3,1],  [5,4],  [-1,0] ], []],
                                                                                    "C#4": [[ 3, [-1,0 ],  [4,1],  [6,2],  [6,3],  [7,4],  [4,1] ], []],
                                                                                    "C#m4": [[ 3, [-1,0 ],  [4,1],  [4,1],  [6,3],  [5,2],  [4,1] ], []],
                                                                                    "C#m6": [[ 2, [-1,0 ],  [4,2],  [6,4],  [3,1],  [5,3],  [4,0] ], []],
                                                                                    "C#m9": [[ 3, [-1,0 ],  [4,1],  [6,3],  [8,4],  [5,2],  [4,1] ], []],
                                                                                    "D": [[ 4, [-1,0 ],  [5,1],  [7,2],  [7,3],  [7,4],  [5,1] ], []],
                                                                                    "Dm": [[ 4, [-1,0 ],  [5,1],  [7,3],  [7,4],  [6,2],  [5,1] ], []],
                                                                                    "Dm7": [[ 4, [-1,0 ],  [5,1],  [7,3],  [5,1],  [6,2],  [5,1] ], []],
                                                                                    "D7M": [[ 4, [-1,0 ],  [5,1],  [7,3],  [6,2],  [7,4],  [5,1] ], []],
                                                                                    "D7": [[ 4, [-1,0 ],  [5,1],  [7,3],  [5,1],  [7,4],  [5,1] ], []],
                                                                                    "D9": [[ 4, [-1,0 ],  [5,1],  [7,3],  [7,4],  [5,1],  [5,1] ], []],
                                                                                    "D7(9)": [[ 4, [-1,0 ],  [5,1],  [7,3],  [5,1],  [5,1],  [5,1] ], []],
                                                                                    "D6": [[ 3, [-1,0 ],  [5,2],  [-1,0],  [4,1],  [7,4],  [5,3] ], []],
                                                                                    "D6(9)": [[ 0, [-1,0 ],  [5,2],  [4,1],  [4,1],  [5,4],  [5,3] ], []],
                                                                                    "D(5-)": [[ 4, [-1,0 ],  [5,1],  [6,2],  [7,3],  [7,4],  [5,1] ], []],
                                                                                    "Dm(5-)": [[ 4, [-1,0 ],  [5,1],  [6,2],  [7,4],  [6,3],  [5,1] ], []],
                                                                                    "D7(5-)": [[ 4, [-1,0 ],  [5,1],  [6,3],  [5,2],  [7,4],  [-1,0] ], []],
                                                                                    "Dm7(5-)": [[ 4, [-1,0 ],  [5,1],  [6,3],  [5,2],  [6,4],  [-1,0] ], []],
                                                                                    "Ddim7": [[ 3, [-1,0 ],  [5,2],  [6,3],  [4,1],  [6,4],  [-1,0] ], []],
                                                                                    "D4": [[ 4, [-1,0 ],  [5,1],  [7,2],  [7,3],  [8,4],  [5,1] ], []],
                                                                                    "Dm4": [[ 4, [-1,0 ],  [5,1],  [5,1],  [7,3],  [6,2],  [5,1] ], []],
                                                                                    "Dm6": [[ 3, [-1,0 ],  [5,2],  [7,4],  [4,1],  [6,3],  [5,0] ], []],
                                                                                    "Dm9": [[ 4, [-1,0 ],  [5,1],  [7,3],  [9,4],  [6,2],  [5,1] ], []],
                                                                                    "Eb": [[ 5, [-1,0 ],  [6,1],  [8,2],  [8,3],  [8,4],  [6,1] ], []],
                                                                                    "Ebm": [[ 5, [-1,0 ],  [6,1],  [8,3],  [8,4],  [7,2],  [6,1] ], []],
                                                                                    "Ebm7": [[ 5, [-1,0 ],  [6,1],  [8,3],  [6,1],  [7,2],  [6,1] ], []],
                                                                                    "Eb7M": [[ 5, [-1,0 ],  [6,1],  [8,3],  [7,2],  [8,4],  [6,1] ], []],
                                                                                    "Eb7": [[ 5, [-1,0 ],  [6,1],  [8,3],  [6,1],  [8,4],  [6,1] ], []],
                                                                                    "Eb9": [[ 5, [-1,0 ],  [6,1],  [8,3],  [8,4],  [6,1],  [6,1] ], []],
                                                                                    "Eb7(9)": [[ 5, [-1,0 ],  [6,1],  [8,3],  [6,1],  [6,1],  [6,1] ], []],
                                                                                    "Eb6": [[ 4, [-1,0 ],  [6,2],  [-1,0],  [5,1],  [8,4],  [6,3] ], []],
                                                                                    "Eb6(9)": [[ 4, [-1,0 ],  [6,2],  [5,1],  [5,1],  [6,4],  [6,3] ], []],
                                                                                    "Eb(5-)": [[ 5, [-1,0 ],  [6,1],  [7,2],  [8,3],  [8,4],  [6,1] ], []],
                                                                                    "Ebm(5-)": [[ 5, [-1,0 ],  [6,1],  [7,2],  [8,4],  [7,3],  [6,1] ], []],
                                                                                    "Eb7(5-)": [[ 5, [-1,0 ],  [6,1],  [7,3],  [6,2],  [8,4],  [-1,0] ], []],
                                                                                    "Ebm7(5-)": [[ 5, [-1,0 ],  [6,1],  [7,3],  [6,2],  [7,4],  [-1,0] ], []],
                                                                                    "Ebdim7": [[ 4, [-1,0 ],  [6,2],  [7,3],  [5,1],  [7,4],  [-1,0] ], []],
                                                                                    "Eb4": [[ 5, [-1,0 ],  [6,1],  [8,2],  [8,3],  [9,4],  [6,1] ], []],
                                                                                    "Ebm4": [[ 5, [-1,0 ],  [6,1],  [6,1],  [8,3],  [7,2],  [6,1] ], []],
                                                                                    "Ebm6": [[ 4, [-1,0 ],  [6,2],  [8,4],  [5,1],  [7,3],  [6,0] ], []],
                                                                                    "Ebm9": [[ 5, [-1,0 ],  [6,1],  [8,3],  [10,4],  [7,2],  [6,1] ], []],
                                                                                    "E": [[ 0, [0,1 ],  [2,3],  [2,4],  [1,2],  [0,1],  [0,1] ], []],
                                                                                    "Em": [[ 0, [0,1 ],  [2,3],  [2,4],  [0,1],  [0,1],  [0,1] ], []],
                                                                                    "Em7": [[ 0, [0,1 ],  [2,3],  [0,1],  [0,1],  [0,1],  [0,1] ], []],
                                                                                    "E7": [[ 0, [0,1 ],  [2,3],  [0,1],  [1,2],  [0,1],  [0,1] ], []],
                                                                                    "E7M": [[ 0, [0,1 ],  [-1,0],  [1,3],  [1,4],  [0,2],  [-1,0] ], []],
                                                                                    "E6": [[ 0, [0,0 ],  [-1,0],  [2,1],  [4,3],  [2,2],  [4,4] ], []],
                                                                                    "E6(9)": [[ 0, [0,0 ],  [-1,0],  [2,2],  [1,1],  [2,3],  [2,4] ], []],
                                                                                    "E7(9)": [[ 0, [0,0 ],  [-1,0],  [2,2],  [1,1],  [3,4],  [2,3] ], []],
                                                                                    "E9": [[ 0, [0,0 ],  [2,2],  [4,4],  [1,1],  [0,0],  [0,0] ], []],
                                                                                    "Em6": [[ 0, [0,0 ],  [2,1],  [2,2],  [0,0],  [2,3],  [0,0] ], []],
                                                                                    "Em9": [[ 0, [0,0 ],  [2,1],  [4,3],  [0,0],  [0,0],  [0,0] ], []],
                                                                                    "E(5-)": [[ 0, [0,1 ],  [2,2],  [2,3],  [3,4],  [0,1],  [0,1] ], []],
                                                                                    "Em(5-)": [[ 0, [0,1 ],  [1,2],  [2,3],  [0,1],  [0,1],  [0,1] ], []],
                                                                                    "Em7(5-)": [[ 0, [0,0 ],  [1,1],  [0,0],  [0,0],  [-1,0],  [-1,0] ], []],
                                                                                    "E7(5-)": [[ 0, [-1,0 ],  [-1,0],  [2,1],  [3,2],  [3,3],  [4,4] ], []],
                                                                                    "Edim7": [[ 0, [-1,0 ],  [-1,0],  [2,1],  [3,3],  [2,2],  [3,4] ], []],
                                                                                    "E4": [[ 0, [0,0 ],  [2,1],  [2,2],  [2,3],  [0,0],  [0,0] ], []],
                                                                                    "Em4": [[ 0, [0,0 ],  [0,0],  [2,2],  [0,0],  [0,0],  [0,0] ], []],
                                                                                    "F": [[ 0, [1,1 ],  [3,3],  [3,4],  [2,2],  [1,1],  [1,1] ], []],
                                                                                    "Fm": [[ 0, [1,1 ],  [3,3],  [3,4],  [1,1],  [1,1],  [1,1] ], []],
                                                                                    "Fm7": [[ 0, [1,1 ],  [3,3],  [1,1],  [1,1],  [1,1],  [1,1] ], []],
                                                                                    "F7": [[ 0, [1,1 ],  [3,3],  [1,1],  [2,2],  [1,1],  [1,1] ], []],
                                                                                    "F7M": [[ 0, [1,1 ],  [-1,0],  [2,3],  [2,4],  [1,2],  [-1,0] ], []],
                                                                                    "F6": [[ 0, [1,2 ],  [-1,0],  [0,1],  [2,4],  [1,3],  [-1,0] ], []],
                                                                                    "F6(9)": [[ 0, [1,3 ],  [-1,0],  [0,1],  [0,2],  [1,4],  [-1,0] ], []],
                                                                                    "F7(9)": [[ 0, [1,2 ],  [-1,0],  [1,3],  [0,1],  [1,4],  [-1,0] ], []],
                                                                                    "F9": [[ 0, [1,2 ],  [-1,0],  [1,3],  [0,1],  [1,4],  [-1,0] ], []],
                                                                                    "Fm6": [[ 0, [1,2 ],  [-1,0],  [0,1],  [1,3],  [1,4],  [-1,0] ], []],
                                                                                    "Fm9": [[ 0, [1,1 ],  [3,3],  [5,4],  [1,1],  [1,1],  [1,1] ], []],
                                                                                    "F(5-)": [[ 0, [1,1 ],  [3,2],  [3,3],  [4,4],  [1,1],  [1,1] ], []],
                                                                                    "Fm(5-)": [[ 0, [1,1 ],  [2,2],  [3,3],  [1,1],  [1,1],  [1,1] ], []],
                                                                                    "Fm7(5-)": [[ 0, [1,2 ],  [-1,0],  [1,3],  [1,4],  [0,1],  [-1,0] ], []],
                                                                                    "F7(5-)": [[ 0, [1,2 ],  [-1,0],  [1,3],  [2,4],  [0,1],  [-1,0] ], []],
                                                                                    "Fdim7": [[ 0, [1,3 ],  [-1,0],  [0,1],  [1,4],  [0,2],  [-1,0] ], []],
                                                                                    "F4": [[ 0, [1,1 ],  [3,2],  [3,3],  [3,4],  [1,1],  [1,1] ], []],
                                                                                    "Fm4": [[ 0, [1,1 ],  [1,1],  [3,3],  [1,1],  [1,1],  [1,1] ], []],
                                                                                    "F#": [[ 0, [2,1 ],  [4,3],  [4,4],  [3,2],  [2,1],  [2,1] ], []],
                                                                                    "F#m": [[ 0, [2,1 ],  [4,3],  [4,4],  [2,1],  [2,1],  [2,1] ], []],
                                                                                    "F#m7": [[ 0, [2,1 ],  [4,3],  [2,1],  [2,1],  [2,1],  [2,1] ], []],
                                                                                    "F#7": [[ 0, [2,1 ],  [4,3],  [2,1],  [3,2],  [2,1],  [2,1] ], []],
                                                                                    "F#7M": [[ 0, [2,1 ],  [-1,0],  [3,3],  [3,4],  [2,2],  [-1,0] ], []],
                                                                                    "F#6": [[ 0, [2,2 ],  [-1,0],  [1,1],  [3,4],  [2,3],  [-1,0] ], []],
                                                                                    "F#6(9)": [[ 0, [2,3 ],  [-1,0],  [1,1],  [1,2],  [2,4],  [-1,0] ], []],
                                                                                    "F#7(9)": [[ 0, [2,2 ],  [-1,0],  [2,3],  [1,1],  [2,4],  [-1,0] ], []],
                                                                                    "F#9": [[ 0, [2,2 ],  [-1,0],  [2,3],  [1,1],  [2,4],  [-1,0] ], []],
                                                                                    "F#m6": [[ 0, [2,2 ],  [-1,0],  [1,1],  [2,3],  [2,4],  [-1,0] ], []],
                                                                                    "F#m9": [[ 0, [2,1 ],  [4,3],  [6,4],  [2,1],  [2,1],  [2,1] ], []],
                                                                                    "F#(5-)": [[ 0, [2,1 ],  [4,2],  [4,3],  [5,4],  [2,1],  [2,1] ], []],
                                                                                    "F#m(5-)": [[ 0, [2,1 ],  [3,2],  [4,3],  [2,1],  [2,1],  [2,1] ], []],
                                                                                    "F#m7(5-)": [[ 0, [2,2 ],  [-1,0],  [2,3],  [2,4],  [1,1],  [-1,0] ], []],
                                                                                    "F#7(5-)": [[ 0, [2,2 ],  [-1,0],  [2,3],  [3,4],  [1,1],  [-1,0] ], []],
                                                                                    "F#dim7": [[ 0, [2,3 ],  [-1,0],  [1,1],  [2,4],  [1,2],  [-1,0] ], []],
                                                                                    "F#4": [[ 0, [2,1 ],  [4,2],  [4,3],  [4,4],  [2,1],  [2,1] ], []],
                                                                                    "F#m4": [[ 0, [2,1 ],  [2,1],  [4,3],  [2,1],  [2,1],  [2,1] ], []],
                                                                                    "G": [[ 0, [3,1 ],  [5,3],  [5,4],  [4,2],  [3,1],  [3,1] ], []],
                                                                                    "Gm": [[ 0, [3,1 ],  [5,3],  [5,4],  [3,1],  [3,1],  [3,1] ], []],
                                                                                    "Gm7": [[ 0, [3,1 ],  [5,3],  [3,1],  [3,1],  [3,1],  [3,1] ], []],
                                                                                    "G7": [[ 0, [3,1 ],  [5,3],  [3,1],  [4,2],  [3,1],  [3,1] ], []],
                                                                                    "G7M": [[ 0, [3,1 ],  [-1,0],  [4,3],  [4,4],  [3,2],  [-1,0] ], []],
                                                                                    "G6": [[ 0, [3,2 ],  [-1,0],  [2,1],  [4,4],  [3,3],  [-1,0] ], []],
                                                                                    "G6(9)": [[ 0, [3,3 ],  [-1,0],  [2,1],  [2,2],  [3,4],  [-1,0] ], []],
                                                                                    "G7(9)": [[ 0, [3,2 ],  [-1,0],  [3,3],  [2,1],  [3,4],  [-1,0] ], []],
                                                                                    "G9": [[ 0, [3,2 ],  [-1,0],  [0,0],  [2,1],  [3,3],  [-1,0] ], []],
                                                                                    "Gm6": [[ 0, [3,2 ],  [-1,0],  [2,1],  [3,3],  [3,4],  [-1,0] ], []],
                                                                                    "Gm9": [[ 2, [3,1 ],  [5,3],  [7,4],  [3,1],  [3,1],  [3,1] ], []],
                                                                                    "G(5-)": [[ 2, [3,1 ],  [5,2],  [5,3],  [6,4],  [3,1],  [3,1] ], []],
                                                                                    "Gm(5-)": [[ 0, [3,1 ],  [4,2],  [5,3],  [3,1],  [3,1],  [3,1] ], []],
                                                                                    "Gm7(5-)": [[ 0, [3,2 ],  [-1,0],  [3,3],  [3,4],  [2,1],  [-1,0] ], []],
                                                                                    "G7(5-)": [[ 0, [3,2 ],  [-1,0],  [3,3],  [4,4],  [2,1],  [-1,0] ], []],
                                                                                    "Gdim7": [[ 0, [3,3 ],  [-1,0],  [2,1],  [3,4],  [2,2],  [-1,0] ], []],
                                                                                    "G4": [[ 0, [3,1 ],  [5,2],  [5,3],  [5,4],  [3,1],  [3,1] ], []],
                                                                                    "Gm4": [[ 0, [3,1 ],  [3,1],  [5,3],  [3,1],  [3,1],  [3,1] ], []],
                                                                                    "G#": [[ 3, [4,1 ],  [6,3],  [6,4],  [5,2],  [4,1],  [4,1] ], []],
                                                                                    "G#m": [[ 3, [4,1 ],  [6,3],  [6,4],  [4,1],  [4,1],  [4,1] ], []],
                                                                                    "G#m7": [[ 3, [4,1 ],  [6,3],  [4,1],  [4,1],  [4,1],  [4,1] ], []],
                                                                                    "G#7": [[ 3, [4,1 ],  [6,3],  [4,1],  [5,2],  [4,1],  [4,1] ], []],
                                                                                    "G#7M": [[ 0, [4,1 ],  [-1,0],  [5,3],  [5,4],  [4,2],  [-1,0] ], []],
                                                                                    "G#6": [[ 0, [4,2 ],  [-1,0],  [3,1],  [5,4],  [4,3],  [-1,0] ], []],
                                                                                    "G#6(9)": [[ 0, [4,3 ],  [-1,0],  [3,1],  [3,2],  [4,4],  [-1,0] ], []],
                                                                                    "G#7(9)": [[ 0, [4,2 ],  [-1,0],  [4,3],  [3,1],  [4,4],  [-1,0] ], []],
                                                                                    "G#9": [[ 0, [4,2 ],  [-1,0],  [4,3],  [3,1],  [4,4],  [-1,0] ], []],
                                                                                    "G#m6": [[ 0, [4,2 ],  [-1,0],  [3,1],  [4,3],  [4,4],  [-1,0] ], []],
                                                                                    "G#m9": [[ 3, [4,1 ],  [6,3],  [8,4],  [4,1],  [4,1],  [4,1] ], []],
                                                                                    "G#(5-)": [[ 3, [4,1 ],  [6,2],  [6,3],  [7,4],  [4,1],  [4,1] ], []],
                                                                                    "G#m(5-)": [[ 3, [4,1 ],  [5,2],  [6,3],  [4,1],  [4,1],  [4,1] ], []],
                                                                                    "G#m7(5-)": [[ 0, [4,2 ],  [-1,0],  [4,3],  [4,4],  [3,1],  [-1,0] ], []],
                                                                                    "G#7(5-)": [[ 0, [4,2 ],  [-1,0],  [4,3],  [5,4],  [3,1],  [-1,0] ], []],
                                                                                    "G#dim7": [[ 0, [4,3 ],  [-1,0],  [3,1],  [4,4],  [3,2],  [-1,0] ], []],
                                                                                    "G#4": [[ 3, [4,1 ],  [6,2],  [6,3],  [6,4],  [4,1],  [4,1] ], []],
                                                                                    "G#m4": [[ 3, [4,1 ],  [4,1],  [6,3],  [4,1],  [4,1],  [4,1] ], []]
                                                                                    },
                                                                                    WesternScale: {
                                                                                    BaseNotes:  { // for each: array[ translated western scale note, caged base, base fret ]
                                                                                    'C' : [ 'C' , 'C', 0 ],
                                                                                    'C#': [ 'C#', 'C', 1 ],
                                                                                    'Db': [ 'C#', 'C', 1 ],
                                                                                    'D' : [ 'D' , 'D', 0 ],
                                                                                    'D#': [ 'Eb', 'D', 1 ],
                                                                                    'Eb': [ 'Eb', 'D', 1 ],
                                                                                    'E' : [ 'E' , 'E', 0 ],
                                                                                    'F' : [ 'F' , 'E', 1 ],
                                                                                    'F#': [ 'F#', 'E', 2 ],
                                                                                    'Gb': [ 'F#', 'E', 2 ],
                                                                                    'G' : [ 'G' , 'G', 0 ],
                                                                                    'G#': [ 'G#', 'G', 1 ],
                                                                                    'Ab': [ 'G#', 'G', 1 ],
                                                                                    'A' : [ 'A' , 'A', 0 ],
                                                                                    'A#': [ 'Bb', 'A', 1 ],
                                                                                    'Bb': [ 'Bb', 'A', 1 ],
                                                                                    'B' : [ 'B' , 'A', 2 ]
                                                                                    },
                                                                                    BaseIntervals: ['C', 'C#', 'D', 'Eb', 'E', 'F', 'F#', 'G', 'G#', 'A', 'Bb', 'B']
                                                                                    },
                                                                                    ChordList : function() {
                                                                                    var list = [];
                                                                                    for (var key in jtab.Chords) {
                                                                                    list.push( key );
                                                                                    }
                                                                                    return list;
                                                                                    }
                                                                                    };
                                                                                    
                                                                                    //
                                                                                    // define Array utility functions
                                                                                    //
                                                                                    
                                                                                    Array.prototype.max_chars = function() {
                                                                                    var max = this[0].length;
                                                                                    var len = this.length;
                                                                                    for (var i = 1; i < len; i++) if (this[i].length > max) max = this[i].length;
                                                                                    return max;
                                                                                    }
                                                                                    
                                                                                    
                                                                                    //
                                                                                    // define jtabChord class
                                                                                    // public members:
                                                                                    //  isValid        = whether valid chord defined
                                                                                    //  isCaged        = whether chord is CAGED type
                                                                                    //  fullChordName  = full chord name, including position e.g. D#m7:3
                                                                                    //  chordName      = chord name, without position e.g. D#m7
                                                                                    //  baseName       = translated chord name (B <-> #), without position e.g. Ebm7
                                                                                        //  rootNote       = root note e.g. D#
                                                                                        //  rootExt        = root note extension e.g. m7
                                                                                        //  cagedBaseShape = caged base shape e.g. D
                                                                                        //  cagedBaseFret  = caged base fret e.g. 0
                                                                                        //  cagedPos       = caged position e.g. 3
                                                                                        //
                                                                                        
                                                                                        var jtabChord = Class.create({
                                                                                        initialize: function(token) {
                                                                                        this.scale = jtab.WesternScale;
                                                                                        this.baseNotes = this.scale.BaseNotes;
                                                                                        this.baseChords = jtab.Chords;
                                                                                        this.isValid = true;
                                                                                        var parts = token.split(":");
                                                                                        this.chordName = parts[0];
                                                                                        this.chordArray = new Array();
                                                                                        this.chordArray[0] = parts[1];
                                                                                        this.fullChordName = parts[0];
                                                                                        this.isCaged = false;
                                                                                        this.cagedPos = 1;
                                                                                        }
                                                                                        });
                                                                                        
                                                                                        
                                                                                        
                                                                                        
                                                                                        //
                                                                                        // define extensions to the Raphael class
                                                                                        //
                                                                                        
                                                                                        Raphael.fn.tabtype = 0;  // 0 = none, 1 = tab & chord, 2 = chord, 3 = tab
                                                                                        Raphael.fn.has_chord = false;
                                                                                        Raphael.fn.has_tab = false;
                                                                                        
                                                                                        Raphael.fn.debug = false;
                                                                                        Raphael.fn.scale = 1; 
                                                                                        Raphael.fn.margin_top = 36;
                                                                                        Raphael.fn.margin_bottom = 10;
                                                                                        Raphael.fn.margin_left = 16;
                                                                                        Raphael.fn.margin_right = 10;
                                                                                        
                                                                                        Raphael.fn.current_offset = Raphael.fn.margin_left;
                                                                                        
                                                                                        Raphael.fn.string_spacing = 16;
                                                                                        Raphael.fn.strings_drawn = 6;
                                                                                        Raphael.fn.fret_spacing = 16;
                                                                                        Raphael.fn.frets_drawn = 4;
                                                                                        Raphael.fn.note_radius = 7;
                                                                                        
                                                                                        Raphael.fn.fret_width = Raphael.fn.string_spacing * ( Raphael.fn.strings_drawn - 1 ); 
                                                                                        Raphael.fn.fret_height = Raphael.fn.fret_spacing * (Raphael.fn.frets_drawn + 0.5); 
                                                                                        Raphael.fn.chord_width = Raphael.fn.margin_left + Raphael.fn.fret_width + Raphael.fn.string_spacing + Raphael.fn.margin_right; 
                                                                                        Raphael.fn.chord_height = Raphael.fn.margin_top + Raphael.fn.fret_height + Raphael.fn.margin_bottom;
                                                                                        
                                                                                        Raphael.fn.tab_current_string = 0; // 1,2,3,4,5,6 or 0 = not set
                                                                                        Raphael.fn.tab_margin_top = 10;
                                                                                        Raphael.fn.tab_top = Raphael.fn.chord_height + Raphael.fn.tab_margin_top;
                                                                                        Raphael.fn.tab_spacing = Raphael.fn.fret_spacing;
                                                                                        Raphael.fn.tab_height = Raphael.fn.tab_spacing * 5;
                                                                                        Raphael.fn.tab_char_width = 8;
                                                                                        
                                                                                        Raphael.fn.total_height = Raphael.fn.tab_top + Raphael.fn.tab_height + Raphael.fn.margin_bottom;
                                                                                        
                                                                                        Raphael.fn.color = "#000";
                                                                                        Raphael.fn.fingering_text_color = "#fff";
                                                                                        Raphael.fn.tab_text_color = "brown";
                                                                                        
                                                                                        
                                                                                        // debug helper - puts grid marks on the rendered image
                                                                                        Raphael.fn.debug_grid = function (width) {
                                                                                        // h ticks
                                                                                        this.path({stroke: this.color, "stroke-width":0.2 }).relatively().moveTo(
                                                                                        this.current_offset, 0).lineTo(0, 4);
                                                                                        this.path({stroke: this.color, "stroke-width":0.2 }).relatively().moveTo(
                                                                                        this.current_offset + this.margin_left, 0).lineTo(0, 2);
                                                                                        this.path({stroke: this.color, "stroke-width":0.2 }).relatively().moveTo(
                                                                                        this.current_offset + width - this.margin_right, 0).lineTo(0, 2);
                                                                                        // v ticks
                                                                                        if (this.tabtype == 3) {
                                                                                        this.path({stroke: this.color, "stroke-width":0.2 }).relatively().moveTo(
                                                                                        this.current_offset, this.tab_margin_top).lineTo(2, 0);
                                                                                        } else {
                                                                                        this.path({stroke: this.color, "stroke-width":0.2 }).relatively().moveTo(
                                                                                        this.current_offset, this.margin_top).lineTo(2, 0);
                                                                                        }
                                                                                        }
                                                                                        
                                                                                        
                                                                                        // step the current position for drawing
                                                                                        Raphael.fn.increment_offset = function (width) {
                                                                                        w = ( width === undefined ) ? this.chord_width : width;
                                                                                        if (this.debug) this.debug_grid(w);
                                                                                        this.current_offset += w;
                                                                                        this.setSize( this.current_offset, this.total_height );
                                                                                        }
                                                                                        
                                                                                        
                                                                                        // draw the fretboard
                                                                                        Raphael.fn.chord_fretboard = function ( position, chord_name ) {
                                                                                        var fret_left = this.current_offset + this.margin_left;
                                                                                        var fret_labels = [ '', '', '', 'III', '', 'V', '', 'VII', '', 'IX', '', '', 'XII', '', '', 'XV', '', 'XVII', '', 'XIX', '', 'XXI', '' ];
                                                                                        
                                                                                        this.text( // chord name
                                                                                        fret_left + 2.5 * this.string_spacing,
                                                                                        this.margin_top - 20, 
                                                                                        chord_name).attr({stroke: this.tab_text_color, "font-family":"verdana", "font-size":"14px", "stroke-width":1.3, "color":"brown"});
                                                                                        
                                                                                        if ( position == 0 ) { // nut
                                                                                        this.path({stroke: this.color, "stroke-width":3 }).relatively().moveTo(
                                                                                        fret_left, this.margin_top).lineTo(this.string_spacing * (this.strings_drawn - 1), 0);
                                                                                        } else {
                                                                                        this.path({stroke: this.color, "stroke-width":1 }).relatively().moveTo(
                                                                                        fret_left, this.margin_top).lineTo(this.string_spacing * (this.strings_drawn - 1), 0);
                                                                                        }
                                                                                        for (var i = 0; i <= this.frets_drawn; i++ ) { // frets
                                                                                            this.path({stroke: this.color}).relatively().moveTo(
                                                                                            fret_left, 
                                                                                            this.margin_top + (i * this.fret_spacing) ).lineTo(this.string_spacing * (this.strings_drawn - 1), 0 );
                                                                                            
                                                                                            pos = ( fret_labels[ position + i ] === undefined ) ? '' : fret_labels[ position + i ];
                                                                                            
                                                                                            if ( pos.length > 0 ) { // draw fret position
                                                                                            this.text(
                                                                                            fret_left + this.fret_width + this.string_spacing * 1.0, 
                                                                                            this.margin_top + ( ( i - 0.5 ) * this.fret_spacing), 
                                                                                            pos).attr({stroke: this.tab_text_color, "font-size":"12px"});
                                                                                            }
                                                                                            }
                                                                                            for (var i = 0; i < this.strings_drawn; i++ ) { // strings
                                                                                                this.path({stroke: this.color}).relatively().moveTo(
                                                                                                fret_left + (i * this.string_spacing), 
                                                                                                this.margin_top).lineTo(0, this.fret_spacing * (this.frets_drawn + 0.5) );
                                                                                                }
                                                                                                this.tab_extend(this.chord_width); // extend the tab if present
                                                                                                }
                                                                                                
                                                                                                
                                                                                                // draw a stroke (/)
                                                                                                Raphael.fn.stroke = function () {
                                                                                                
                                                                                                if (this.has_tab) {
                                                                                                var width = this.tab_char_width * 3;
                                                                                                // extend tab
                                                                                                this.tab_extend(width);
                                                                                                //  stroke
                                                                                                this.path({stroke: this.tab_text_color, "stroke-width":4 }).relatively().moveTo( 
                                                                                                this.current_offset + this.tab_char_width, 
                                                                                                this.tab_top  + (3.5 * this.tab_spacing) ).lineTo(
                                                                                                this.tab_char_width, 
                                                                                                - 2 * this.tab_spacing );
                                                                                                
                                                                                                this.increment_offset(width);    
                                                                                                } else if (this.has_chord) {
                                                                                                var dx = this.string_spacing;
                                                                                                var dy = 2 * this.fret_spacing;     
                                                                                                this.path({stroke: this.tab_text_color, "stroke-width":4 }).relatively().moveTo( 
                                                                                                this.current_offset + this.margin_left, 
                                                                                                this.margin_top + this.fret_spacing + dy ).lineTo(
                                                                                                dx, -dy );
                                                                                                
                                                                                                this.increment_offset(  this.margin_left + dx + this.margin_right ); 
                                                                                                }
                                                                                                }
                                                                                                
                                                                                                
                                                                                                // draw a bar
                                                                                                Raphael.fn.bar = function () {
                                                                                                
                                                                                                if (this.has_tab) {
                                                                                                var width = this.tab_char_width * 2;
                                                                                                // extend tab
                                                                                                this.tab_extend(width);
                                                                                                this.path({stroke: this.color, "stroke-width":1 }).relatively().moveTo( //  bar
                                                                                                this.current_offset + this.tab_char_width, this.tab_top ).lineTo( 0, this.tab_height );
                                                                                                this.increment_offset(width);    
                                                                                                
                                                                                                } else if (this.has_chord) { 
                                                                                                var fret_left = this.current_offset + this.margin_left;
                                                                                                this.path({stroke: this.color, "stroke-width":1 }).relatively().moveTo( 
                                                                                                this.current_offset + this.margin_left, this.margin_top  ).lineTo(
                                                                                                0, this.fret_height );
                                                                                                
                                                                                                this.increment_offset( this.margin_left + this.margin_right );  
                                                                                                }
                                                                                                }
                                                                                                
                                                                                                
                                                                                                // draw double bar
                                                                                                Raphael.fn.doublebar = function () {
                                                                                                if (this.has_tab) {
                                                                                                var width = this.tab_char_width + 8;
                                                                                                // extend tab
                                                                                                this.tab_extend(width);
                                                                                                //  bar
                                                                                                this.path({stroke: this.color, "stroke-width":1 }).relatively().moveTo(
                                                                                                this.current_offset + this.tab_char_width, this.tab_top ).lineTo( 
                                                                                                0, this.tab_height );
                                                                                                this.path({stroke: this.color, "stroke-width":4 }).relatively().moveTo(
                                                                                                this.current_offset + this.tab_char_width + 6, this.tab_top ).lineTo( 
                                                                                                0, this.tab_height );
                                                                                                this.increment_offset(width);    
                                                                                                
                                                                                                } else if (this.has_chord) { 
                                                                                                var left = this.current_offset + this.margin_left;
                                                                                                this.path({stroke: this.color, "stroke-width":1 }).relatively().moveTo( 
                                                                                                left, this.margin_top  ).lineTo(
                                                                                                0, this.fret_height );
                                                                                                this.path({stroke: this.color, "stroke-width":4 }).relatively().moveTo( 
                                                                                                left + 6, this.margin_top  ).lineTo(
                                                                                                0, this.fret_height );
                                                                                                
                                                                                                this.increment_offset( this.margin_left + 6 + this.margin_right );  
                                                                                                }
                                                                                                }
                                                                                                
                                                                                                
                                                                                                // draw a note in a chord
                                                                                                Raphael.fn.chord_note = function (position, string_number, note) {
                                                                                                // NB: internal string_number in chords counts from low to high
                                                                                                var fret_number = note[0];
                                                                                                var fret_left = this.current_offset + this.margin_left;
                                                                                                
                                                                                                if (fret_number < 0 ) {
                                                                                                // muted/not played
                                                                                                this.text(fret_left + (string_number - 1) * this.string_spacing, this.margin_top - 8, "x").attr({stroke: this.tab_text_color, "font-size":"9px"});
                                                                                                } else if (fret_number == 0 ) {
                                                                                                // open
                                                                                                this.text(fret_left + (string_number - 1) * this.string_spacing, this.margin_top - 8, "o").attr({stroke: this.tab_text_color, "font-size":"9px"});
                                                                                                } else {
                                                                                                var fret_dy = (fret_number - position - 0.5) * this.fret_spacing;
                                                                                                //var circle = 
                                                                                                this.circle(
                                                                                                fret_left + (string_number - 1) * this.string_spacing, 
                                                                                                this.margin_top + fret_dy, this.note_radius).attr({stroke: this.color, fill: this.color});
                                                                                                if ( ! (note[1] === undefined) ) {
                                                                                                this.text( fret_left + (string_number - 1) * this.string_spacing, 
                                                                                                this.margin_top + fret_dy, note[1] ).attr({stroke: this.fingering_text_color, "font-size":"12px"});
                                                                                                }
                                                                                                }
                                                                                                
                                                                                                if ( this.has_tab && fret_number >= 0 ) {
                                                                                                this.draw_tab_note( (this.strings_drawn - string_number + 1), fret_number, this.margin_left + this.string_spacing * 2.5 ); 
                                                                                                }
                                                                                                }
                                                                                                
                                                                                                
                                                                                                // extend the tab drawing area
                                                                                                Raphael.fn.tab_extend = function (width) {
                                                                                                if (this.has_tab == false) return;
                                                                                                for (var i = 0; i < this.strings_drawn; i++ ) {
                                                                                                    this.path({stroke: this.color}).relatively().moveTo(this.current_offset, this.tab_top  + (i * this.tab_spacing) ).lineTo( width, 0 );
                                                                                                    }
                                                                                                    }
                                                                                                    
                                                                                                    
                                                                                                    // start the tab
                                                                                                    Raphael.fn.tab_start = function () {
                                                                                                    if (this.has_tab == false) return;
                                                                                                    var width = this.tab_char_width * 3;
                                                                                                    //  start bar
                                                                                                    this.path({stroke: this.color, "stroke-width":1 }).relatively().moveTo(this.current_offset, this.tab_top ).lineTo( 0, this.tab_height );
                                                                                                    // extend tab
                                                                                                    this.tab_extend(width);
                                                                                                    //write TAB
                                                                                                    this.text(this.current_offset + this.tab_char_width, this.tab_top + this.tab_spacing * 1.5, "T").attr({stroke: this.color, "font-size":"14px"});
                                                                                                    this.text(this.current_offset + this.tab_char_width, this.tab_top + this.tab_spacing * 2.5, "A").attr({stroke: this.color, "font-size":"14px"});
                                                                                                    this.text(this.current_offset + this.tab_char_width, this.tab_top + this.tab_spacing * 3.5, "B").attr({stroke: this.color, "font-size":"14px"});
                                                                                                    this.increment_offset(width);
                                                                                                    }
                                                                                                    
                                                                                                    
                                                                                                    // draw an individual note in the tab
                                                                                                    Raphael.fn.draw_tab_note = function (string_number, token, left_offset) {
                                                                                                    // NB: internal string_number in tab counts from high to low
                                                                                                    this.text(this.current_offset + left_offset, 
                                                                                                    this.tab_top + this.tab_spacing * (string_number - 1), 
                                                                                                    token).attr({stroke: this.color, "font-size":"16px"});
                                                                                                    }
                                                                                                    
                                                                                                    // gets string number from token $[1-6|EADGBe]
                                                                                                    Raphael.fn.get_string_number = function (token) {
                                                                                                    var string_number = null;
                                                                                                    if ( token.match( /^\$[1-6]/ ) != null ) {
                                                                                                    string_number = token.substr(1,1); 
                                                                                                    } else if ( token.match( /^\$[EADGBe]/ ) != null ) {
                                                                                                    string_number =  6 - "EADGBe".indexOf(token.substr(1,1));
                                                                                                    } 
                                                                                                    return string_number;
                                                                                                    }
                                                                                                    
                                                                                                    
                                                                                                    // identify if full chord of notes specified i.e. A:1 = X02220 or C:4 = 8.10.10.9.8.8
                                                                                                    // returns:
                                                                                                    //   false = not a full chord representation
                                                                                                    //   array = array of notes (low to high)
                                                                                                    Raphael.fn.get_fullchord_notes = function (token) {
                                                                                                    var rc = false;
                                                                                                    if ( token.match( /[^\.xX0-9]/ ) != null ) {
                                                                                                    rc = false;
                                                                                                    } else {
                                                                                                    if ( token.match( /\./ ) != null ) {
                                                                                                    rc = token.split('.');
                                                                                                    } else {
                                                                                                    rc = token.split('');
                                                                                                    }
                                                                                                    if (rc.length != 6) rc = false;
                                                                                                    } 
                                                                                                    return rc;
                                                                                                    }
                                                                                                    
                                                                                                    
                                                                                                    // draw a token on the tab
                                                                                                    Raphael.fn.tab_note = function (token) {
                                                                                                    if (this.has_tab == false) return;
                                                                                                    
                                                                                                    if ( token.match( /\$/ ) != null ) { // contains a string specifier
                                                                                                    if ( token.match( /\./ ) != null ) { // is a multi-string specifier
                                                                                                    var parts = token.split(".");
                                                                                                    var width = 2;
                                                                                                    for (var i = 0; i < parts.length ; i++) { // get the max length of the multi-string specifiers 
                                                                                                    if ( parts[i].length > width ) width = parts[i].length;
                                                                                                    }
                                                                                                    width *= this.tab_char_width + 1;
                                                                                                    this.tab_extend( width );
                                                                                                    for (var i = 0; i < parts.length ; i++) {
                                                                                                        var part = parts[i];
                                                                                                        var string_number = this.get_string_number(part);
                                                                                                        if (string_number != null) {
                                                                                                        this.tab_current_string = string_number;
                                                                                                        } else if ( this.tab_current_string > 0 )  {
                                                                                                        this.draw_tab_note( this.tab_current_string, part, width * 0.5 );
                                                                                                        }
                                                                                                        }
                                                                                                        this.increment_offset( width );
                                                                                                        
                                                                                                        } else { // just a string setting
                                                                                                        this.tab_current_string = this.get_string_number(token);
                                                                                                        }
                                                                                                        } else {
                                                                                                        var fullchord_notes = this.get_fullchord_notes(token);
                                                                                                        if ( fullchord_notes ) {
                                                                                                        var max_chars = fullchord_notes.max_chars();
                                                                                                        var width = this.tab_char_width * (max_chars + 2);
                                                                                                        this.tab_extend( width );
                                                                                                        for (var i = 0; i < fullchord_notes.length ; i++) {
                                                                                                            this.draw_tab_note( 6 - i, fullchord_notes[i], width * 0.5 ); 
                                                                                                            }
                                                                                                            this.increment_offset( width );
                                                                                                            } else if ( this.tab_current_string > 0 ) { // else draw literal, but only if a current string selected
                                                                                                            var width = this.tab_char_width * ( token.length + 2 );
                                                                                                            this.tab_extend( width );
                                                                                                            this.draw_tab_note( this.tab_current_string, token, width * 0.5 ); 
                                                                                                            this.increment_offset( width );
                                                                                                            }
                                                                                                            }
                                                                                                            }
                                                                                                            
                                                                                                            
                                                                                                            // main drawing routine entry point: to render a token - chord or tab
                                                                                                            
                                                                                                            Raphael.fn.render_token = function (token,array) {
                                                                                                            var c = new jtabChord(token);
                                                                                                            if ( c.isValid ) { // draw chord
                                                                                                            var chord = array;
                                                                                                            this.chord_fretboard(chord[0], c.fullChordName );
                                                                                                            for (var i = 1; i < chord.length ; i++) {
                                                                                                                this.chord_note(chord[0], i, chord[i]);
                                                                                                                }
                                                                                                                this.increment_offset();
                                                                                                                } else {
                                                                                                                if (token == "/" ) {
                                                                                                                this.stroke();
                                                                                                                } else if (token == "|" ) {
                                                                                                                this.bar();
                                                                                                                } else if (token == "||" ) {
                                                                                                                this.doublebar();
                                                                                                                } else if ( this.has_tab ) {
                                                                                                                this.tab_note( token );
                                                                                                                }
                                                                                                                
                                                                                                                }
                                                                                                                }
                                                                                                                
                                                                                                                
                                                                                                                //
                                                                                                                // add jtab class methods
                                                                                                                //
                                                                                                                
                                                                                                                
                                                                                                                // determine nature of the token stream
                                                                                                                // returns:
                                                                                                                //   1 : chord and tab present
                                                                                                                //   2 : chord only
                                                                                                                //   3 : tab only
                                                                                                                //   0 : unknown
                                                                                                                jtab.characterize = function (notation) {
                                                                                                                var tabtype = 2;
                                                                                                                var gotChord = true;
                                                                                                                var gotTab = false;
                                                                                                                // set defaults - apply scaling here (TODO)
                                                                                                                Raphael.fn.current_offset = Raphael.fn.margin_left;
                                                                                                                if ( gotChord && gotTab ) { // chord and tab
                                                                                                                tabtype = 1;
                                                                                                                Raphael.fn.has_chord = true;
                                                                                                                Raphael.fn.has_tab = true;
                                                                                                                Raphael.fn.tab_top = Raphael.fn.chord_height + Raphael.fn.tab_margin_top;
                                                                                                                Raphael.fn.total_height = Raphael.fn.tab_top + Raphael.fn.tab_height + Raphael.fn.margin_bottom;
                                                                                                                } else if ( gotChord ) { // chord only
                                                                                                                tabtype = 2;
                                                                                                                Raphael.fn.has_chord = true;
                                                                                                                Raphael.fn.has_tab = false;
                                                                                                                Raphael.fn.tab_top = Raphael.fn.chord_height + Raphael.fn.tab_margin_top;
                                                                                                                Raphael.fn.total_height = Raphael.fn.chord_height;
                                                                                                                } else if ( gotTab ) { // tab only
                                                                                                                tabtype = 3;
                                                                                                                Raphael.fn.has_chord = false;
                                                                                                                Raphael.fn.has_tab = true;
                                                                                                                Raphael.fn.tab_top = Raphael.fn.tab_margin_top;
                                                                                                                Raphael.fn.total_height = Raphael.fn.tab_top + Raphael.fn.tab_height + Raphael.fn.margin_bottom;
                                                                                                                }
                                                                                                                Raphael.fn.tabtype = tabtype;    
                                                                                                                return tabtype;
                                                                                                                }
                                                                                                                
                                                                                                                // utility function to get calculated style based on given element
                                                                                                                jtab.getStyle = function (element, style) {
                                                                                                                var value = element.style[style];
                                                                                                                if(!value) {
                                                                                                                if(document.defaultView) {
                                                                                                                value = document.defaultView.getComputedStyle(element, "").getPropertyValue(style);
                                                                                                                } else if(element.currentStyle) {
                                                                                                                value = element.currentStyle[style];
                                                                                                                }
                                                                                                                }
                                                                                                                return value;
                                                                                                                }
                                                                                                                
                                                                                                                // set color pallette for the jtab rendering
                                                                                                                jtab.setPalette = function (element) {
                                                                                                                var elStyle = jtab.getStyle( $(element), 'color' );
                                                                                                                if (! elStyle) elStyle='#000';
                                                                                                                Raphael.fn.color = elStyle;
                                                                                                                Raphael.fn.tab_text_color = elStyle;
                                                                                                                
                                                                                                                elStyle = jtab.getStyle( $(element), 'backgroundColor' );
                                                                                                                if (! elStyle) elStyle='#fff';
                                                                                                                if (elStyle == 'transparent') elStyle = '#fff';  
                                                                                                                Raphael.fn.fingering_text_color = elStyle;
                                                                                                                
                                                                                                                }
                                                                                                                
                                                                                                                // main render entry point
                                                                                                                jtab.render = function (element,notation,array) {
                                                                                                                // add the Raphael canvas in its own DIV. this gets around an IE6 issue with not removing previous renderings
                                                                                                                var canvas_holder = new Element('div').setStyle({height: Raphael.fn.total_height});
                                                                                                                $(element).update(canvas_holder);
                                                                                                                jtab.setPalette(element);
                                                                                                                canvas = Raphael(canvas_holder, 80, Raphael.fn.total_height );
                                                                                                                canvas.tab_start();
                                                                                                                canvas.render_token(notation,array);
                                                                                                                }
                                                                                                                
                                                                                                                
                                                                                                                // process implicit rendering of tags with class 'jtab'
                                                                                                                jtab.renderimplicit = function() {
                                                                                                                $$('.jtab').each( function(name, index) { jtab.render(name,name.innerHTML); } );
                                                                                                                }
                                                                                                                
                                                                                                                
                                                                                                                // initialize jtab - setup to run implicit rendering on window.onload
                                                                                                                jtab.init = function() {
                                                                                                                if (typeof window.onload != 'function') {
                                                                                                                window.onload = jtab.renderimplicit;
                                                                                                                } else {
                                                                                                                var oldonload = window.onload;
                                                                                                                window.onload = function() {
                                                                                                                if (oldonload) {
                                                                                                                oldonload();
                                                                                                                }
                                                                                                                jtab.renderimplicit();
                                                                                                                }
                                                                                                                }
                                                                                                                }
                                                                                                                
                                                                                                                
                                                                                                                // bootstrap jtab
                                                                                                                jtab.init();                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                
                                                                                                                


</script></head>
<body style="background: transparent;">
    <center>
        <table style="margin-top: -20px"><tr>
            <td><div id="tab1" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td>
            <td><div id="tab2" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td></tr><tr>
                <td><div id="tab3" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td>
                <td><div id="tab4" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td></tr><tr>
                    <td><div id="tab5" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td>
                    <td><div id="tab6" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td></tr><tr>
                        <td><div id="tab7" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td>
                        <td><div id="tab8" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td></tr><tr>
                            <td><div id="tab9" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td>
                            <td><div id="tab10" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td></tr><tr>
                                <td><div id="tab11" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td>
                                <td><div id="tab12" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td></tr><tr>
                                    <td><div id="tab13" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td>
                                    <td><div id="tab14" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td></tr><tr>
                                        <td><div id="tab15" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td>
                                        <td><div id="tab16" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td></tr><tr>
                                            <td><div id="tab17" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td>
                                            <td><div id="tab18" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td></tr><tr>
                                                <td><div id="tab19" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td>
                                                <td><div id="tab20" style="color:#5e5d5d; margin-bottom:-100px; background: transparent; margin-right: 15px;"></div></td></tr>
        </table>
    </center>
    <br><br>
</body>
</html>

